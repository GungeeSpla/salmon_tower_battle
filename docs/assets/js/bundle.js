!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"APP_VERSION",(function(){return p})),n.d(i,"APP_VERSION_QUERY",(function(){return m})),n.d(i,"IS_DEVELOPMENT",(function(){return f})),n.d(i,"IS_DEBUG_OPERATE",(function(){return y})),n.d(i,"IS_DEBUG_POLYGON",(function(){return w})),n.d(i,"IS_DEBUG_RANDOM_SEED",(function(){return b})),n.d(i,"IS_DEBUG_LOG",(function(){return v})),n.d(i,"DEBUG_RANDOM_SEED",(function(){return x})),n.d(i,"STORAGE_CONFIG",(function(){return k})),n.d(i,"STORAGE_CONFIG_KEYS",(function(){return E})),n.d(i,"SOUND_URL_BASE",(function(){return O})),n.d(i,"SOUND_SILENT",(function(){return A})),n.d(i,"SOUNT_INITIAL_BGM",(function(){return j})),n.d(i,"SOUND_VOLUME_ALPHAS",(function(){return S})),n.d(i,"SE_PANEL_NEXT",(function(){return T})),n.d(i,"SE_PANEL_JUMP_OUT",(function(){return I})),n.d(i,"SE_PANEL_ROTATE",(function(){return B})),n.d(i,"SE_PANEL_DOWN",(function(){return C})),n.d(i,"KEY_CONFIG",(function(){return P})),n.d(i,"KEY_TYPES",(function(){return L})),n.d(i,"INITIAL_LABEL",(function(){return M})),n.d(i,"LAYER_NAMES",(function(){return D})),n.d(i,"CONTAINER_ID",(function(){return N})),n.d(i,"CANVAS_ID",(function(){return R})),n.d(i,"SCENE_JUMP_DURATION",(function(){return _})),n.d(i,"CANVAS_FITTING_DURATION",(function(){return $})),n.d(i,"CANVAS_WIDTH",(function(){return G})),n.d(i,"CANVAS_HEIGHT",(function(){return U})),n.d(i,"CANVAS_RATIO",(function(){return F})),n.d(i,"IPHONE_4_RATIO",(function(){return H})),n.d(i,"IPHONE_11_RATIO",(function(){return V})),n.d(i,"IPAD_PRO_10_RATIO",(function(){return q})),n.d(i,"CANVAS_MIN_RATIO",(function(){return W})),n.d(i,"CANVAS_MAX_RATIO",(function(){return z})),n.d(i,"IS_ENABLED_POPUP",(function(){return Y})),n.d(i,"CANVAS_CENTER_X",(function(){return X})),n.d(i,"BG_COLOR",(function(){return K})),n.d(i,"BACK_GRAD_THRESHOLD",(function(){return J})),n.d(i,"BACK_GRADS",(function(){return Q})),n.d(i,"ROOM_MEMBER_COUNT_MAX",(function(){return Z})),n.d(i,"PANEL_TIME_LIMIT",(function(){return ee})),n.d(i,"PLAYER_LIFE",(function(){return te})),n.d(i,"FRAME_RATE",(function(){return ne})),n.d(i,"SHOULD_USE_TIMEOUT",(function(){return ie})),n.d(i,"METER",(function(){return se})),n.d(i,"METER_B",(function(){return oe})),n.d(i,"GRAVITY",(function(){return ae})),n.d(i,"TIME_STEP",(function(){return re})),n.d(i,"VELOCITY_ITERATIONS",(function(){return ce})),n.d(i,"POSITION_ITERATIONS",(function(){return le})),n.d(i,"STROKE_WIDTH",(function(){return ue})),n.d(i,"MAX_LINEAR_VELOCITY",(function(){return de})),n.d(i,"DEFAULT_DENSITY",(function(){return he})),n.d(i,"DEFAULT_FRICTION",(function(){return pe})),n.d(i,"DEFAULT_RESTITUTION",(function(){return ge})),n.d(i,"MAX_VERTEX_NUM",(function(){return me})),n.d(i,"MAX_DENSITY",(function(){return fe})),n.d(i,"SCROLL_DURATION",(function(){return ye})),n.d(i,"ROTATE_DURATION",(function(){return we})),n.d(i,"CLOUD_ANIMATION_DURATION",(function(){return be})),n.d(i,"PANEL_CREATE_DURATION",(function(){return ve})),n.d(i,"PANEL_CREATE_DURATION_JUMPED",(function(){return xe})),n.d(i,"SYNC_OPERATE_ANIMATION_DURATION",(function(){return ke})),n.d(i,"SYNC_OPERATE_TIMEOUT_DURATION",(function(){return Ee})),n.d(i,"TELEPORT_X",(function(){return Oe})),n.d(i,"OPERATION_DEFAULT_Y",(function(){return Ae})),n.d(i,"OPERATION_MARGIN_BOTTOM",(function(){return je})),n.d(i,"OPERATION_MARGIN_TOP",(function(){return Se})),n.d(i,"FLOOR_Y",(function(){return Te})),n.d(i,"FLOOR_WIDTH",(function(){return Ie})),n.d(i,"WORLD_HEIGHT",(function(){return Be})),n.d(i,"CUSION_COEFFICIENT",(function(){return Ce})),n.d(i,"MAX_SHAKE_COUNT",(function(){return Pe})),n.d(i,"ROTATE_BRAKE_COEFFICIENT",(function(){return Le}));var s={};n.r(s),n.d(s,"parseDegree",(function(){return We})),n.d(s,"parseRadian",(function(){return ze})),n.d(s,"round",(function(){return Ye})),n.d(s,"ucfirst",(function(){return Xe})),n.d(s,"logger",(function(){return Ke})),n.d(s,"setB2BodyXYAngle",(function(){return Je})),n.d(s,"addB2BodyXYAngle",(function(){return Qe})),n.d(s,"getImage",(function(){return Ze})),n.d(s,"getSvgPathData",(function(){return et})),n.d(s,"existsURL",(function(){return tt})),n.d(s,"getWindowWidth",(function(){return nt})),n.d(s,"getWindowHeight",(function(){return it})),n.d(s,"getTime",(function(){return st})),n.d(s,"padding00",(function(){return ot})),n.d(s,"getDate",(function(){return at})),n.d(s,"getTimestamp",(function(){return rt})),n.d(s,"existsElectron",(function(){return ct})),n.d(s,"getBrowserName",(function(){return lt})),n.d(s,"getOSName",(function(){return ut})),n.d(s,"getQueries",(function(){return dt})),n.d(s,"logDisplayObjectCount",(function(){return ht})),n.d(s,"emptyElement",(function(){return pt})),n.d(s,"dispatchDocumentEvent",(function(){return gt})),n.d(s,"addDocumentEventListener",(function(){return mt})),n.d(s,"removeDocumentEventListener",(function(){return ft})),n.d(s,"execCopy",(function(){return yt})),n.d(s,"sleep",(function(){return wt})),n.d(s,"logAsciiArt",(function(){return bt}));var o={};n.r(o),n.d(o,"setApp",(function(){return cn})),n.d(o,"getSeed",(function(){return ln})),n.d(o,"setTodaySeed",(function(){return un})),n.d(o,"setUnixSeed",(function(){return dn})),n.d(o,"setTimeLimit",(function(){return hn})),n.d(o,"setSeed",(function(){return pn})),n.d(o,"setIsOnline",(function(){return gn})),n.d(o,"setIsEndless",(function(){return mn})),n.d(o,"setPlayerStates",(function(){return fn})),n.d(o,"getBackGradIndex",(function(){return yn})),n.d(o,"isOwnTurn",(function(){return wn})),n.d(o,"isOperable",(function(){return bn})),n.d(o,"getObjectMinY",(function(){return vn})),n.d(o,"getMonsterTiles",(function(){return xn})),n.d(o,"getAlivePlayerCount",(function(){return kn})),n.d(o,"getAlivePlayer",(function(){return En})),n.d(o,"execOperationRotate",(function(){return On})),n.d(o,"execOperationDown",(function(){return An})),n.d(o,"execOperationDownForcibly",(function(){return jn})),n.d(o,"receiveOperation",(function(){return Sn})),n.d(o,"createPanel",(function(){return Tn})),n.d(o,"judgeNextPanel",(function(){return In})),n.d(o,"syncPanelStates",(function(){return Bn})),n.d(o,"createPanelStates",(function(){return Cn})),n.d(o,"onAllBodiesSleep",(function(){return Pn})),n.d(o,"updateBackGrads",(function(){return Ln})),n.d(o,"tickWorld",(function(){return Mn})),n.d(o,"handleTickStage",(function(){return Dn})),n.d(o,"initialize",(function(){return Nn})),n.d(o,"finishGame",(function(){return Rn})),n.d(o,"beginGame",(function(){return _n})),n.d(o,"execOperationLR",(function(){return $n})),n.d(o,"replayGame",(function(){return Gn})),n.d(o,"startOver",(function(){return Un})),n.d(o,"startAgain",(function(){return Fn}));var a={};n.r(a),n.d(a,"LOADING",(function(){return Hn})),n.d(a,"SCENE_TITLE",(function(){return Vn})),n.d(a,"SCENE_PRIVATE_ROOM",(function(){return qn})),n.d(a,"SCENE_SIGN_IN",(function(){return Wn})),n.d(a,"SCENE_SETTINGS",(function(){return zn})),n.d(a,"SCENE_INVITE",(function(){return Yn})),n.d(a,"SCENE_OFFLINE_GAME",(function(){return Xn})),n.d(a,"SCENE_ONLINE_GAME",(function(){return Kn})),n.d(a,"REPLAY",(function(){return Jn})),n.d(a,"SCENE_WAIT_ONLINE_GAME",(function(){return Qn}));var r={};n.r(r),n.d(r,"canvasDetail",(function(){return ui})),n.d(r,"setApp",(function(){return di})),n.d(r,"fitCanvas",(function(){return hi})),n.d(r,"bookFitCanvas",(function(){return pi})),n.d(r,"unlockSound",(function(){return gi})),n.d(r,"setupUnlockSound",(function(){return mi})),n.d(r,"clearLayer",(function(){return fi})),n.d(r,"clearLayerAll",(function(){return yi})),n.d(r,"jump",(function(){return wi})),n.d(r,"getTranslatedText",(function(){return bi})),n.d(r,"closeAlert",(function(){return vi})),n.d(r,"alert",(function(){return xi})),n.d(r,"log",(function(){return ki})),n.d(r,"showLoading",(function(){return Ei})),n.d(r,"hideLoading",(function(){return Oi})),n.d(r,"firstJump",(function(){return Ai})),n.d(r,"initialize",(function(){return ji}));var c={};n.r(c),n.d(c,"firebase",(function(){return Ii})),n.d(c,"setApp",(function(){return Mi})),n.d(c,"signInWithTwitterOnElectron",(function(){return Di})),n.d(c,"signInWithTwitterOnBrowser",(function(){return Ni})),n.d(c,"signInWithTwitter",(function(){return Ri})),n.d(c,"signIn",(function(){return _i})),n.d(c,"signOut",(function(){return $i})),n.d(c,"parseProtoPhotoURL",(function(){return Gi})),n.d(c,"parsePhotoURL",(function(){return Ui})),n.d(c,"off",(function(){return Fi})),n.d(c,"onadd",(function(){return Hi})),n.d(c,"onchange",(function(){return Vi})),n.d(c,"onremove",(function(){return qi})),n.d(c,"get",(function(){return Wi})),n.d(c,"getRoom",(function(){return zi})),n.d(c,"remove",(function(){return Yi})),n.d(c,"update",(function(){return Xi})),n.d(c,"push",(function(){return Ki})),n.d(c,"setupAuthStateChange",(function(){return Ji})),n.d(c,"destroyRoom",(function(){return Qi})),n.d(c,"createRoom",(function(){return Zi})),n.d(c,"readyRoom",(function(){return es})),n.d(c,"joinRoom",(function(){return ts})),n.d(c,"leaveRoom",(function(){return ns})),n.d(c,"beginGame",(function(){return is})),n.d(c,"finishGame",(function(){return ss})),n.d(c,"againGame",(function(){return os})),n.d(c,"sendOperation",(function(){return as})),n.d(c,"sendPanelStates",(function(){return rs})),n.d(c,"teardownGaming",(function(){return cs})),n.d(c,"setupGaming",(function(){return ls})),n.d(c,"teardownWaiting",(function(){return us})),n.d(c,"setupWaiting",(function(){return ds})),n.d(c,"getOwnUid",(function(){return hs})),n.d(c,"getOwnUserData",(function(){return ps})),n.d(c,"getOwnUserDataNewly",(function(){return gs})),n.d(c,"setOwnUserData",(function(){return ms})),n.d(c,"getSignState",(function(){return fs})),n.d(c,"initialize",(function(){return ys}));var l={};n.r(l),n.d(l,"setApp",(function(){return Ss})),n.d(l,"makeVolume",(function(){return Ts})),n.d(l,"loadElement",(function(){return Is})),n.d(l,"loadBuffer",(function(){return Bs})),n.d(l,"loadAll",(function(){return Ps})),n.d(l,"stop",(function(){return Ls})),n.d(l,"stopAll",(function(){return Ms})),n.d(l,"playElement",(function(){return Ds})),n.d(l,"playBuffer",(function(){return Ns})),n.d(l,"play",(function(){return Rs})),n.d(l,"updateVolume",(function(){return _s})),n.d(l,"changeMute",(function(){return $s})),n.d(l,"unlock",(function(){return Gs})),n.d(l,"changeVolume",(function(){return Us})),n.d(l,"initialize",(function(){return Fs}));var u={};n.r(u),n.d(u,"getKeyType",(function(){return Hs})),n.d(u,"removeAllListener",(function(){return Vs})),n.d(u,"initialize",(function(){return qs})),n.d(u,"default",(function(){return Ws}));var d={};n.r(d),n.d(d,"get",(function(){return Ys})),n.d(d,"clear",(function(){return Xs})),n.d(d,"clearAll",(function(){return Ks})),n.d(d,"save",(function(){return Js})),n.d(d,"saveAll",(function(){return Qs})),n.d(d,"initialize",(function(){return Zs}));var h=[{id:10,name:"chum",scale:.8,frequency:3},{id:20,name:"cohock",scale:.8,frequency:3},{id:30,name:"smallfry",scale:1,frequency:3},{id:110,name:"maws",scale:.7,frequency:6},{id:120,name:"scrapper",scale:.6,frequency:6},{id:130,name:"steeleel",scale:1,frequency:6},{id:140,name:"steelhead",scale:.8,frequency:6},{id:150,name:"drizzler",scale:.6,frequency:6},{id:160,name:"flyfish",scale:.8,frequency:6},{id:170,name:"stinger",scale:1,frequency:6}];const p="0.3.0",g=document.getElementById("app").getAttribute("src"),m=g.split("?")[1],f=g.indexOf("index.js")>-1,y=f&&!1,w=f&&!1,b=f&&!1,v=f&&!0,x=1,k={settings:{storageKey:"stb-settings",initialValue:{globalVolume:0,isEnabledStageGL:!0,language:null}}},E=Object.keys(k),O="./assets/snd/",A="silent.mp3",j="gogo.mp3",S=[0,.1,.4,1],T="se-panel-next.wav",I="se-panel-jump-out.wav",B="se-panel-rotate.wav",C="se-panel-rotate.wav",P={left:[37],up:[38],right:[39],down:[40],start:[32,13]},L=Object.keys(P),M="title",D=["loading","back","main","fix","alert"],N="createjs-container",R="createjs-canvas",_=200,$=250,G=720,U=1280,F=U/G,H=1.5,V=2688/1242,q=2224/1668,W=q,z=V,Y=!1,X=G/2,K="#00bcd4",J=15,Q=[["#2BFBF9","#16B4E8","#0B8ADE"],["#FDA798","#AA5360","#582F51"],["#2F7FA9","#306A9A","#070C21"]],Z=6,ee=15,te=1,ne=60,ie=!0,se=100,oe=170,ae=4,re=1/ne,ce=3,le=1,ue=2,de=3,he=1,pe=8,ge=0,me=8,fe=30,ye=1e3,we=300,be=2e3,ve=400,xe=800,ke=800,Ee=3333,Oe=100,Ae=400,je=200,Se=400,Te=1e3,Ie=580,Be=(200+U)/se,Ce=1/16,Pe=5,Le=.9;class Me{constructor(e,t,n=null,i=null){this.x=e,this.y=t,this.index=n,this.originIndex=n,this.vertexes=i}remove(){for(let e=this.index+1;e<this.vertexes.length;e+=1)this.vertexes[e].index-=1;this.vertexes.splice(this.index,1)}prev(){const e=(this.index-1+this.vertexes.length)%this.vertexes.length;return this.vertexes[e]}next(){const e=(this.index+1)%this.vertexes.length;return this.vertexes[e]}getTriangle(){return[this,this.next(),this.prev()]}isContainedByTriangle(e){const t=this.constructor.getTriangleDirection([e[0],e[1],this]),n=this.constructor.getTriangleDirection([e[1],e[2],this]),i=this.constructor.getTriangleDirection([e[2],e[0],this]);return t===n&&n===i&&i===t}static getTriangleDirection(e){const t=new Me(e[1].x-e[0].x,e[1].y-e[0].y),n=new Me(e[2].x-e[0].x,e[2].y-e[0].y);return t.x*n.y-n.x*t.y>=0?1:-1}getDistance(e){const t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)}getFurthestVertex(){let e=-1/0,t=null;return this.vertexes.forEach(n=>{const i=this.getDistance(n);i>e&&(e=i,t=n)}),t}}const De=e=>{let t=e.getAttribute("stroke")||"#000";let n;return(e.getAttribute("style")||"").split(";").forEach(e=>{const n=e.split(":");"stroke"===n[0]&&([,t]=n)}),t=t.toLowerCase(),t=t.replace("red","#f00"),t=t.replace("black","#000"),t=t.replace("#",""),n=3===t.length?parseInt(t[0]+t[0],16)||0:parseInt(t[0]+t[1],16)||0,he+n/255*(fe-he)},Ne=e=>{const t=[],n=e.length/2;for(let i=0;i<n;i+=1)t[i]=new Me(e[2*i+0],e[2*i+1],i,t);const i=new Me(0,0,0,t),s=[];let o=0,a=i.getFurthestVertex(),r=null;for(;o<300&&t.length>=3;){o+=1;const e=a.getTriangle();let n=!1;for(let i=0;i<t.length;i+=1){const s=t[i];let o=!1;for(let t=0;t<e.length;t+=1)if(s===e[t]){o=!0;break}if(!o&&s.isContainedByTriangle(e)){n=!0;break}}if(n)r||(r=e),a=a.prev();else{if(r){if(Me.getTriangleDirection(r)!==Me.getTriangleDirection(e)){a=a.prev();continue}}s.push(e),a.remove(),a=i.getFurthestVertex(),r=null}}const c=[];return s.forEach(e=>{let t=!0;t&&c.push([e[0].x,e[0].y,e[1].x,e[1].y,e[2].x,e[2].y])}),c},Re=e=>{const t=[];e.forEach(e=>{if("path"!==e.type)t.push(e);else if(Math.floor(e.path.length/2)<=3)t.push(e);else{Ne(e.path).forEach(n=>{t.push({type:e.type,density:e.density,path:n})})}});const n=[];t.forEach(e=>{switch(e.type){case"circle":{const t=e.cx,i=e.cy,s=e.density*(e.r*e.r*Math.PI);n.push({m:s,x:t,y:i});break}case"path":{const t=(e.path[0]+e.path[2]+e.path[4])/3,i=(e.path[1]+e.path[3]+e.path[5])/3,s=e.density*((e,t,n,i,s,o)=>{const a=(e-s)*(i-o),r=(n-s)*(t-o);return Math.abs(a-r)/2})(...e.path);n.push({m:s,x:t,y:i});break}}});let i=0,s=0,o=0;return n.forEach(e=>{i+=e.m*e.x,s+=e.m*e.y,o+=e.m}),{x:Math.floor(i/o),y:Math.floor(s/o)}};class _e{constructor(e){const{width:t,height:n,shapes:i}=(e=>{const t=e.getElementsByTagName("svg")[0],n=t.getAttribute("viewBox");let i,s;if(n){const e=n.split(" ");i=parseFloat(e[2]),s=parseFloat(e[3])}else i=parseFloat(t.getAttribute("width")),s=parseFloat(t.getAttribute("height"));const o=e.getElementsByTagName("circle"),a=e.getElementsByTagName("ellipse"),r=e.getElementsByTagName("path"),c=[];return o&&Array.prototype.forEach.call(o,e=>{const t=De(e),n=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("r"));c.push({type:"circle",density:t,cx:n,cy:i,r:s})}),a&&Array.prototype.forEach.call(a,e=>{const t=De(e),n=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=(parseFloat(e.getAttribute("rx"))+parseFloat(e.getAttribute("ry")))/2;c.push({type:"circle",density:t,cx:n,cy:i,r:s})}),r&&Array.prototype.forEach.call(r,e=>{const t=De(e),n=e.getAttribute("d");let i="",s=[],o="",a=!0,r=0,l=0,u=!1;const d={x:0,y:0};function h(){let e=parseFloat(i);if(!Number.isNaN(e)){if(r>0)r-=1;else{let t;switch(t=s.length%2==0&&"V"!==o?"x":"y",a||(e+=d[t]),o){case"H":s.push(e),s.push(d.y),d.x=e;break;case"V":s.push(d.x),s.push(e),d.y=e;break;default:s.push(e),d[t]=e}r-=1,r<=-2&&(r=l)}i="",u=!1}return!0}for(let e=0;e<n.length;e+=1){let p=n.charAt(e);const g=p===p.toUpperCase();switch(p=p.toUpperCase(),p){default:i+=p;break;case" ":case",":h();break;case"-":h(),i+=p;break;case".":u&&h(),u=!0,i+=p;break;case"H":h(),a=g,o="H";break;case"V":h(),a=g,o="V";break;case"L":case"M":case"Z":case"T":h(),a=g,o="",r=0,l=0;break;case"C":h(),a=g,o="",l=4,r=4;break;case"S":case"Q":h(),a=g,o="",l=2,r=2}"Z"===p&&(c.push({type:"path",density:t,path:s}),d.x=s[0]||0,d.y=s[1]||0,l=0,r=0,a=!0,o="",s=[])}}),{width:i,height:s,shapes:c}})(e),s=(e=>{const t=[];return e.forEach(e=>{if("path"!==e.type)t.push(e);else if(Math.floor(e.path.length/2)<=me)t.push(e);else{Ne(e.path).forEach(n=>{t.push({type:e.type,density:e.density,path:n})})}}),t})(i),o=Re(s);this.width=t,this.height=n,this.gCenter=o,this.shapes=s}}const{b2Vec2:$e}=window,Ge={},Ue={},Fe={},He={},Ve=void 0!==window.performance;let qe=null;function We(e){return e*(180/Math.PI)}function ze(e){return e*(Math.PI/180)}function Ye(e,t){return Math.round(e*10**t)/10**t}function Xe(e){return e.substr(0,1).toUpperCase()+e.substr(1)}const Ke={log:console.log,info:console.info,warn:console.warn,error:console.error,getMarkerStyle:e=>`background: linear-gradient(transparent 60%, ${e} 60%);\n      font-weight: bold;`,getBigMarkerStyle:(e,t="black")=>`background: linear-gradient(transparent 0%, ${e} 0%);\n      color: ${t}; font-weight: bold;`};function Je(e){const t=void 0!==e.x?e.x:e.body.GetPosition().x,n=void 0!==e.y?e.y:e.body.GetPosition().y,i=void 0!==e.angle?e.angle:e.body.GetAngle();e.body.SetTransform(new $e(t,n),i)}function Qe(e){const t=e.body.GetPosition(),n=void 0!==e.x?e.x:0,i=void 0!==e.y?e.y:0,s=void 0!==e.angle?e.angle*(Math.PI/180):0;Je({body:e.body,x:t.x+n,y:t.y+i,angle:e.body.GetAngle()+s})}function Ze(e){return new Promise(t=>{if(e in Ge)return void t(Ge[e]);const n=new Image;n.onload=()=>{Ge[e]=n,t(n)},n.src=e})}function et(e){return new Promise(t=>{if(e in Ue)return void t(Ue[e]);const n=new XMLHttpRequest;n.open("GET",e,!0),n.onerror=()=>{t(null)},n.onreadystatechange=()=>{if(n.readyState===n.DONE)if(200===n.status||304===n.status){const i=new _e(n.responseXML);Ue[e]=i,t(i)}else t(null)},n.send(null)})}function tt(e){return new Promise(t=>{const n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=()=>{n.readyState===n.DONE&&(404===n.status?t(!1):t(!0))},n.send(null)})}function nt(){return window.innerWidth||!!document.body&&document.body.clientWidth||document.documentElement.clientWidth}function it(){return window.innerHeight||!!document.body&&document.body.clientHeight||document.documentElement.clientHeight}function st(){return Ve?window.performance.now():(new Date).getTime()}function ot(e){return`00${e}`.slice(-2)}function at(){const e=new Date;return`${e.getFullYear()}/${ot(e.getMonth()+1)}/${ot(e.getDate())} ${["Sun","Mon","The","Wed","Thu","Fri","Sat"][e.getDay()]} ${ot(e.getHours())}:${ot(e.getMinutes())}:${ot(e.getSeconds())}`}function rt(){const e=new Date,t=e.getFullYear(),n=ot(e.getMonth()+1),i=ot(e.getDate()),s=ot(e.getHours()),o=ot(e.getMinutes()),a=ot(e.getSeconds());return{date:t+n+i,unix:Math.floor(e.getTime()/1e3),string:`${t}/${n}/${i} ${s}:${o}:${a}`}}function ct(){return!!window.electron}function lt(){const e=window.navigator.userAgent.toLowerCase();return e.indexOf("msie")>-1||e.indexOf("trident")>-1?"ie":e.indexOf("edge")>-1?"edge":e.indexOf("chrome")>-1?"chrome":e.indexOf("safari")>-1?"safari":e.indexOf("firefox")>-1?"firefox":e.indexOf("opera")>-1?"opera":"other"}function ut(){const e=window.navigator.userAgent.toLowerCase();return e.indexOf("iphone")>-1?"iphone":e.indexOf("ipad")>-1?"ipad":e.indexOf("android")>-1?(e.indexOf("mobile"),"android"):e.indexOf("windows")>-1?"windows":e.indexOf("mac os x")>-1?"mac":"other"}function dt(){if(qe)return qe;const e=window.location.search.slice(1),t={};return e&&e.split("&").forEach(e=>{const n=e.split("=");n[1]?[,t[n[0]]]=n:t[n[0]]=""}),qe=t,t}function ht(e,t=0){let n=0;return e.children.forEach(e=>{e instanceof createjs.Container?n+=ht(e,t+1):n+=1}),0===t&&console.log(`${n} display obejcts exist.`),n}function pt(e){const t="string"==typeof e?document.querySelector(e):e;for(;t.firstChild;)t.removeChild(t.firstChild)}function gt(e,t={}){e in Fe||(Fe[e]=document.createEvent("HTMLEvents")),Fe[e].initEvent(e,!1,!1),Fe[e].detail=t,document.dispatchEvent(Fe[e])}function mt(e,t){const[n,i]=e.split(".");n in He||(He[n]=[],document.addEventListener(n,e=>{He[n].forEach(t=>{t.callback(e)})})),He[n].push({groupName:i,callback:t})}function ft(e){const[t,n]=e.split(".");if(t in He)if(n)for(let e=0;e<He[t].length;e+=1)n===He[t][e].groupName&&(He[t].splice(e,1),e-=1);else for(;He[t][0];)He[t].pop()}function yt(e,t){const n=document.createElement("div"),i=document.createElement("pre");i.style.webkitUserSelect="auto",i.style.userSelect="auto",n.appendChild(i).textContent=e;const s=n.style;s.position="fixed",s.right="200%",document.body.appendChild(n),document.getSelection().selectAllChildren(n);const o=document.execCommand("copy");if(document.body.removeChild(n),t){const e=document.getElementById(t);e.style.webkitUserSelect="auto",e.style.userSelect="auto",window.getSelection().selectAllChildren(e)}return o}function wt(e){return new Promise(t=>{setTimeout(()=>{t(null)},e)})}function bt(){console.log(`%c\n███████╗ █████╗ ██╗     ███╗   ███╗ ██████╗ ███╗   ██╗\n██╔════╝██╔══██╗██║     ████╗ ████║██╔═══██╗████╗  ██║\n███████╗███████║██║     ██╔████╔██║██║   ██║██╔██╗ ██║\n╚════██║██╔══██║██║     ██║╚██╔╝██║██║   ██║██║╚██╗██║\n███████║██║  ██║███████╗██║ ╚═╝ ██║╚██████╔╝██║ ╚████║\n╚══════╝╚═╝  ╚═╝╚══════╝╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═══╝\n%c                                                      \n████████╗ ██████╗ ██╗    ██╗███████╗██████╗           \n╚══██╔══╝██╔═══██╗██║    ██║██╔════╝██╔══██╗          \n   ██║   ██║   ██║██║ █╗ ██║█████╗  ██████╔╝          \n   ██║   ██║   ██║██║███╗██║██╔══╝  ██╔══██╗          \n   ██║   ╚██████╔╝╚███╔███╔╝███████╗██║  ██║          \n   ╚═╝    ╚═════╝  ╚══╝╚══╝ ╚══════╝╚═╝  ╚═╝          \n                                                      \n██████╗  █████╗ ████████╗████████╗██╗     ███████╗    \n██╔══██╗██╔══██╗╚══██╔══╝╚══██╔══╝██║     ██╔════╝    \n██████╔╝███████║   ██║      ██║   ██║     █████╗      \n██╔══██╗██╔══██║   ██║      ██║   ██║     ██╔══╝      \n██████╔╝██║  ██║   ██║      ██║   ███████╗███████╗    \n╚═════╝ ╚═╝  ╚═╝   ╚═╝      ╚═╝   ╚══════╝╚══════╝\n\n%cVer.${p} ${f?"(DEVELOPMENT)":""}\n`,"color: orange;","color: limegreen;","color: orange; font-weight: bold; font-size: 24px;"),p!==m&&console.error(`%cMismatch app version (${p}) and query parameter (${m})`,Ke.getBigMarkerStyle("pink"))}v||Object.keys(Ke).forEach(e=>{Ke[e]=()=>{}});class vt{constructor(e){this.x=123456789,this.y=362436069,this.z=521288629,this.w=e||88675123}random(){const e=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>19^e^e>>8,this.w}getRandom(e){return this.random()%e}}const xt={linearTween:(e,t,n,i)=>n*e/i+t,easeInQuad:(e,t,n,i)=>n*(e/=i)*e+t,easeOutQuad:(e,t,n,i)=>-n*(e/=i)*(e-2)+t,easeInOutQuad:(e,t,n,i)=>(e/=i/2)<1?n/2*e*e+t:-n/2*((e-=1)*(e-2)-1)+t,easeInCubic:(e,t,n,i)=>n*(e/=i)*e*e+t,easeOutCubic:(e,t,n,i)=>(e/=i,n*((e-=1)*e*e+1)+t),easeInOutCubic:(e,t,n,i)=>(e/=i/2)<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t,easeInQuart:(e,t,n,i)=>n*(e/=i)*e*e*e+t,easeOutQuart:(e,t,n,i)=>(e/=i,-n*((e-=1)*e*e*e-1)+t),easeInOutQuart:(e,t,n,i)=>(e/=i/2)<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t,easeInQuint:(e,t,n,i)=>n*(e/=i)*e*e*e*e+t,easeOutQuint:(e,t,n,i)=>(e/=i,n*((e-=1)*e*e*e*e+1)+t),easeInOutQuint:(e,t,n,i)=>(e/=i/2)<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t,easeInSine:(e,t,n,i)=>-n*Math.cos(e/i*(Math.PI/2))+n+t,easeOutSine:(e,t,n,i)=>n*Math.sin(e/i*(Math.PI/2))+t,easeInOutSine:(e,t,n,i)=>-n/2*(Math.cos(Math.PI*e/i)-1)+t,easeInExpo:(e,t,n,i)=>n*Math.pow(2,10*(e/i-1))+t,easeOutExpo:(e,t,n,i)=>n*(1-Math.pow(2,-10*e/i))+t,easeInOutExpo:(e,t,n,i)=>(e/=i/2)<1?n/2*Math.pow(2,10*(e-1))+t:(e-=1,n/2*(2-Math.pow(2,-10*e))+t),easeInCirc:(e,t,n,i)=>(e/=i,-n*(Math.sqrt(1-e*e)-1)+t),easeOutCirc:(e,t,n,i)=>(e/=i,e-=1,n*Math.sqrt(1-e*e)+t),easeInOutCirc:(e,t,n,i)=>(e/=i/2)<1?-n/2*(Math.sqrt(1-e*e)-1)+t:(e-=2,n/2*(Math.sqrt(1-e*e)+1)+t)};class kt{constructor(e){this.parentObject=e,this.isUpdate=!1,this.onComplete=null,this.queue=[],this.handle={}}addAnim(e,...t){let n,i=1e3,s="easeOutCubic",o=null,a={},r=!1;t.forEach(e=>{switch(typeof e){case"number":i=e;break;case"string":s=e;break;case"function":o=e;break;case"object":a=e}});const c=Math.floor(i/1e3*ne);if(0!==this.queue.length&&a.isOverwrite){for(;this.queue.length>=2;)this.queue.pop();n=this.queue[0],"function"==typeof n.callback&&n.callback(),n.frame=0,n.type=s,n.callback=o,n.duration=c,Object.keys(e).forEach(t=>{const i=this.parentObject[t],s=e[t],o=s-i;0!==o&&(r=!0,n.props[t].startValue=i,n.props[t].endValue=s,n.props[t].changeInValue=o)}),r||("function"==typeof n.callback&&n.callback(),this.queue.pop())}else n={props:{},frame:0,duration:c,type:s,callback:o},Object.keys(e).forEach(t=>{const i=this.parentObject[t],s=e[t],o=s-i;0!==o&&(r=!0,n.props[t]={startValue:i,endValue:s,changeInValue:o})}),0!==this.queue.length||r?this.queue.push(n):"function"==typeof n.callback&&n.callback();return this}stop(){for(;this.queue.length;)this.queue.shift();this.onComplete=null}call(e){this.onComplete=e}getProperty(e){return this.parentObject[e]}getTargetProperty(e){if(this.queue.length>0){this.queue.length;for(let t=this.queue.length-1;t>=0;t-=1)if(e in this.queue[t].props)return this.queue[t].props[e].endValue}return this.parentObject[e]}tick(){if(0===this.queue.length)return this.isUpdate=!1,!1;const e=this.queue[0];e.frame+=1;const t={};if(Object.keys(e.props).forEach(n=>{const i=e.props[n],s=e.frame>=e.duration?i.endValue:xt[e.type](e.frame,i.startValue,i.changeInValue,e.duration);this.parentObject[n]=s,t[n]=s}),this.parentObject instanceof b2Body&&(t.body=this.parentObject,Je(t)),e.frame>=e.duration){if("function"==typeof e.callback&&e.callback(),this.queue.shift(),0!==this.queue.length){let e,t=!1;do{e=this.queue[0],Object.keys(e.props).forEach(n=>{e.props[n].startValue=this.parentObject[n],e.props[n].changeInValue=e.props[n].endValue-e.props[n].startValue,0!==e.props[n].changeInValue&&(t=!0)}),t||("function"==typeof e.callback&&e.callback(),this.queue.shift())}while(this.queue.length>0&&!t)}0===this.queue.length&&"function"==typeof this.onComplete&&(this.onComplete(),this.onComplete=null)}return this.isUpdate=!0,!0}}class Et{constructor(e){this.lisners={},this.isFalled=!1,this.isBookedFalling=!1,this.hasJumpedOut=!1,this.cjsObjects=[],this.cjsClick=null,this.cjsCloud=null,this.cjsBitmap=null,this.cjsPolygon=null,this.cjsBounds=null,this.physicsBody=null,this.sendOperationTimer=-1,this.isMoved=!1,this.isForced=!1,Object.assign(this,e),this.scale?(this.width=this.pathData.width*this.scale,this.height=this.pathData.height*this.scale):this.width?(this.scale=this.width/this.pathData.width,this.height=this.pathData.height*this.scale):this.height?(this.scale=this.height/this.pathData.height,this.width=this.pathData.width*this.scale):this.scale=1;const t=new b2BodyDef;if(t.type=b2_staticBody,t.position.Set(this.x/se,this.y/se),this.physicsBody=this.world.CreateBody(t),Object.assign(this.physicsBody,{x:0,y:0,vx:0,vy:0,angle:0,vangle:0,teleportX:0,shakeCount:0,rotateCount:0,name:this.name,vangleDirection:0,onAnimationEnd:null,animater:new kt(this.physicsBody)}),this.pathData){const e=this.scale/se,t=e*(this.pathData.width/2),n=e*(this.pathData.height/2);this.pathData.shapes.forEach(i=>{switch(i.type){case"circle":{const s=new b2CircleShape;s.radius=e*i.r,s.position=new b2Vec2(e*i.cx-t,e*i.cy-n);const o=new b2FixtureDef;o.density=i.density,o.friction=pe,o.restitution=ge,o.shape=s,this.physicsBody.CreateFixtureFromDef(o);break}case"path":{const{path:s}=i,o=new b2PolygonShape,a=Math.floor(s.length/2);a>me&&Ke.log("フィクスチャに指定できる頂点の限界数を超えています。");for(let i=0;i<a;i+=1)o.vertices[i]=new b2Vec2(e*s[2*i+0]-t,e*s[2*i+1]-n);const r=new b2FixtureDef;r.density=i.density,r.friction=pe,r.restitution=ge,r.shape=o,this.physicsBody.CreateFixtureFromDef(r);break}}})}else{const e=new b2PolygonShape,t=this.width/2/se,n=this.height/2/se;e.SetAsBoxXYCenterAngle(t,n,new b2Vec2(0,0),0);const i=new b2FixtureDef;i.density=he,i.friction=pe,i.restitution=ge,i.shape=e,this.physicsBody.CreateFixtureFromDef(i)}return w&&(this.cjsBounds=new createjs.Shape,this.stage.addChild(this.cjsBounds),this.cjsObjects.push(this.cjsBounds)),this.image&&!this.isField&&this.isOperable&&(this.cjsClick=new createjs.Shape,this.cjsClick.isClickObject=!0,this.cjsClick.set({x:0,y:0}),this.cjsClick.graphics.beginFill("#ffffff").rect(0,0,this.image.naturalWidth,this.image.naturalHeight),this.cjsObjects.push(this.cjsClick)),this.image&&(this.cjsBitmap=new createjs.Bitmap(this.image),this.cjsBitmap.set({x:this.x,y:this.y,scaleX:this.width/this.image.naturalWidth,scaleY:this.width/this.image.naturalWidth,regX:Math.floor(this.image.naturalWidth/2),regY:Math.floor(this.image.naturalHeight/2),hitArea:this.cjsClick}),this.stage.addChild(this.cjsBitmap),this.cjsObjects.push(this.cjsBitmap)),w&&(this.cjsPolygon=new createjs.Shape,this.cjsPolygon.set({x:this.x,y:this.y,regX:Math.floor(this.width/2),regY:Math.floor(this.height/2)}),this.stage.addChild(this.cjsPolygon),this.cjsObjects.push(this.cjsPolygon),this.refreshStroke(!1)),this.isField||(this.isOperable&&(this.sendOperation(),this.setupDragEvent(this.cjsBitmap)),this.cjsCloud=new createjs.Bitmap(this.cloudImage),this.cjsCloud.cloudAnimater=new kt(this.cjsCloud),this.cjsCloud.set({x:this.x,y:this.y,originX:this.x,originY:this.y,regX:Math.floor(this.cloudImage.naturalWidth/2),regY:Math.floor(this.cloudImage.naturalHeight/2),scale:.8,alpha:1}),this.stage.addChild(this.cjsCloud),this.cjsObjects.push(this.cjsCloud),this.cjsCloud.cloudAnimater.addAnim({scale:1,alpha:0},be,()=>{this.stage.removeChild(this.cjsCloud),this.cjsCloud=null}),this.physicsBody.teleportX=Oe,Qe({body:this.physicsBody,x:this.physicsBody.teleportX})),this.tick(!0),this}setupDragEvent(){let e,t,n,i=!1;this.cjsBitmap.cursor="pointer",this.lisners.onmousedown=this.cjsBitmap.on("mousedown",()=>{this.needsOperate()&&(t=this.stage.mouseX-this.cjsBitmap.x,this.physicsBody.SetAwake(!0),e=st(),i=!0,n=this.stage.mouseX)}),this.lisners.onpressmove=this.cjsBitmap.on("pressmove",()=>{if(this.needsOperate()&&i){const e=this.stage.mouseX-t-this.canvasDetail.padding.x;Je({body:this.physicsBody,x:e/se+this.physicsBody.teleportX}),this.isMoved=!0}}),this.lisners.onpressup=this.cjsBitmap.on("pressup",()=>{i&&this.isMovable()&&(n===this.stage.mouseX&&st()-e<200&&this.rotate(),i=!1)})}removeDragEvent(){this.cjsBitmap.cursor="",this.cjsBitmap.off("mousedown",this.lisners.onmousedown),this.cjsBitmap.off("pressmove",this.lisners.onpressmove),this.cjsBitmap.off("pressup",this.lisners.onpressup)}refreshStroke(e){const t=e?"rgba(255, 100, 0, 1)":"rgba(0, 100, 255, 1)",n=e?"rgba(255, 100, 0, 0.5)":"rgba(0, 100, 255, 0.5)";if(this.pathData){this.cjsPolygon.graphics.clear().beginFill(n).setStrokeStyle(ue),this.pathData.shapes.forEach(e=>{switch(e.type){case"circle":this.cjsPolygon.graphics.beginStroke(t).drawCircle(this.scale*e.cx,this.scale*e.cy,this.scale*e.r).endStroke();break;case"path":{this.cjsPolygon.graphics.beginStroke(t);const{path:n}=e,i=Math.floor(n.length/2);for(let e=0;e<=i;e+=1){const t=0===e?"moveTo":"lineTo",s=e<i?e:0,o=n[2*s+0]*this.scale,a=n[2*s+1]*this.scale;this.cjsPolygon.graphics[t](o,a)}this.cjsPolygon.graphics.endStroke();break}}});const e="rgba(255, 100, 0, 1)",i={x:this.width/2,y:this.height/2};this.cjsPolygon.graphics.beginStroke(e).setStrokeStyle(6).moveTo(i.x-10,i.y).lineTo(i.x+10,i.y).endStroke().beginStroke(e).moveTo(i.x,i.y-10).lineTo(i.x,i.y+10).setStrokeStyle(ue).endStroke();const s="rgba(255, 0, 255, 1)",o=-this.physicsBody.GetAngle(),a=Math.sin(o),r=Math.cos(o),c={x:this.scale*this.pathData.gCenter.x,y:this.scale*this.pathData.gCenter.y},l=e=>({x:-a*e.y+r*e.x,y:a*e.x+r*e.y}),u=l({x:0,y:100}),d=l({x:-5,y:90}),h=l({x:5,y:90});this.cjsPolygon.graphics.beginFill(s).drawCircle(c.x,c.y,6).beginStroke(s).moveTo(c.x,c.y).lineTo(c.x+u.x,c.y+u.y).endStroke().beginStroke(s).moveTo(c.x+u.x,c.y+u.y).lineTo(c.x+d.x,c.y+d.y).endStroke().beginStroke(s).moveTo(c.x+u.x,c.y+u.y).lineTo(c.x+h.x,c.y+h.y).endStroke();const p=Math.min(0,c.x+u.x),g=Math.min(0,c.y+u.y),m=Math.max(this.width,c.x+Math.abs(u.x)),f=Math.max(this.height,c.y+Math.abs(u.y));this.cjsPolygon.cache(p-ue,g-ue,m+2*ue,f+2*ue)}else this.cjsPolygon.graphics.clear().beginFill(n).setStrokeStyle(ue).beginStroke(t).drawRect(0,0,this.width,this.height).endStroke(),this.cjsPolygon.cache(0-ue,0-ue,this.width+2*ue,this.height+2*ue)}calcLeftTime(){const e=st()-this.timeCreate;return 1e3*this.timeLimit-e}tick(e){this.cjsCloud&&this.cjsCloud.cloudAnimater.tick();const t=e||this.needsRedraw();if(t){const e=this.physicsBody.GetPosition().x-this.physicsBody.teleportX,{y:t}=this.physicsBody.GetPosition(),n={x:e*se+this.canvasDetail.padding.x,y:t*se+this.canvasDetail.padding.y+this.scroller.getProperty("y"),rotation:We(this.physicsBody.GetAngle())};if(this.cjsBitmap&&this.cjsBitmap.set(n),this.cjsCloud&&this.cjsCloud.set({x:this.cjsCloud.originX+this.canvasDetail.padding.x,y:this.cjsCloud.originY+this.canvasDetail.padding.y+this.scroller.getProperty("y"),rotation:0}),this.cjsPolygon&&(this.cjsPolygon.set(n),this.refreshStroke(this.physicsBody.isAwake)),this.cjsBounds){const e=(this.cjsBitmap||this.cjsPolygon).getTransformedBounds();this.cjsBounds.x=e.x,this.cjsBounds.y=e.y,this.cjsBounds.graphics.clear().beginFill("rgba(100, 255, 0, 0.2)").setStrokeStyle(ue).beginStroke("rgba(100, 255, 0, 1)").drawRect(0,0,e.width,e.height).endStroke(),this.cjsBounds.cache(0-ue,0-ue,e.width+2*ue,e.height+2*ue)}}return this.saveTransform(),t}saveTransform(){Object.assign(this.physicsBody,{angle:this.physicsBody.GetAngle(),x:this.physicsBody.GetPosition().x,y:this.physicsBody.GetPosition().y,vx:this.physicsBody.GetLinearVelocity().x,vy:this.physicsBody.GetLinearVelocity().y,vangle:this.physicsBody.GetAngularVelocity()})}needsRedraw(){let e=!0;this.physicsBody.angle===this.physicsBody.GetAngle()&&this.physicsBody.x===this.physicsBody.GetPosition().x&&this.physicsBody.y===this.physicsBody.GetPosition().y&&(e=!1);const t=e!==this.physicsBody.isAwake;return this.physicsBody.isAwake=e,this.scroller.isUpdate||e||t||this.physicsBody.animater.isUpdate||this.cjsCloud}move(e){this.isMoved=!0;const t=this.physicsBody.GetPosition().x+e;this.physicsBody.animater.addAnim({x:t},we,{isOverwrite:!0})}createOperation(e){const t={};return e?(t.x=this.physicsBody.GetPosition().x,t.y=this.physicsBody.GetPosition().y,t.angle=this.physicsBody.GetAngle()):(t.x=this.physicsBody.animater.getTargetProperty("x"),t.y=this.physicsBody.animater.getTargetProperty("y"),t.angle=this.physicsBody.animater.getTargetProperty("angle")),t.uid=this.ownerUid,e&&(t.isDown=e),this.isForced&&(t.isForced=this.isForced),t}sendOperation(){if(this.sendOperationTimer=setTimeout(()=>{this.sendOperation()},Ee),this.needsOperate()&&this.isMoved&&this.isOnline){const e=this.createOperation(!1);this.app.network.sendOperation(this.stepCount,e),this.isMoved=!1}}isMovable(){return!this.isFalled&&!this.isBookedFalling}needsOperate(){return this.isOperable&&this.isMovable()}setDynamic(){this.physicsBody.SetType(b2_dynamicBody)}setStatic(){this.physicsBody.SetType(b2_staticBody)}teleport(){Qe({body:this.physicsBody,x:Oe})}drop(){if(document.getElementById("ope-button-outer").style.setProperty("display","none"),this.leftTimeElm.textContent="",0===this.physicsBody.animater.queue.length){const e=this.createOperation(!0);Je({body:this.physicsBody,x:e.x,y:e.y,angle:e.angle}),Qe({body:this.physicsBody,x:-this.physicsBody.teleportX}),this.physicsBody.teleportX=0,this.physicsBody.SetType(b2_dynamicBody),this.isFalled=!0,this.removeDragEvent(),clearTimeout(this.sendOperationTimer),this.isOnline&&this.isOperable&&this.app.network.sendOperation(this.stepCount,e),this.app.sound.play(C)}else this.isBookedFalling=!0,this.physicsBody.animater.onComplete=()=>{this.drop()}}rotate(){this.isMoved=!0,this.physicsBody.rotateCount+=1;const e=ze(this.physicsBody.rotateCount/8*360);this.physicsBody.animater.addAnim({angle:e},we,{isOverwrite:!0}),this.app.sound.play(B)}initShakeCount(){this.physicsBody.shakeCount=0}pushTo(e){return this.panels=e,this.index=e.length,e.push(this),this}remove(){this.world.DestroyBody(this.physicsBody),this.cjsObjects.forEach(e=>{this.stage.removeChild(e)});for(let e=this.index+1;e<this.panels.length;e+=1)this.panels[e].index-=1;this.panels.splice(this.index,1)}jumpOut(){this.hasJumpedOut=!0,this.setStatic(),this.teleport(),this.app.sound.play(I)}}const{createjs:Ot,b2AABB:At,b2World:jt,b2Vec2:St}=window,{logger:Tt}=s;let It,Bt,Ct,Pt,Lt,Mt,Dt,Nt;const Rt=new kt({y:0}),_t=[];let $t,Gt,Ut,Ft=0;const Ht=[],Vt={},qt=[];let Wt,zt,Yt,Xt,Kt,Jt,Qt,Zt,en,tn,nn=!1,sn=!1,on=!1,an=ee,rn=0;function cn(e){tn=e}function ln(){return b?x:Wt}function un(){Wt=rt().date}function dn(){Wt=rt().unix}function hn(e){an=void 0===e?ee:e}function pn(e){Wt=e}function gn(e){sn=e}function mn(e){nn=e}function fn(e){$t=e}function yn(e){const t=J*Q.length,n=(e+t)%t;return Math.floor(n/J)}function wn(){return $t[Nt].uid===tn.network.getOwnUid()}function bn(){return!!y||(!sn||wn())}function vn(){let e=Te;_t.forEach(t=>{const n=t.cjsBitmap.getTransformedBounds().y-Rt.getProperty("y")-tn.view.canvasDetail.padding.y;n<e&&(e=n)}),e=Math.floor(e);const t={body:null,ReportFixture(e){this.body=e.body}},n=new At;if(e<Te)for(let i=0;i<300;i+=1)if(e+=1,n.lowerBound.Set(-300/se,e/se),n.upperBound.Set((G+300)/se,e/se+.01),It.QueryAABB(t,n),t.body){e+=10;break}return e=Math.min(e,Te),e}function xn(){const e=h;let t=0;e.forEach(e=>{t+=e.frequency});const n=[];for(let e=0;e<t;e+=1)n.push(e);const i=[];for(let s=0;s<t;s+=1){const t=Ut.getRandom(n.length);let s=n[t],o=e[0].id;for(let t=0;t<e.length;t+=1){if(s<e[t].frequency){o=e[t].id;break}s-=e[t].frequency}i.push(o),n.splice(t,1)}return i}function kn(){let e=0;return $t.forEach(t=>{t.life>0&&(e+=1)}),e}function En(){let e="Null";for(let t=0;t<$t.length;t+=1)if($t[t].life>0){e=$t[t].displayName;break}return e}function On(){Ct&&Ct.isOperable&&Ct.isMovable()&&Ct.rotate()}function An(){Ct&&Ct.isOperable&&Ct.isMovable()&&(Ct.drop(),_t.forEach(e=>{e.isField||e.setDynamic()}))}function jn(){Ct.isOperable=!0,Ct.isForced=!0,Ct.ownerUid=tn.network.getOwnUid(),An()}function Sn(e,t){t<Pt||(t>Pt?e.isDown&&Yt.push(e):sn&&e.uid===tn.network.getOwnUid()||Ct&&Ct.isForced||(!Ct||Ct.isMovable()||e.isForced)&&(e.isForced&&(Ct.isOperable=!1,Ct.ownerUid=e.uid),e.isDown?(Ct.physicsBody.animater.stop(),Je({x:e.x,y:e.y,angle:e.angle,body:Ct.physicsBody}),Ct.drop()):Ct.physicsBody.animater.addAnim({angle:e.angle},ke,{isOverwrite:!0}).addAnim({x:e.x,y:e.y},ke),Tt.log("receive operation: %o",e)))}async function Tn(){Dt=!1;const e=vn();0===Pt&&(Jt=e),Mt=_t.length-1;const t=Math.min(Ae,e-je),n=Math.max(0,-t+Se);Rt.addAnim({y:n},ye,{isOverwrite:!0});const i=yn(Pt);i!==Ft&&(qt[i].addAnim({alpha:1},ye,{isOverwrite:!0}),qt[Ft].addAnim({alpha:0},ye,{isOverwrite:!0}),Ft=i);const s=Gt[Pt%Gt.length];let o=h[0];for(let e=0;e<h.length;e+=1)if(s===h[e].id){o=h[e];break}const a=kn();do{Nt=(Nt+1)%$t.length}while($t[Nt].life<=0&&a>=1);Qt.textContent="";const r=Pt+1,c=tn.view.getTranslatedText(o.name);document.getElementById("step-info").innerText=`${r}. ${c}`;const l=st(),u=bn();if(Ct=new Et({name:`${o.name}`,x:X,y:t,scale:o.scale,cloudImage:await Ze("./assets/img/monsters/cloud.png"),image:await Ze(`./assets/img/monsters/${o.name}.png`),pathData:await et(`./assets/img/monsters/${o.name}.svg`),ownerUid:$t[Nt].uid,app:tn,stage:Bt,world:It,scroller:Rt,isOnline:sn,stepCount:Pt,timeLimit:an,timeCreate:l,leftTimeElm:Qt,isOperable:u,canvasDetail:tn.view.canvasDetail}).pushTo(_t),sn&&u&&tn.network.sendOperation(Pt,{isDown:!1}),tn.sound.play(T),sn?wn()?(document.getElementById("ope-button-outer").style.setProperty("display","block"),document.getElementById("ones-turn-outer").style.setProperty("display","none"),tn.view.log("your-turn")):(document.getElementById("turn-name").textContent=$t[Nt].displayName,document.getElementById("ope-button-outer").style.setProperty("display","none"),document.getElementById("ones-turn-outer").style.setProperty("display","block")):document.getElementById("ope-button-outer").style.setProperty("display","block"),Yt.length>0){Sn(Yt.shift(),Pt)}if(on){const e=`000${Pt}`.slice(-3);Sn(Kt[`step-${e}`],Pt)}gt("gamestep",{stepCount:Pt,panelCount:Mt,towerHeight:Lt}),Tt.log(`%cStep ${Pt+1}. ${Xe(o.name)} (${Lt}m)`,Tt.getMarkerStyle("orange")),Tt.log(`Player: ${$t[Nt].displayName} `+`${u?"(Your Turn)":" (Other's Turn)"}`)}function In(e){if(e){const e=$t[Nt];e.life-=1,e.life<=0&&(e.deathOrder=Zt,Zt+=1,Tt.log(`${e.displayName} died!`)),kn()<=1?(gt("gamefinish",{stepCount:Pt,panelCount:Mt,towerHeight:Lt,playerStates:$t,stageCache:en}),Tt.log(`${En()} win!`)):Tn()}else Tn()}function Bn(e){if(!e)return;let t=!1;const n=JSON.parse(e),i=Object.keys(n);Tt.log("receive panelStates: %o",n);for(let e=0;e<_t.length;e+=1){const s=_t[e],o=`${s.stepCount}`;if(!s.isField&&i.indexOf(o)>-1){const i=n[o];i.j?(s.hasJumpedOut||tn.sound.play(I),t=!0,Ke.log(`${s.name} jumped out!`),s.remove(),e-=1):(s.hasJumpedOut=!1,s.setStatic(),Je({body:s.physicsBody,x:i.x,y:i.y,angle:i.a}))}}Dt=!0,Pt+=1;const s=Ct.hasJumpedOut?xe:ve;setTimeout(()=>{In(t)},s),Bt.update(),Ct=null;const o=tn.view.canvasDetail;Bt.cache(o.padding.x,o.padding.y,o.originWidth,o.originHeight),en=Bt.getCacheDataURL(),Bt.uncache(),Lt=Ye((Jt-vn())/oe,2)}function Cn(){const e={};return _t.forEach(t=>{t.isField||(e[t.stepCount]={a:t.physicsBody.GetAngle(),x:t.physicsBody.GetPosition().x,y:t.physicsBody.GetPosition().y,j:t.hasJumpedOut})}),e}function Pn(){if(Tt.log("all bodies sleep"),Pt+=1,!sn){let e=!1;for(let t=0;t<_t.length;t+=1){const n=_t[t];n.initShakeCount(),n.hasJumpedOut&&(e=!0,Ke.log(`${n.name} jumped out!`),n.remove(),t-=1)}nn?Tn():In(e)}}function Ln(){Q.forEach((e,t)=>{Ht[t].graphics.clear().beginLinearGradientFill(e,[0,.5,1],0,Xt.height,0,0).drawRect(0,0,Xt.width,Xt.height),Ht[t].cache(0,0,Xt.width,Xt.height)}),Vt.boat.set({x:Math.floor(.5*Xt.width),y:Math.floor(.4*Xt.height),regX:Math.floor(Vt.boat.image.naturalWidth/2),regY:Math.floor(Vt.boat.image.naturalHeight/2),scale:.7,alpha:.4}),Vt.rock.set({x:Math.floor(.5*Xt.width),y:Math.floor(.25*Xt.height),regX:Math.floor(Vt.rock.image.naturalWidth/2),regY:Math.floor(Vt.rock.image.naturalHeight/2),scale:.7,alpha:.6})}function Mn(){It.Step(re,ce,le),_t.forEach(e=>{const t=e.physicsBody;if(t.animater.tick(),!1===t.isAwake)return;t.GetPosition().y>Be&&(e.hasJumpedOut||e.jumpOut());const n=t.GetLinearVelocity();let i=t.GetAngularVelocity();const s=i>=0?1:-1;0!==t.vangleDirection&&t.vangleDirection!==s&&(t.shakeCount+=1),t.vangleDirection=s;const o=0!==t.vy&&0===t.vx&&0===t.vangle,a=0!==n.x||0!==i||t.vy>n.y;o&&a?(n.x*=Ce,n.y*=Ce,i*=Ce):0!==i&&t.shakeCount>=Pe&&(i*=Le),n.y=Math.min(de,n.y),t.SetLinearVelocity(n),t.SetAngularVelocity(i)})}function Dn(e){let t=!!e.needsRedraw;if(Mn(),t=Rt.tick()||t,qt.forEach(e=>{t=e.tick()||t}),_t.forEach(e=>{t=e.tick()||t}),t&&Bt.update(),Ct&&Ct.isFalled&&!t)if(sn&&!Dt&&Ct.isOperable){const e=Cn();tn.network.sendPanelStates(e),Dt=!0}else if(!sn){const e=Ct.hasJumpedOut?xe:ve;setTimeout(()=>{Pn()},e),Bt.update(),Ct=null;const t=tn.view.canvasDetail;Bt.cache(t.padding.x,t.padding.y,t.originWidth,t.originHeight),en=Bt.getCacheDataURL(),Bt.uncache(),Lt=Ye((Jt-vn())/oe,2)}if(an>0&&Ct&&Ct.needsOperate()){const e=Ct.calcLeftTime(),t=Math.max(0,Math.ceil(e/1e3));t!==rn&&(Qt.setAttribute("time",t),Qt.classList.remove("animation"),setTimeout(()=>{Qt.classList.add("animation"),Qt.textContent=t},17)),e<=0&&Ct.drop(),rn=t}}async function Nn(){const e=f&&"firefox"===lt()?30:ae;It=new jt(new St(0,e)),window.world=It,Xt=document.getElementById(R),tn.storage.get("settings").isEnabledStageGL?(Bt=new Ot.StageGL(Xt),Bt.setClearColor(K)):Bt=new Ot.Stage(Xt),Xt.stage=Bt,Bt.enableMouseOver(),Ot.Touch.isSupported()&&Ot.Touch.enable(Bt),ie?(Ot.Ticker.timingMode=Ot.Ticker.TIMEOUT,Ot.Ticker.framerate=ne):ne>=60?Ot.Ticker.timingMode=Ot.Ticker.RAF:(Ot.Ticker.timingMode=Ot.Ticker.RAF_SYNCHED,Ot.Ticker.framerate=ne);for(let e=0;e<Q.length;e+=1)Ht[e]=new Ot.Shape,Ht[e].alpha=0===e?1:0,qt[e]=new kt(Ht[e]),Bt.addChild(Ht[e]);const t=await Ze("./assets/img/back/boat.png"),n=new Ot.Bitmap(t);Bt.addChild(n),Vt.boat=n;const i=await Ze("./assets/img/back/rock.png"),s=new Ot.Bitmap(i);Bt.addChild(s),Vt.rock=s,Ln(),Bt.update(),mt("canvasresize.stage",e=>{Bt instanceof Ot.StageGL&&Bt.updateViewport(e.detail.width,e.detail.height),_t.forEach(e=>{e.tick(!0)}),Ln(),Bt.update()}),Tt.log("%cGame initialized",Tt.getMarkerStyle("skyblue"))}function Rn(){for(;_t[0];)_t[0].remove();Rt.addAnim({y:0},ye,{isOverwrite:!0}),0!==Ft&&(qt[0].addAnim({alpha:1},ye,{isOverwrite:!0}),qt[Ft].addAnim({alpha:0},ye,{isOverwrite:!0})),Ct=null,Pt=0,Lt=0,Mt=0,Nt=-1,zt=!0,Ft=0,Yt=[],rn=0,Zt=0,Qt&&(Qt.textContent=""),Ot.Ticker.reset(),Dn({needsRedraw:!0}),Tt.log("%cGame finished",Tt.getMarkerStyle("skyblue"))}async function _n(e){if(zt||Rn(),e){const t=[];Object.keys(e.orders).forEach(n=>{const i=e.orders[n],s=parseInt(n.split("-")[1],10);t[s]={uid:i,displayName:e.members[i].displayName,photoURL:e.members[i].photoURL}}),fn(t),pn(e.seed),mn(!1)}for(let e=0;e<$t.length;e+=1)$t[e].life=te,$t[e].deathOrder=$t.length-1;const t=ln();Ut=new vt(t),Qt=document.getElementById("left-time"),Gt=xn(),new Et({name:"floor",x:X,y:Te,width:Ie,isField:!0,image:await Ze("./assets/img/monsters/field.png"),pathData:await et("./assets/img/monsters/field.svg"),app:tn,canvasDetail:tn.view.canvasDetail,stage:Bt,world:It,scroller:Rt}).pushTo(_t),Tn(),zt=!1,Ot.Ticker.on("tick",Dn),gt("gamebegin",{seed:t}),Tt.log(`Seed: ${t}`),Tt.log(`Monster Tiles: ${JSON.stringify(Gt)}`),Tt.log(`Player Names: ${JSON.stringify($t)}`),Tt.log("%cGame begined",Tt.getMarkerStyle("skyblue"))}function $n(e){Ct&&Ct.isOperable&&!Ct.isFalled&&Ct.move(e)}function Gn(e){sn=!1,nn=!0,$t=[{uid:"1P",displayName:"1P"},{uid:"2P",displayName:"2P"}],Wt=e.seed,Kt=e.operations,on=!0,_n()}function Un(){_n()}function Fn(){dn(),_n()}const Hn={label:"loading",async enter(){let e=0;const t=document.getElementById("loaded-count"),n=["./assets/img/forcss/volume-0.png","./assets/img/forcss/volume-1.png","./assets/img/forcss/volume-2.png","./assets/img/forcss/volume-3.png","./assets/img/forcss/mask-hooked.png","./assets/img/forcss/mask-holed.png","./assets/img/forcss/mask-chipped.svg","./assets/img/forcss/wave-1.png"],i=n.length+2*h.length;function s(){e+=1;Math.floor(100*e/i);t.textContent=`${e}/${i}`}this.app.view.showLoading();for(let e=0;e<n.length;e+=1)await Ze(n[e]),s();for(let e=0;e<h.length;e+=1)await Ze(`./assets/img/monsters/${h[e].name}.png`),s(),await et(`./assets/img/monsters/${h[e].name}.svg`),s();setTimeout(()=>{t.parentNode.removeChild(t),this.app.view.hideLoading(),this.app.view.firstJump()},100)},leave(){}},Vn={label:"title",bgm:"gogo.mp3",enter(){if(this.append({id:"sign-state-container",class:"sign-state-container",contents:[{id:"connecting",class:"sign-state",style:{display:"none"},contents:[{text:"connecting",class:"sign-state-connecting"}]},{id:"signed-in",class:"sign-state",style:{display:"none"},contents:[{tag:"img",src:"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7",class:"sign-state-photo",onclick:()=>{this.app.view.alert({title:"sign-out",message:"sign-out-heads-up",ok:()=>{this.app.network.signOut()}})}},{class:"sign-state-name"}]},{id:"sign-in",class:"sign-state clickable",style:{display:"none"},contents:[{text:"sign-in-with-twitter",class:"sign-state-sign-in",onclickonce:()=>{this.app.network.signIn()}}]}]}),this.append({id:"title-logo",class:"title-logo",contents:[{text:"logo-salmon",class:"title-logo-salmon"},{text:"logo-tower-battle",class:"title-logo-tower-battle"}]}),this.append({id:"play-in-offline",class:"title-button clickable",jump:"offline-game",contents:[{class:"title-button-back"},{text:"play-in-offline",class:"title-button-content shadow-text"},{text:"play-in-offline-footer",class:"title-button-footer shadow-text"}]}),this.append({id:"create-private-room",class:"title-button clickable",onclick:()=>{"signed-in"===this.app.network.getSignState()?this.app.view.jump("private-room"):this.app.view.alert({title:"heads-up",message:"private-room-not-signed-in"})},contents:[{class:"title-button-back"},{text:"private-room",class:"title-button-content shadow-text"},{text:"create-private-room-footer",class:"title-button-footer shadow-text"}]}),this.append({id:"settings",class:"title-button clickable",jump:"settings",contents:[{class:"title-button-back"},{text:"settings",class:"title-button-content shadow-text"},{text:"settings-footer",class:"title-button-footer shadow-text"}]}),this.append({text:`Ver.${this.constants.APP_VERSION}`,class:"title-version"}),!document.getElementById("speaker")){const{app:e}=this,{globalVolume:t}=e.storage.get("settings");this.append({layer:"fix",id:"speaker",class:`speaker volume-${t}`,attr:{volume:t},onclick(){const t=parseInt(this.getAttribute("volume"),10),n=(t+4+1)%4;this.setAttribute("volume",n),this.classList.remove(`volume-${t}`),this.classList.add(`volume-${n}`),e.sound.changeVolume(n)}}),document.title=this.app.view.getTranslatedText("title")}if("connecting"===this.app.network.getSignState())this.utilities.addDocumentEventListener("authstatechange",e=>{document.getElementById("connecting").style.setProperty("display","none"),this.updateSignState(e.detail)}),document.getElementById("connecting").style.setProperty("display","block");else{const e=this.app.network.getOwnUserData();this.updateSignState(e)}},updateSignState(e){e?(document.getElementById("signed-in").style.setProperty("display","block"),document.querySelector(".sign-state-photo").setAttribute("src",e.photoURL),document.querySelector(".sign-state-name").textContent=e.displayName):document.getElementById("sign-in").style.setProperty("display","block")},leave(){this.utilities.removeDocumentEventListener("authstatechange")}},qn={label:"private-room",async createRoom(){this.app.view.clearLayer("main"),this.app.view.showLoading();const e=await this.app.network.createRoom("private");this.app.view.jump("wait-online-game",{roomId:e,isHost:!0}),this.app.view.hideLoading()},async enter(){this.app.view.showLoading();const e=(await this.app.network.getOwnUserDataNewly()).ownPrivateRoom,t=this.utilities.getQueries().invite;this.app.view.hideLoading(),e||this.append({class:"spiky-button",text:"create-private-room",onclick:()=>{e?this.app.view.alert({title:"heads-up",message:"create-private-room-caution",ok:()=>{this.createRoom()}}):this.createRoom()}}),e&&(this.append({class:"spiky-button",text:"go-to-own-private-room",onclick:()=>{this.app.view.jump("wait-online-game",{roomId:e,isHost:!0})}}),this.append({class:"spiky-button danger",text:"destroy-own-private-room",onclick:()=>{this.app.view.alert({title:"heads-up",message:"destroy-private-room-caution",ok:async()=>{this.app.view.clearLayer("main"),this.app.view.showLoading(),await this.app.network.destroyRoom("private",e),this.app.view.hideLoading(),this.app.view.jump("private-room")}})}})),t&&this.append({class:"spiky-button",text:"go-to-invited-private-room",onclick:()=>{this.app.view.jump("wait-online-game",{roomId:t,isHost:!1})}}),this.append({class:"return-title-lb",text:"exit",jump:"title"})},leave(){}},Wn={label:"sign-in",enter(){const e={layer:0,x:"50%",width:600,centering:!0,style:{color:"#000000",position:"absolute","font-size":"60px","line-height":"100%",margin:"0","text-align":"center"}};this.append("div","sign-in-with-twitter",e,{y:100,onclick:()=>{}}),this.append("div","go-title",e,{y:200,jump:"title"})},leave(){}},zn={label:"settings",enter(){function e(e){const t=e.parentNode.childNodes;Array.prototype.forEach.call(t,e=>{e.classList.remove("selected")}),e.classList.add("selected")}const{app:t}=this;this.append({text:"webgl-desc",class:"config-desc"}),this.append({class:"config-line",contents:[{text:"WebGL",class:"config-line-content"},{class:"config-line-item-container",contents:[{id:"webgl-off",text:"OFF",class:"config-line-item config-webgl",onclick(){e(this),t.storage.get("settings").isEnabledStageGL=!1,t.storage.save("settings")}},{id:"webgl-on",text:"ON",class:"config-line-item config-webgl",onclick(){e(this),t.storage.get("settings").isEnabledStageGL=!0,t.storage.save("settings")}}]}]}),this.append({text:"lang-desc",class:"config-desc"}),this.append({class:"config-line",contents:[{text:"language",class:"config-line-content"},{class:"config-line-item-container",contents:[{id:"lang-ja",text:"日本語",class:"config-line-item config-lang",onclick(){e(this),t.storage.get("settings").language="ja",t.storage.save("settings"),t.view.jump("settings")}},{id:"lang-en",text:"English",class:"config-line-item config-lang",onclick(){e(this),t.storage.get("settings").language="en",t.storage.save("settings"),t.view.jump("settings")}}]}]});const n=[];n.push(this.app.storage.get("settings").isEnabledStageGL?"webgl-on":"webgl-off"),n.push("ja"===this.app.storage.get("settings").language?"lang-ja":"lang-en"),n.forEach(e=>{document.getElementById(e).classList.add("selected")}),this.append({text:"戻る",class:"return-title-lb",jump:"title"})},leave(){}},Yn={label:"invite",bgm:"gogo.mp3",async enter(){this.app.view.showLoading();const e=this.app.network.getOwnUserData();if(void 0!==e){if(this.app.view.hideLoading(),null===e)this.enterNotSignedIn();else{const e=this.utilities.getQueries().invite,t=await this.app.network.getRoom("private",e);t?this.enterInvatation(t,e):this.enterInvalidInvatation()}if(!document.getElementById("speaker")){const{app:e}=this,{globalVolume:t}=e.storage.get("settings");this.append({layer:"fix",id:"speaker",class:`speaker volume-${t}`,attr:{volume:t},onclick(){const t=parseInt(this.getAttribute("volume"),10),n=(t+4+1)%4;this.setAttribute("volume",n),this.classList.remove(`volume-${t}`),this.classList.add(`volume-${n}`),e.sound.changeVolume(n)}})}this.append({class:"return-title-lb",text:"exit",jump:"title"})}else this.utilities.addDocumentEventListener("authstatechange",()=>{this.utilities.removeDocumentEventListener("authstatechange"),this.enter()})},enterNotSignedIn(){this.append({id:"invite-card-not-signed",class:"invite-card",contents:[{class:"invite-card-back"},{text:"invitation-not-signed-in",class:"invite-message"},{text:"sign-in-with-twitter",class:"invite-sign-in-button",onclick:()=>{this.app.network.signIn()}}]})},enterInvalidInvatation(){this.append({id:"invite-card-not-signed",class:"invite-card",contents:[{class:"invite-card-back"},{text:"invitation-invalid",class:"invite-message"}]})},enterInvatation(e,t){this.append({id:"invite-card",class:"invite-card",contents:[{class:"invite-card-back"},{tag:"img",src:e.ownerUser.photoURL,class:"invite-photo"},{text:"invitation",innerSpanText:e.ownerUser.displayName,class:"invite-message"},{text:"join",class:"invite-join-button",onclick:async()=>{this.app.view.jump("wait-online-game",{roomId:t,isHost:!1})}}]})},leave(){}},Xn={label:"offline-game",enter(){this.append({class:"game-random-seed",contents:[{tag:"span",text:"offline-seed"},{tag:"span",class:"count"}]}),this.append({class:"game-panel-count",contents:[{tag:"span",text:"offline-salmonids"},{tag:"span",class:"count"}]}),this.append({class:"game-tower-height",contents:[{tag:"span",text:"offline-height"},{tag:"span",class:"count"}]}),this.append({id:"left-time",class:"left-time"}),this.append({id:"step-info",class:"step-info"}),this.append({id:"ope-button-outer",class:"ope-button-outer",contents:[{text:"drop",class:"drop-button",onclick:()=>{this.app.game.execOperationDown()}},{class:"rotate-button",onclick:()=>{this.app.game.execOperationRotate()},contents:[{tag:"img",src:"./assets/img/forcss/rotate.svg"}]}]}),this.append({class:"game-menu-rt",onclick:()=>{document.querySelector(".game-menu-outer").style.setProperty("display","block")}}),this.append({class:"game-menu-outer",style:{display:"none"},contents:[{class:"game-menu-button-outer",contents:[{class:"alert-button",text:"game-start-over",onclick:()=>{this.app.game.startOver(),document.querySelector(".game-menu-outer").style.setProperty("display","none")}},{class:"gemu-menu-button-desc right",text:"game-start-over-desc"}]},{class:"game-menu-button-outer",contents:[{class:"gemu-menu-button-desc left",text:"game-start-again-desc"},{class:"alert-button",text:"game-start-again",onclick:()=>{this.app.game.startAgain(),document.querySelector(".game-menu-outer").style.setProperty("display","none")}}]},{class:"game-menu-button-outer",contents:[{class:"alert-button",text:"game-exit",jump:"title"},{class:"gemu-menu-button-desc right",text:"game-exit-desc"}]},{class:"game-menu-close",text:"close",onclick:()=>{document.querySelector(".game-menu-outer").style.setProperty("display","none")}}]}),this.utilities.addDocumentEventListener("gamebegin",e=>{document.querySelector(".game-random-seed .count").textContent=`${e.detail.seed}`}),this.utilities.addDocumentEventListener("gamestep",e=>{const t=this.app.view.getTranslatedText("salmonid-counter");document.querySelector(".game-tower-height .count").textContent=`${e.detail.towerHeight} m`,document.querySelector(".game-panel-count .count").textContent=`${e.detail.panelCount} ${t}`}),this.app.game.setIsOnline(!1),this.app.game.setIsEndless(!0),this.app.game.setTimeLimit(0),this.app.game.setPlayerStates([{uid:"1P",displayName:"1P"}]),this.app.game.setUnixSeed(),this.app.game.setTodaySeed(),this.app.game.beginGame()},oncanvasresize(e){const t=document.getElementById("createjs-bottom-buttons");t&&(t.style.setProperty("left",`${e.detail.padding.x}px`),t.style.setProperty("bottom",`${e.detail.padding.y}px`),t.style.setProperty("width",`${e.detail.width}px`))},leave(){this.utilities.removeDocumentEventListener("gamebegin"),this.utilities.removeDocumentEventListener("gamestep"),this.app.game.finishGame()}},Kn={label:"online-game",enter(e){this.roomId=e.roomId,this.append({id:"left-time",class:"left-time"}),this.append({id:"step-info",class:"step-info"}),this.append({id:"ope-button-outer",class:"ope-button-outer",contents:[{text:"drop",class:"drop-button",onclick:()=>{this.app.game.execOperationDown()}},{class:"rotate-button",onclick:()=>{this.app.game.execOperationRotate()},contents:[{tag:"img",src:"./assets/img/forcss/rotate.svg"}]}]}),this.append({id:"ones-turn-outer",class:"ope-button-outer",style:{display:"none"},contents:[{class:"turn-title selectable",text:"ones-turn"}]}),e.isHost&&(this.append({class:"game-menu-rt",onclick:()=>{document.getElementById("game-menu-rt").style.setProperty("display","block")}}),this.append({id:"game-menu-rt",class:"game-menu-outer",style:{display:"none"},contents:[{class:"game-menu-button-outer",contents:[{class:"gemu-menu-button-desc left",text:"game-online-forced-drop-desc"},{class:"alert-button",text:"game-online-forced-drop",onclick:()=>{this.app.game.execOperationDownForcibly(),document.getElementById("game-menu-rt").style.setProperty("display","none")}}]},{class:"game-menu-button-outer",contents:[{class:"alert-button",text:"game-online-exit",onclick:()=>{this.app.network.finishGame("private",e.roomId)}},{class:"gemu-menu-button-desc right",text:"game-online-exit-desc"}]},{class:"game-menu-close",text:"close",onclick:()=>{document.getElementById("game-menu-rt").style.setProperty("display","none")}}]}));const t=e.isHost?{class:"game-result-return",text:"result-return",onclick:()=>{document.getElementById("game-result").style.setProperty("display","none"),this.app.network.finishGame("private",e.roomId)}}:null,n=e.isHost?{class:"game-result-again",text:"result-again",onclick:()=>{document.getElementById("game-result").style.setProperty("display","none"),this.app.network.againGame("private",e.roomId)}}:null;this.append({id:"game-result",class:"game-menu-outer",style:{display:"none","padding-left":`${this.app.view.canvasDetail.padding.x}px`,"padding-top":`${this.app.view.canvasDetail.padding.y}px`},contents:[{class:"game-result-container",contents:[{class:"result-detail",contents:[{class:"result-fall-count-desc",text:"result-fall-count-desc"},{class:"result-fall-count"},{class:"result-ride-count-desc",text:"result-ride-count-desc"},{class:"result-ride-count"},{class:"result-height-desc",text:"result-height-desc"},{class:"result-height"}]},{class:"result-win-text",innerHTML:"WIN!"},{tag:"img",class:"result-screen",src:"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7"},{class:"result-winner",contents:[{tag:"img",src:"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7"},{tag:"br"},{tag:"span"}]},{id:"result-players",class:"result-players"},t,n]}]}),this.app.game.setTimeLimit(),this.app.game.setIsOnline(!0),this.app.game.setIsEndless(!1),this.app.game.beginGame(e.room);const i=()=>{this.app.view.alert({title:"heads-up",message:"room-was-destroyed",ok:()=>{this.app.view.jump("title")},onlyok:!0})};this.app.network.setupGaming("private",e.roomId,{onremovemember:(t,n)=>{n!==this.app.network.getOwnUid()?n===e.room.ownerUser.uid&&i():i()},onchangeroomstate:async t=>{if("waiting"===t)this.app.view.jump("wait-online-game",{roomId:e.roomId,isHost:e.isHost,isWaitingGame:!0});else if(t.indexOf("playing")>-1){document.getElementById("game-result").style.setProperty("display","none");const t=await this.app.network.getRoom("private",e.roomId);this.app.game.beginGame(t)}}}),this.utilities.addDocumentEventListener("gamefinish",e=>{const t=document.getElementById("game-result"),n=this.app.view.getTranslatedText("salmonid-counter");t.querySelector(".result-fall-count").textContent=`${e.detail.stepCount} ${n}`,t.querySelector(".result-ride-count").textContent=`${e.detail.panelCount} ${n}`,t.querySelector(".result-height").textContent=`${e.detail.towerHeight} m`,t.querySelector(".result-screen").src=e.detail.stageCache,this.utilities.emptyElement(".result-players");const i=[],s=e.detail.playerStates;s.forEach(e=>{const t=s.length-e.deathOrder-1;i[t]=e}),t.querySelector(".result-winner>img").src=i[0].photoURL,t.querySelector(".result-winner>span").textContent=i[0].displayName;for(let e=1;e<i.length;e+=1)this.append({layer:"result-players",tag:"img",src:i[e].photoURL});t.style.setProperty("display","block")}),window.onbeforeunload=()=>{if(e.isHost)return"いまウィンドウを閉じると、部屋が崩れることになります。よろしいですか？"},window.onunload=()=>{this.app.network.leaveRoom("private",e.roomId)}},leave(e){window.onbeforeunload=null,window.onunload=null,this.utilities.removeDocumentEventListener("gamefinish"),this.app.network.teardownGaming("private",this.roomId),this.app.game.finishGame(),e.isWaitingGame||this.app.network.leaveRoom("private",this.roomId)}},Jn={label:"replay",enter(e){this.append({id:"left-time",class:"left-time"}),this.append({id:"step-info",class:"step-info"}),this.append({id:"ope-button-outer",class:"ope-button-outer",contents:[{text:"drop",class:"drop-button",onclick:()=>{this.app.game.execOperationDown()}},{class:"rotate-button",onclick:()=>{this.app.game.execOperationRotate()},contents:[{tag:"img",src:"./assets/img/forcss/rotate.svg"}]}]}),this.app.game.replayGame(e.room)},leave(){}},Qn={label:"wait-online-game",async enter(e){this.app.view.showLoading(),this.roomId=e.roomId;const t=`${window.location.href.split("?")[0]}?invite=${e.roomId}`,n=e.isHost?"host":"gest";let i;if(i=await this.app.network.getRoom("private",e.roomId)?await this.app.network.joinRoom("private",e.roomId):"room-doesnt-exist",i)return this.app.view.hideLoading(),void this.app.view.alert({title:"heads-up",message:i,ok:()=>{this.app.view.jump("title")},onlyok:!0});e.isHost&&await this.app.network.readyRoom("private",e.roomId),this.app.view.hideLoading(),e.isHost&&this.append({text:"招待URLを見る",class:"show-url-button",onclick:()=>{document.querySelector(".invite-url-outer").style.setProperty("display","block")}}),this.append({id:"room-member-outer",class:`room-member-outer room-member-outer-${n}`});let s=!1;if(e.isHost?this.append({id:"game-start-button",class:"game-start-button",text:"start",style:{display:"block"},onclick:async()=>{if(s)return;s=!0;const t=await this.app.network.getRoom("private",e.roomId),n=Object.keys(t.members);let i=!0;for(let e=0;e<n.length;e+=1){if("waiting"!==t.members[n[e]].state){i=!1;break}}i?this.app.network.beginGame("private",e.roomId):this.app.view.alert({title:"heads-up",message:"not-all-waiting"}),s=!1}}):this.append({class:"waiting-start",text:"waiting-game-start"}),this.append({class:"return-title-lb",text:"exit",jump:"title"}),e.isHost){let e=null;this.append({style:{display:"none"},class:"invite-url-outer",contents:[{class:"invite-url-desc",text:"please-share-url"},{id:"invite-url",class:"invite-url",innerHTML:t},{class:"invite-url-copy",text:"copy",onclick:()=>{const n=document.getElementById("invite-url-copied");this.utilities.execCopy(t,"invite-url")&&(clearTimeout(e),n.classList.remove("animation"),e=setTimeout(()=>{n.classList.add("animation")},17))}},{id:"invite-url-copied",class:"invite-url-copied",text:"copied"},{class:"invite-url-close",text:"close",onclick:()=>{window.getSelection().removeAllRanges(),document.getElementById("invite-url-copied").classList.remove("animation"),document.querySelector(".invite-url-outer").style.setProperty("display","none")}}]})}this.app.network.setupWaiting("private",e.roomId,{onaddmember:(t,n)=>{e.isHost&&document.getElementById("game-start-button").style.setProperty("display","block"),this.append({id:n,attr:{state:t.state},layer:"room-member-outer",class:"room-member",contents:[{class:"room-member-back"},{tag:"img",class:"room-member-photo",src:t.photoURL},{class:"room-member-name",innerHTML:t.displayName},{class:"room-member-state",text:t.state}],onclick:()=>{if(e.isHost&&n!==this.app.network.getOwnUid()){const i=t.displayName.length>10?`${t.displayName.substr(0,10)}…`:t.displayName;this.app.view.alert({title:"heads-up",message:"deport-room-member",vars:{name:i},ok:()=>{this.app.network.remove(`private-rooms/${e.roomId}/members/${n}`)}})}}})},onremovemember:(e,t)=>{const n=document.getElementById(t);n&&n.parentNode.removeChild(n),t===this.app.network.getOwnUid()&&this.app.view.alert({title:"heads-up",message:"room-was-destroyed",ok:()=>{this.app.view.jump("title")},onlyok:!0})},onchangeroomstate:async t=>{if(t.indexOf("playing")>-1){const t=await this.app.network.getRoom("private",e.roomId);this.app.view.jump("online-game",{userData:this.app.network.getOwnUserData(),room:t,roomId:e.roomId,isHost:e.isHost,isStartingGame:!0})}},onchangememberstate:(e,t)=>{const n=document.getElementById(t);n&&(n.setAttribute("state",e.state),n.querySelector(".room-member-state").textContent=this.app.view.getTranslatedText(e.state))}}),window.onunload=()=>{this.app.network.leaveRoom("private",e.roomId)}},leave(e){window.onbeforeunload=null,window.onunload=null,this.app.network.teardownWaiting("private",this.roomId),e.isStartingGame||this.app.network.leaveRoom("private",this.roomId)}};var Zn={title:{ja:"サーモンタワーバトル",en:"Salmon Tower Battle"},"logo-salmon":{ja:"サーモン",en:"Salmon"},"logo-tower-battle":{ja:"タワーバトル",en:"Tower Battle"},"sign-in-with-twitter":{ja:"Twitterでログインする",en:"Sign In With Twitter"},"private-room":{ja:"プライベートルーム",en:"Private Room"},"create-private-room-footer":{ja:"フレンドを招待していっしょに遊べる！",en:"You can invite and play with friends!"},"play-in-offline":{ja:"ひとりで遊ぶ",en:"Play by Myself"},"play-in-offline-footer":{ja:"ひとりでとことん練習できる！",en:"You can practice by myself thoroughly!"},settings:{ja:"オプション",en:"Settings"},"settings-footer":{ja:"ゲーム設定を変更する",en:"You can change game settings"},"heads-up":{ja:"注意",en:"HEADS UP"},"private-room-not-signed-in":{ja:"プライベートルームを作るためには<br><b>Twitterでログイン</b>する必要があります",en:"You should <b>sign in with Twitter</b><br>in order to create a private room"},"sign-out":{ja:"ログアウト",en:"SIGN OUT"},"sign-out-heads-up":{ja:"ログアウトします<br>よろしいですか？",en:"Would you like to sign out?"},cool:{ja:"はい！",en:"Cool!"},"not-cool":{ja:"いいえ",en:"Not Cool"},ok:{ja:"はい！",en:"OK!"},"webgl-desc":{ja:"動作が低速または不安定の場合、<br>OFFにすると改善する可能性があります(リロード後に有効)",en:'If your app is slow or unstable, <br>please try setting "OFF" (valid after a reload)'},language:{ja:"言語",en:"Language"},"lang-desc":{ja:"言語を日本語または英語から選ぶことができます",en:"Please choose language from Japanese or English"},exit:{ja:"戻る",en:"Exit"},"create-private-room":{ja:"プライベートルームを作る",en:"Create private room"},"create-private-room-caution":{ja:"いまあるプライベートルームは崩れますが<br>よろしいですか？",en:"Existing room will be destroyed<br>Are you cool with that?"},"destroy-private-room-caution":{ja:"プライベートルームを崩します<br>よろしいですか？",en:"The room will be destroyed<br>Are you cool with that?"},"go-to-own-private-room":{ja:"自分のプライベートルームに行く",en:"Go to my private room"},"destroy-own-private-room":{ja:"自分のプライベートルームを壊す",en:"Destroy my private room"},"go-to-invited-private-room":{ja:"招待されているプライベートルームに行く",en:"Go to room you are invited"},start:{ja:"スタート！",en:"START!"},"please-share-url":{ja:"以下の招待URLを<br>Twitterのともだちに<br>教えてあげてください",en:"Please share this URL<br>with your Twitter friends"},copy:{ja:"コピー",en:"COPY"},copied:{ja:"コピーしました！",en:"Copied!"},close:{ja:"閉じる",en:"Close"},"not-all-waiting":{ja:"待機中ではないメンバーがいます",en:"Some players are not 'waiting'"},"waiting-game-start":{ja:"ホストのゲーム開始を待っています…",en:"Waiting for the host to start the game…"},"room-was-destroyed":{ja:"部屋が崩れました<br>タイトルに戻ります",en:"The room was destroyed<br>Return title"},"deport-room-member":{ja:"%name%<br>を退去させますか？",en:"Would you like to deport<br>%name%?"},waiting:{ja:"待機中",en:"waiting"},playing:{ja:"ゲーム中",en:"playing"},"invitation-not-signed-in":{ja:"招待を受け取るためには<br><b>Twitterでログイン</b>する必要があります",en:"You should <b>sign in with Twitter</b><br>in order to accept a invitation"},invitation:{ja:'<span id="invite-user"></span> さんに招待されています',en:'You\'ve been invited to join by <span id="invite-user"></span>'},"invitation-invalid":{ja:"無効な招待URLです",en:"This invitation URL is invalid"},"room-doesnt-exist":{ja:"部屋が存在しません",en:"The room doesn't exist"},join:{ja:"参加する！",en:"JOIN!"},"error-room-is-full":{ja:"部屋が満員なので<br>部屋に入ることができませんでした",en:"Failed to enter the room<br>because the room is full"},"error-room-is-active":{ja:"ゲームが行われている最中なので<br>部屋に入ることができませんでした",en:"Failed to enter the room<br>because the room is active"},"error-room-versions-dont-match":{ja:"ホストとバージョンが一致しないため<br>部屋に入ることができませんでした",en:"Failed to enter the room<br>because the versions don't match"},connecting:{ja:"接続中…",en:"Connecting…"},"salmonid-counter":{ja:"匹",en:""},"offline-seed":{ja:"シード値",en:"Seed"},"offline-salmonids":{ja:"乗っている数",en:"Remaining"},"offline-height":{ja:"高さ",en:"Height"},"result-fall-count-desc":{ja:"落ちてきた数",en:"Falling"},"result-ride-count-desc":{ja:"最後に乗っていた数",en:"Remaining"},"result-height-desc":{ja:"積み上げた高さ",en:"Height"},"result-return":{ja:"戻る",en:"Return"},"result-again":{ja:"もう一度！",en:"Again!"},drop:{ja:"落下",en:"DROP"},"ones-turn":{ja:'<span id="turn-name"></span>のターン',en:'<span id="turn-name"></span>\'s Turn'},"your-turn":{ja:"あなたのターン！",en:"Your Turn!"},"game-start":{ja:"ゲーム開始！",en:"Game Start!"},"game-start-over":{ja:"やりなおす",en:"Start Over"},"game-start-again":{ja:"リスタート",en:"Start Again"},"game-exit":{ja:"タイトルへ",en:"Exit"},"game-start-over-desc":{ja:"同じシャケ順で<br>やりなおします",en:"Start over<br>with same order"},"game-start-again-desc":{ja:"シャケ順を変えて<br>リスタートします",en:"Start again<br>with different order"},"game-exit-desc":{ja:"ゲームをやめて<br>タイトル画面に戻ります",en:"Quit playing game <br>and Return to title"},"game-online-forced-drop-desc":{ja:"誰のターンであっても<br>強制的に落下させます<br>(ホストのみ)",en:"No matter who's turn<br>Drop forcibly<br>(Host only)"},"game-online-exit-desc":{ja:"ゲームをやめて<br>ルーム画面に戻ります",en:"Quit playing game <br>and Return to room"},"game-online-forced-drop":{ja:"強制落下",en:"Drop forcibly"},"game-online-exit":{ja:"ルームへ",en:"Exit"},chum:{ja:"シャケ",en:"Chum"},cohock:{ja:"ドスコイ",en:"Cohock"},smallfry:{ja:"コジャケ",en:"Smallfry"},maws:{ja:"モグラ",en:"Maws"},scrapper:{ja:"テッパン",en:"Scrapper"},steeleel:{ja:"ヘビ",en:"Steeleel"},steelhead:{ja:"バクダン",en:"Steelhead"},drizzler:{ja:"コウモリ",en:"Drizzler"},flyfish:{ja:"カタパッド",en:"Flyfish"},stinger:{ja:"タワー",en:"Stinger"}};function ei(e){return"number"==typeof e?`${e}px`:e}class ti{constructor(e,t){Object.assign(this,e,t)}getLayer(e){return e in this.layers?this.layers[e]:document.getElementById(e)}append(e){const t=this.createElement(e);this.getLayer(e.layer||"main").appendChild(t)}createElement(e){const t=Object.assign({tag:"div",text:"",style:{},attr:{}},e),n=document.createElement(t.tag);if(t.innerHTML?n.innerHTML=t.innerHTML:t.text&&(n.innerHTML=this.app.view.getTranslatedText(t.text)),t.innerSpanText){const e=n.getElementsByTagName("span")[0];e&&(e.textContent=t.innerSpanText)}return t.id&&n.setAttribute("id",t.id),t.src&&n.setAttribute("src",t.src),t.class&&t.class.split(" ").forEach(e=>{n.classList.add(e)}),t.x&&(t.x=ei(t.x),n.style.setProperty("left",t.x),Object.assign(t.style,{position:"absolute"})),t.y&&(t.y=ei(t.y),n.style.setProperty("top",t.y),Object.assign(t.style,{position:"absolute"})),t.width&&(t.width=ei(t.width),n.style.setProperty("width",t.width)),t.height&&(t.height=ei(t.height),n.style.setProperty("height",t.height)),t.centering&&(n.style.setProperty("left",`calc(${t.x} - (${t.width} / 2))`),n.style.setProperty("top",`calc(${t.y} - (${t.height} / 2))`)),t.style&&Object.keys(t.style).forEach(e=>{n.style.setProperty(e,t.style[e])}),t.attr&&Object.keys(t.attr).forEach(e=>{n.setAttribute(e,t.attr[e])}),t.onclick?(n.classList.add("clickable"),n.addEventListener("click",t.onclick)):t.onclickonce?(n.classList.add("clickable"),n.addEventListener("click",t.onclickonce,{once:!0})):t.jump&&(n.classList.add("clickable"),"string"==typeof t.jump?n.addEventListener("click",()=>{this.app.view.jump(t.jump)},{once:!0}):n.addEventListener("click",()=>{this.app.view.jump(t.jump[0],t.jump[1])},{once:!0})),t.contents&&t.contents.forEach(e=>{if(e){const t=this.createElement(e);n.appendChild(t)}}),n}}let ni={};const ii={},si={};let oi,ai,ri,ci,li=0;const ui={originWidth:0,originHeight:0,targetWidth:0,targetHeight:0,windowWidth:0,windowHeight:0,scale:1,width:0,height:0,margin:{x:0,y:0},padding:{x:0,y:0}};function di(e){ci=e}function hi(){const e=nt(),t=it(),n=t/e,i=G,s=U,o=F;let a,r;const c=Math.max(W,Math.min(z,n));let l,u,d,h,p;c>o?(a=i,r=i*c,l=e/a,u=0,d=Math.floor((t-r*l)/2),h=0,p=Math.floor((r-s)/2)):(a=s*(1/c),r=s,l=t/r,u=Math.floor((e-a*l)/2),d=0,h=Math.floor((a-i)/2),p=0),a=Math.floor(a),r=Math.floor(r),oi.setAttribute("width",a),oi.setAttribute("height",r),Object.assign(ui,{windowWidth:e,windowHeight:t,originWidth:i,originHeight:s,targetWidth:Math.floor(a*l),targetHeight:Math.floor(r*l),width:a,height:r,scale:l,margin:{x:u,y:d},padding:{x:h,y:p}}),ai.style.setProperty("transform",`translateX(${u}px) translateY(${d}px) scale(${l})`),ai.style.setProperty("width",`${a}px`),ai.style.setProperty("height",`${r}px`),gt("canvasresize",ui)}function pi(){clearTimeout(ri),ri=setTimeout(()=>{hi()},$)}function gi(){ci.sound.unlock(),window.removeEventListener("mousedown",gi),oi.removeEventListener("touchstart",gi)}function mi(){window.addEventListener("mousedown",gi),oi.addEventListener("touchstart",gi)}function fi(e){pt(ii[e])}function yi(){D.forEach(e=>{fi(e)})}function wi(e,t={}){const n=(new Date).getTime();if(n-li<_)return;li=n;const i=si[e];i?("function"==typeof ni.leave&&ni.leave(t),fi("main"),i.enter(t),i.bgm&&ci.sound.play(i.bgm,{volume:.3,loop:!0}),ni=i):Ke.error("シーンが定義されていません: %s",e)}function bi(e){return e in Zn&&ci.storage.get("settings").language in Zn[e]?Zn[e][ci.storage.get("settings").language]:e}function vi(){ii.alert.firstChild.classList.remove("alert-showed"),setTimeout(()=>{ii.alert.style.setProperty("display","none")},350)}function xi(e){const t=ii.alert.firstChild,n=t.querySelector(".alert-title"),i=t.querySelector(".alert-message"),s=document.getElementById("alert-button-ng"),o=document.getElementById("alert-button-ok");e.title?(n.style.setProperty("display","block"),n.textContent=bi(e.title)):n.style.setProperty("display","none");let a=bi(e.message);e.vars&&(a=a.replace(/%([A-Za-z0-9]+)%/g,(t,n)=>e.vars[n])),i.innerHTML=a,e.ok?(o.textContent=bi(e.okLabel||"cool"),o.onclick=()=>{e.ok(),vi()},e.onlyok?s.style.setProperty("display","none"):(s.style.setProperty("display","inline-block"),s.textContent=bi(e.ngLabel||"not-cool"),s.onclick=vi)):(o.textContent=bi(e.okLabel||"ok"),o.onclick=vi,s.style.setProperty("display","none")),ii.alert.style.setProperty("display","block"),setTimeout(()=>{t.classList.add("alert-showed")},17)}function ki(e){const t=document.createElement("div");t.classList.add("push-log"),t.innerHTML=bi(e),ii.main.appendChild(t),setTimeout(()=>{ii.main.removeChild(t)},3e3)}function Ei(){ii.loading.style.setProperty("display","block")}function Oi(){ii.loading.style.setProperty("display","none")}function Ai(){dt().invite?wi("invite"):wi(window.INITIAL_LABEL||M)}function ji(e=M){Object.keys(a).forEach(e=>{si[a[e].label]=new ti(a[e],{layers:ii,utilities:s,constants:i,app:ci})}),ai=document.createElement("div"),ai.setAttribute("id",N),document.body.appendChild(ai),oi=document.createElement("canvas"),oi.setAttribute("id",R),oi.style.setProperty("z-index",0),ai.appendChild(oi),D.forEach((e,t)=>{const n=document.createElement("div");n.classList.add("layer"),n.classList.add(`layer-${e}`),n.style.setProperty("z-index",t+1),ai.appendChild(n),ii[e]=n}),ii.loading.style.setProperty("display","none"),ii.loading.innerHTML='<div id="loading">\n    <p>\n      <svg id="loading-tower" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 500" width="250" height="500">\n        <g paint-order="markers fill stroke">\n          <path d="M203.756 446.654H58.04v-40h145.715z"/>\n          <path d="M197.041 396.654h-135v-40h135z"/>\n          <path d="M189.756 346.654H64.04v-40h125.715z"/>\n          <path d="M181.041 296.654h-115v-40h115z"/>\n          <path d="M170.613 246.654H72.04v-40h98.572z"/>\n          <path d="M166.899 196.654H74.04v-40H166.9z"/>\n          <path d="M158.756 146.654H78.04v-40h80.715z"/>\n          <path d="M30.672 20.381v34.425h47.37v41.848H220.306V76.708h-54.27V38.574h-65.21V20.38zm106.469 30.074a9.014 9.014 0 019.014 9.015 9.014 9.014 0 11-9.014-9.015z"/>\n          <path d="M58.041 457.667v12.725h19.194v20.322h20.31v-20.322h67.42v20.322h20.313v-20.322h18.12v-12.725z"/>\n        </g>\n      </svg>\n    </p>\n    <p style="margin-left: 35px;">LOADING…</p>\n    <p id="loaded-count"></p>\n  </div>',ii.alert.style.setProperty("display","none"),ii.alert.innerHTML='<div class="alert-outer">\n    <div class="alert">\n      <div class="alert-back">\n        <div class="alert-back-img-outer">\n          <img src="./assets/img/forcss/alert-logo-1.png">\n          <img src="./assets/img/forcss/alert-logo-2.png">\n          <img src="./assets/img/forcss/alert-logo-3.png">\n          <img src="./assets/img/forcss/alert-logo-4.png">\n        </div>\n      </div>\n      <div class="alert-title">注意</div>\n      <div class="alert-message">評価に差があるプレイヤーと<br>バイトに参加する場合<br>評価が上がらないことがあるよ<br>それでも、バイトに参加するかい？</div>\n      <div class="alert-button-outer">\n        <div id="alert-button-ng" class="alert-button clickable">いいえ</div>\n        <div id="alert-button-ok" class="alert-button clickable">はい！</div>\n      </div>\n    </div>\n  </div>',mi(),hi(),window.addEventListener("resize",()=>{pi()}),window.addEventListener("orientationchange",()=>{pi()})}var Si={apiKey:"AIzaSyCmKBMAKgSz__8zRb4fRAB3UVsnY-gRHuo",authDomain:"salmon-tower-battle.firebaseapp.com",databaseURL:"https://salmon-tower-battle.firebaseio.com",projectId:"salmon-tower-battle",storageBucket:"salmon-tower-battle.appspot.com",messagingSenderId:"703361093744",appId:"1:703361093744:web:45e7b1e7c0e69e847da4b5"};const{logger:Ti}=s,{firebase:Ii}=window;let Bi;delete window.firebase;let Ci,Pi=null,Li=0;function Mi(e){Ci=e}function Di(){const e=window.require("electron").ipcRenderer;e.send("oauth","ping"),e.on("oauth-reply",(e,t,n)=>{if(t){Ti.log("electron-oauth-twitterモジュールの実行に成功しました。"),Ti.log(n);const e=Ii.auth.TwitterAuthProvider.credential(n.oauth_access_token,n.oauth_access_token_secret);Ii.auth().signInWithCredential(e).then(e=>{Ti.log("サインインに成功しました。"),Ti.log(e),window.location.reload()}).catch(e=>{Ti.error("サインインに失敗しました。"),Ti.error(e)})}else window.logger.error("electron-oauth-twitterの実行に失敗しました。"),window.logger.error(n)})}function Ni(){const e=new Ii.auth.TwitterAuthProvider;Y?Ii.auth().signInWithPopup(e).then(e=>{Ti.log("サインインに成功しました。"),Ti.log(e)}).catch(e=>{Ti.error("サインインに失敗しました。"),Ti.error(e)}):Ii.auth().signInWithRedirect(e)}function Ri(){ct()?Di():Ni()}function _i(){Ri()}function $i(){Ii.auth().signOut().then(()=>{Ti.log("サインアウトに成功しました。"),window.location.reload()}).catch(e=>{Ti.error("サインアウトに失敗しました。"),Ti.error(e)})}function Gi(e){const t=e.split("/"),n=t.pop().split("."),i=n.pop(),s=n.join(".").replace("_mini","").replace("_normal","").replace("_bigger","")+"{size}";return`${t.join("/")}/${s}.${i}`}async function Ui(e){const t=e.replace("{size}",""),n=e.replace("{size}","_bigger"),i=e.replace("{size}","_normal");return await tt(t)?t:await tt(n)?n:i}function Fi(e){Ii.database().ref(e).off()}function Hi(e,t){Ii.database().ref(e).on("child_added",e=>{t(e.val(),e.key)})}function Vi(e,t){Ii.database().ref(e).on("child_changed",e=>{t(e.val(),e.key)})}function qi(e,t){Ii.database().ref(e).on("child_removed",e=>{t(e.val(),e.key)})}async function Wi(e){return(await Ii.database().ref(e).once("value")).val()}function zi(e,t){return Wi(`${e}-rooms/${t}`)}async function Yi(e){await Ii.database().ref(e).remove()}async function Xi(e,t){await Ii.database().ref(e).update(t)}async function Ki(e,t){return(await Ii.database().ref(e).push(t)).key}function Ji(){Ii.auth().onAuthStateChanged(async e=>{if(e){Ti.log("%cFirebase signed in",Ti.getMarkerStyle("skyblue")),Ti.log("%cuser: %cガンジー","line-height: 30px",`line-height: 30px; padding-left: 35px;\n        font-family: sans-serif; background-image: url(${e.photoURL});\n        background-repeat: no-repeat; background-size: contain;`,"");const t=Gi(e.photoURL),n=await Ui(t),i=e.providerData&&e.providerData[0]&&e.providerData[0].uid||-1,s={},o=e.uid,a=rt();await Wi(`users/${o}`)||(s[`${o}/firstSignInDate`]=a.string,s[`${o}/firstSignInUnix`]=a.unix,s[`${o}/tuid`]=i),s[`${o}/displayName`]=e.displayName,s[`${o}/photoURL`]=n,s[`${o}/lastSignInDate`]=a.string,s[`${o}/lastSignInUnix`]=a.unix,Xi("users",s),Bi={displayName:e.displayName,photoURL:n,uid:e.uid}}else Bi=null;gt("authstatechange",Bi)})}async function Qi(e,t){return await Yi(`users/${Bi.uid}/ownPrivateRoom`),Yi(`${e}-rooms/${t}`)}async function Zi(e){if(!Bi)return!1;const t=await Wi(`users/${Bi.uid}`);t&&t.ownPrivateRoom&&await Qi(e,t.ownPrivateRoom);const n=rt(),i={seed:0,members:{},state:"waiting",createUnix:n.unix,createDate:n.string,ownerUser:{uid:Bi.uid,displayName:Bi.displayName,photoURL:Bi.photoURL},version:p};i.members[Bi.uid]={displayName:Bi.displayName,photoURL:Bi.photoURL,state:"waiting"};const s=await Ki(`${e}-rooms`,i);return await Xi(`users/${Bi.uid}`,{ownPrivateRoom:s}),s}async function es(e,t){Li=0,await Xi(`${e}-rooms/${t}`,{state:"waiting"})}async function ts(e,t){const n=await zi(e,t);if(!n)return"room-doesnt-exist";const i=Object.keys(n.members||{}),s=i.length;return i.indexOf(Bi.uid)<0&&s>=Z?"error-room-is-full":n.version!==p?"error-room-versions-dont-match":(await Xi(`${e}-rooms/${t}/members/${Bi.uid}`,{displayName:Bi.displayName,photoURL:Bi.photoURL,state:"waiting"}),"")}function ns(e,t){return Yi(`${e}-rooms/${t}/members/${Bi.uid}`)}async function is(e,t){const n=await zi(e,t),i=Object.keys(n.members),s=i.length,o=[];for(let e=0;e<s;e+=1)o[e]=e;const a={};i.forEach(e=>{const t=Math.floor(Math.random()*o.length),i=o[t];o.splice(t,1),a[`order-${i}`]=e,n.members[e].state="playing"});const r=rt();Xi(`${e}-rooms/${t}`,{lastPlayUnix:r.unix,lastPlayDate:r.string,orders:a,operations:null,panelStates:"",members:n.members,seed:(new Date).getTime(),state:`playing-${Li}`})}function ss(){Xi(`${Pi}`,{state:"waiting"})}function os(e,t){Li+=1,is(e,t)}async function as(e,t){const n=`000${e}`.slice(-3);await Xi(`${Pi}/operations/step-${n}`,t),Ke.log("send operation: %o",t)}async function rs(e){await Xi(`${Pi}`,{panelStates:JSON.stringify(e)}),Ke.log("send panelStates: %o",e)}function cs(e,t){Fi(`${e}-rooms/${t}/operations`),Fi(`${e}-rooms/${t}/members`),Fi(`${e}-rooms/${t}`)}function ls(e,t,n){cs(e,t),Vi(`${e}-rooms/${t}/operations`,(e,t)=>{const n=parseInt(t.split("-")[1],10);Ci.game.receiveOperation(e,n)}),qi(`${e}-rooms/${t}/members`,n.onremovemember),Vi(`${e}-rooms/${t}`,(e,t)=>{"state"===t&&n.onchangeroomstate(e),"panelStates"===t&&Ci.game.syncPanelStates(e)}),Pi=`${e}-rooms/${t}`}function us(e,t){Fi(`${e}-rooms/${t}`),Fi(`${e}-rooms/${t}/members`)}function ds(e,t,n){us(e,t),Hi(`${e}-rooms/${t}/members`,n.onaddmember),qi(`${e}-rooms/${t}/members`,n.onremovemember),Vi(`${e}-rooms/${t}/members`,n.onchangememberstate),Vi(`${e}-rooms/${t}`,(e,t)=>{"state"===t&&n.onchangeroomstate(e)})}function hs(){return Bi&&Bi.uid?Bi.uid:""}function ps(){return Bi}function gs(){return Wi(`users/${Bi.uid}`)}function ms(e){Bi=e}function fs(){return void 0===Bi?"connecting":null===Bi?"not-signed-in":"signed-in"}function ys(){const e=Ii.initializeApp(Si);Ti.log("%cFirebase initialized",Ti.getMarkerStyle("skyblue")),Ti.log("database: %o",e.options.databaseURL),Ji()}
/*! Reference
 * https://github.com/emaame/salmonrun_time_timer/blob/master/src/sound.js
 * https://github.com/GoogleChromeLabs/airhorn/blob/master/app/scripts/main.min.js
 * https://qiita.com/cortyuming/items/b6e3784d08d7a90b3614
 */const ws={},bs=window.AudioContext||window.webkitAudioContext,vs=!!bs;let xs,ks,Es,Os,As=!1,js=!1;function Ss(e){Os=e}function Ts(e){if(js)return 0;const{globalVolume:t}=Os.storage.get("settings");return(t in S?S[t]:0)*e}function Is(e){const t=O+e;let n=ws[e]&&ws[e].element;return n?new Promise(e=>{e(n)}):(ws[e]={},new Promise(i=>{n=document.createElement("audio"),n.oncanplaythrough=()=>{i(n)},n.src=t,ws[e].element=n}))}function Bs(e){const t=O+e,n=ws[e]&&ws[e].buffer;return n?new Promise(e=>{e(n)}):(ws[e]={},new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=()=>{4===s.readyState&&200===s.status?(Es.resume(),Es.decodeAudioData(s.response,t=>{ws[e].buffer=t,n(t)})):i(new Error(s.statusText))},s.onerror=()=>{i(new Error(s.statusText))},s.send(null)}))}const Cs=vs?Bs:Is;function Ps(e){return Promise.all(e.map(e=>Cs(e)))}function Ls(e){ws[e].playing=!1,vs?ws[e].source.stop(0):ws[e].element.pause()}function Ms(){Object.keys(ws).forEach(e=>{ws[e].playing&&Ls(e)})}async function Ds(e,t){const n=await Is(e);return new Promise(i=>{n.currentTime=0,n.volume=Ts(t.volume),n.loop=t.loop,ws[e].updateVolume=()=>{n.volume=Ts(t.volume)},n.onended=()=>{Ls(e)},ws[e].playing=!0,n.play().then(()=>{i(!0)}).catch(()=>{i(!1)})})}async function Ns(e,t){const n=await Bs(e);ws[e].playing&&(Ls(e),await wt(50)),Es.resume();const i=Es.createBufferSource(),s=Es.createGain();s.gain.value=Ts(t.volume),ws[e].mute=()=>{s.gain.value=0},ws[e].updateVolume=()=>{s.gain.value=Ts(t.volume)},i.loop=t.loop,i.buffer=n,i.connect(s),s.connect(Es.destination),i.onended=()=>{Ls(e)},ws[e].source=i,ws[e].playing=!0,i.start(0)}async function Rs(e,t){const n=Object.assign({volume:1,loop:!1},t);if(As){if(n.loop){const t=ws[e]&&ws[e].playing,n=xs===e;if(t||n)return}vs?Ns(e,n):Ds(e,n)}else n.loop&&(xs=e,ks=n)}function _s(){Object.keys(ws).forEach(e=>{ws[e].playing&&ws[e].updateVolume()})}function $s(e){js=e,_s()}async function Gs(){if(!As&&(As=!0,Rs(A),xs)){const e=xs,t=ks;xs=null,ks=null,Rs(e,t)}}function Us(e){Os.storage.get("settings").globalVolume=e,Os.storage.save("settings"),_s()}function Fs(){vs&&(Es=new bs,Es.createGain=Es.createGain||Es.createGainNode),Cs(j)}function Hs(e){for(let t=0;t<L.length;t+=1){const n=L[t];if(P[n].indexOf(e)>-1)return n}return null}function Vs(){}function qs(){window.addEventListener("keydown",e=>{const t=Hs(e.keyCode);t&&(Ke.log(`keydown-${t}`),gt(`keydown-${t}`,{isAlt:e.altKey,isCtrl:e.ctrlKey,isShift:e.shiftKey}))})}var Ws={initialize:qs,removeAllListener:Vs};const zs={};function Ys(e){return zs[e]}function Xs(e){const t=k[e];localStorage.setItem(t.storageKey,null)}function Ks(){E.forEach(e=>{Xs(e)})}function Js(e){const t=k[e],n=JSON.stringify(zs[e]);localStorage.setItem(t.storageKey,n)}function Qs(){E.forEach(e=>{Js(e)})}function Zs(){if(E.forEach(e=>{const t=k[e],n=localStorage.getItem(t.storageKey),i=n?Object.assign({},t.initialValue,JSON.parse(n)):Object.assign({},t.initialValue);zs[e]=i,Js(e)}),!zs.settings.language){const e=navigator.language||navigator.userLanguage||"ja";zs.settings.language=e.indexOf("ja")>-1?"ja":"en"}dt().lang&&(zs.settings.language=dt().lang.indexOf("ja")>-1?"ja":"en"),Ke.log("%cStorage initialized",Ke.getMarkerStyle("skyblue")),E.forEach(e=>{Ke.log(`${e}: %o`,zs[e])})}window.addEventListener("load",()=>{bt();const e={game:o,view:r,network:c,sound:l,storage:d,key:u};Object.keys(e).forEach(t=>{"setApp"in e[t]&&e[t].setApp(e)}),f&&(window.app=e),Zs(),ys(),Fs(),ji(),Nn(),qs(),wi("loading")})}]);