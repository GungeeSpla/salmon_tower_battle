!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"APP_VERSION",(function(){return p})),n.d(i,"APP_VERSION_QUERY",(function(){return m})),n.d(i,"IS_DEVELOPMENT",(function(){return f})),n.d(i,"IS_DEBUG_OPERATE",(function(){return y})),n.d(i,"IS_DEBUG_POLYGON",(function(){return w})),n.d(i,"IS_DEBUG_RANDOM_SEED",(function(){return b})),n.d(i,"IS_DEBUG_LOG",(function(){return v})),n.d(i,"DEBUG_RANDOM_SEED",(function(){return x})),n.d(i,"STORAGE_CONFIG",(function(){return k})),n.d(i,"STORAGE_CONFIG_KEYS",(function(){return E})),n.d(i,"SOUND_URL_BASE",(function(){return O})),n.d(i,"SOUND_SILENT",(function(){return A})),n.d(i,"SOUNT_INITIAL_BGM",(function(){return j})),n.d(i,"SOUND_VOLUME_ALPHAS",(function(){return S})),n.d(i,"SE_PANEL_NEXT",(function(){return T})),n.d(i,"SE_PANEL_JUMP_OUT",(function(){return I})),n.d(i,"SE_PANEL_ROTATE",(function(){return B})),n.d(i,"SE_PANEL_DOWN",(function(){return C})),n.d(i,"KEY_CONFIG",(function(){return P})),n.d(i,"KEY_TYPES",(function(){return L})),n.d(i,"INITIAL_LABEL",(function(){return M})),n.d(i,"LAYER_NAMES",(function(){return D})),n.d(i,"CONTAINER_ID",(function(){return R})),n.d(i,"CANVAS_ID",(function(){return N})),n.d(i,"SCENE_JUMP_DURATION",(function(){return _})),n.d(i,"CANVAS_FITTING_DURATION",(function(){return $})),n.d(i,"CANVAS_WIDTH",(function(){return G})),n.d(i,"CANVAS_HEIGHT",(function(){return U})),n.d(i,"CANVAS_RATIO",(function(){return F})),n.d(i,"IPHONE_4_RATIO",(function(){return H})),n.d(i,"IPHONE_11_RATIO",(function(){return V})),n.d(i,"IPAD_PRO_10_RATIO",(function(){return q})),n.d(i,"CANVAS_MIN_RATIO",(function(){return W})),n.d(i,"CANVAS_MAX_RATIO",(function(){return z})),n.d(i,"IS_ENABLED_POPUP",(function(){return Y})),n.d(i,"CANVAS_CENTER_X",(function(){return X})),n.d(i,"BG_COLOR",(function(){return K})),n.d(i,"BACK_GRAD_THRESHOLD",(function(){return J})),n.d(i,"BACK_GRADS",(function(){return Q})),n.d(i,"ROOM_MEMBER_COUNT_MAX",(function(){return Z})),n.d(i,"PANEL_TIME_LIMIT",(function(){return tt})),n.d(i,"PLAYER_LIFE",(function(){return et})),n.d(i,"FRAME_RATE",(function(){return nt})),n.d(i,"SHOULD_USE_TIMEOUT",(function(){return it})),n.d(i,"METER",(function(){return st})),n.d(i,"METER_B",(function(){return ot})),n.d(i,"GRAVITY",(function(){return at})),n.d(i,"TIME_STEP",(function(){return rt})),n.d(i,"VELOCITY_ITERATIONS",(function(){return ct})),n.d(i,"POSITION_ITERATIONS",(function(){return lt})),n.d(i,"STROKE_WIDTH",(function(){return ut})),n.d(i,"MAX_LINEAR_VELOCITY",(function(){return dt})),n.d(i,"DEFAULT_DENSITY",(function(){return ht})),n.d(i,"DEFAULT_FRICTION",(function(){return pt})),n.d(i,"DEFAULT_RESTITUTION",(function(){return gt})),n.d(i,"MAX_VERTEX_NUM",(function(){return mt})),n.d(i,"MAX_DENSITY",(function(){return ft})),n.d(i,"SCROLL_DURATION",(function(){return yt})),n.d(i,"ROTATE_DURATION",(function(){return wt})),n.d(i,"CLOUD_ANIMATION_DURATION",(function(){return bt})),n.d(i,"PANEL_CREATE_DURATION",(function(){return vt})),n.d(i,"PANEL_CREATE_DURATION_JUMPED",(function(){return xt})),n.d(i,"SYNC_OPERATE_ANIMATION_DURATION",(function(){return kt})),n.d(i,"SYNC_OPERATE_TIMEOUT_DURATION",(function(){return Et})),n.d(i,"TELEPORT_X",(function(){return Ot})),n.d(i,"OPERATION_DEFAULT_Y",(function(){return At})),n.d(i,"OPERATION_MARGIN_BOTTOM",(function(){return jt})),n.d(i,"OPERATION_MARGIN_TOP",(function(){return St})),n.d(i,"FLOOR_Y",(function(){return Tt})),n.d(i,"FLOOR_WIDTH",(function(){return It})),n.d(i,"WORLD_HEIGHT",(function(){return Bt})),n.d(i,"CUSION_COEFFICIENT",(function(){return Ct})),n.d(i,"MAX_SHAKE_COUNT",(function(){return Pt})),n.d(i,"ROTATE_BRAKE_COEFFICIENT",(function(){return Lt}));var s={};n.r(s),n.d(s,"parseDegree",(function(){return Wt})),n.d(s,"parseRadian",(function(){return zt})),n.d(s,"round",(function(){return Yt})),n.d(s,"ucfirst",(function(){return Xt})),n.d(s,"logger",(function(){return Kt})),n.d(s,"setB2BodyXYAngle",(function(){return Jt})),n.d(s,"addB2BodyXYAngle",(function(){return Qt})),n.d(s,"getImage",(function(){return Zt})),n.d(s,"getSvgPathData",(function(){return te})),n.d(s,"existsURL",(function(){return ee})),n.d(s,"getWindowWidth",(function(){return ne})),n.d(s,"getWindowHeight",(function(){return ie})),n.d(s,"getTime",(function(){return se})),n.d(s,"padding00",(function(){return oe})),n.d(s,"getDate",(function(){return ae})),n.d(s,"getTimestamp",(function(){return re})),n.d(s,"existsElectron",(function(){return ce})),n.d(s,"getBrowserName",(function(){return le})),n.d(s,"getOSName",(function(){return ue})),n.d(s,"getQueries",(function(){return de})),n.d(s,"logDisplayObjectCount",(function(){return he})),n.d(s,"emptyElement",(function(){return pe})),n.d(s,"dispatchDocumentEvent",(function(){return ge})),n.d(s,"addDocumentEventListener",(function(){return me})),n.d(s,"removeDocumentEventListener",(function(){return fe})),n.d(s,"execCopy",(function(){return ye})),n.d(s,"sleep",(function(){return we})),n.d(s,"logAsciiArt",(function(){return be}));var o={};n.r(o),n.d(o,"setApp",(function(){return cn})),n.d(o,"getSeed",(function(){return ln})),n.d(o,"setTodaySeed",(function(){return un})),n.d(o,"setUnixSeed",(function(){return dn})),n.d(o,"setTimeLimit",(function(){return hn})),n.d(o,"setSeed",(function(){return pn})),n.d(o,"setIsOnline",(function(){return gn})),n.d(o,"setIsEndless",(function(){return mn})),n.d(o,"setPlayerStates",(function(){return fn})),n.d(o,"getBackGradIndex",(function(){return yn})),n.d(o,"isOwnTurn",(function(){return wn})),n.d(o,"isOperable",(function(){return bn})),n.d(o,"getObjectMinY",(function(){return vn})),n.d(o,"getMonsterTiles",(function(){return xn})),n.d(o,"getAlivePlayerCount",(function(){return kn})),n.d(o,"getAlivePlayer",(function(){return En})),n.d(o,"execOperationRotate",(function(){return On})),n.d(o,"execOperationDown",(function(){return An})),n.d(o,"execOperationDownForcibly",(function(){return jn})),n.d(o,"receiveOperation",(function(){return Sn})),n.d(o,"createPanel",(function(){return Tn})),n.d(o,"judgeNextPanel",(function(){return In})),n.d(o,"syncPanelStates",(function(){return Bn})),n.d(o,"createPanelStates",(function(){return Cn})),n.d(o,"onAllBodiesSleep",(function(){return Pn})),n.d(o,"updateBackGrads",(function(){return Ln})),n.d(o,"tickWorld",(function(){return Mn})),n.d(o,"handleTickStage",(function(){return Dn})),n.d(o,"initialize",(function(){return Rn})),n.d(o,"finishGame",(function(){return Nn})),n.d(o,"beginGame",(function(){return _n})),n.d(o,"execOperationLR",(function(){return $n})),n.d(o,"replayGame",(function(){return Gn})),n.d(o,"startOver",(function(){return Un})),n.d(o,"startAgain",(function(){return Fn}));var a={};n.r(a),n.d(a,"LOADING",(function(){return Hn})),n.d(a,"SCENE_TITLE",(function(){return Vn})),n.d(a,"SCENE_PRIVATE_ROOM",(function(){return qn})),n.d(a,"SCENE_SIGN_IN",(function(){return Wn})),n.d(a,"SCENE_SETTINGS",(function(){return zn})),n.d(a,"SCENE_INVITE",(function(){return Yn})),n.d(a,"SCENE_OFFLINE_GAME",(function(){return Xn})),n.d(a,"SCENE_ONLINE_GAME",(function(){return Kn})),n.d(a,"REPLAY",(function(){return Jn})),n.d(a,"SCENE_WAIT_ONLINE_GAME",(function(){return Qn}));var r={};n.r(r),n.d(r,"canvasDetail",(function(){return ui})),n.d(r,"setApp",(function(){return di})),n.d(r,"fitCanvas",(function(){return hi})),n.d(r,"bookFitCanvas",(function(){return pi})),n.d(r,"unlockSound",(function(){return gi})),n.d(r,"setupUnlockSound",(function(){return mi})),n.d(r,"clearLayer",(function(){return fi})),n.d(r,"clearLayerAll",(function(){return yi})),n.d(r,"jump",(function(){return wi})),n.d(r,"getTranslatedText",(function(){return bi})),n.d(r,"closeAlert",(function(){return vi})),n.d(r,"alert",(function(){return xi})),n.d(r,"log",(function(){return ki})),n.d(r,"showLoading",(function(){return Ei})),n.d(r,"hideLoading",(function(){return Oi})),n.d(r,"firstJump",(function(){return Ai})),n.d(r,"initialize",(function(){return ji}));var c={};n.r(c),n.d(c,"firebase",(function(){return Ii})),n.d(c,"setApp",(function(){return Mi})),n.d(c,"signInWithTwitterOnElectron",(function(){return Di})),n.d(c,"signInWithTwitterOnBrowser",(function(){return Ri})),n.d(c,"signInWithTwitter",(function(){return Ni})),n.d(c,"signIn",(function(){return _i})),n.d(c,"signOut",(function(){return $i})),n.d(c,"parseProtoPhotoURL",(function(){return Gi})),n.d(c,"parsePhotoURL",(function(){return Ui})),n.d(c,"off",(function(){return Fi})),n.d(c,"onadd",(function(){return Hi})),n.d(c,"onchange",(function(){return Vi})),n.d(c,"onremove",(function(){return qi})),n.d(c,"get",(function(){return Wi})),n.d(c,"getRoom",(function(){return zi})),n.d(c,"remove",(function(){return Yi})),n.d(c,"update",(function(){return Xi})),n.d(c,"push",(function(){return Ki})),n.d(c,"setupAuthStateChange",(function(){return Ji})),n.d(c,"destroyRoom",(function(){return Qi})),n.d(c,"createRoom",(function(){return Zi})),n.d(c,"readyRoom",(function(){return ts})),n.d(c,"joinRoom",(function(){return es})),n.d(c,"leaveRoom",(function(){return ns})),n.d(c,"beginGame",(function(){return is})),n.d(c,"finishGame",(function(){return ss})),n.d(c,"againGame",(function(){return os})),n.d(c,"sendOperation",(function(){return as})),n.d(c,"sendPanelStates",(function(){return rs})),n.d(c,"teardownGaming",(function(){return cs})),n.d(c,"setupGaming",(function(){return ls})),n.d(c,"teardownWaiting",(function(){return us})),n.d(c,"setupWaiting",(function(){return ds})),n.d(c,"getOwnUid",(function(){return hs})),n.d(c,"getOwnUserData",(function(){return ps})),n.d(c,"getOwnUserDataNewly",(function(){return gs})),n.d(c,"setOwnUserData",(function(){return ms})),n.d(c,"getSignState",(function(){return fs})),n.d(c,"initialize",(function(){return ys}));var l={};n.r(l),n.d(l,"setApp",(function(){return Ss})),n.d(l,"makeVolume",(function(){return Ts})),n.d(l,"loadElement",(function(){return Is})),n.d(l,"loadBuffer",(function(){return Bs})),n.d(l,"loadAll",(function(){return Ps})),n.d(l,"stop",(function(){return Ls})),n.d(l,"stopAll",(function(){return Ms})),n.d(l,"playElement",(function(){return Ds})),n.d(l,"playBuffer",(function(){return Rs})),n.d(l,"play",(function(){return Ns})),n.d(l,"updateVolume",(function(){return _s})),n.d(l,"changeMute",(function(){return $s})),n.d(l,"unlock",(function(){return Gs})),n.d(l,"changeVolume",(function(){return Us})),n.d(l,"initialize",(function(){return Fs}));var u={};n.r(u),n.d(u,"getKeyType",(function(){return Hs})),n.d(u,"removeAllListener",(function(){return Vs})),n.d(u,"initialize",(function(){return qs})),n.d(u,"default",(function(){return Ws}));var d={};n.r(d),n.d(d,"get",(function(){return Ys})),n.d(d,"clear",(function(){return Xs})),n.d(d,"clearAll",(function(){return Ks})),n.d(d,"save",(function(){return Js})),n.d(d,"saveAll",(function(){return Qs})),n.d(d,"initialize",(function(){return Zs}));var h=[{id:10,name:"chum",scale:.8,frequency:3},{id:20,name:"cohock",scale:.8,frequency:3},{id:30,name:"smallfry",scale:1,frequency:3},{id:110,name:"maws",scale:.7,frequency:6},{id:120,name:"scrapper",scale:.6,frequency:6},{id:130,name:"steeleel",scale:1,frequency:6},{id:140,name:"steelhead",scale:.8,frequency:6},{id:150,name:"drizzler",scale:.6,frequency:6},{id:160,name:"flyfish",scale:.8,frequency:6},{id:170,name:"stinger",scale:1,frequency:6}];const p="0.2.0",g=document.getElementById("app").getAttribute("src"),m=g.split("?")[1],f=g.indexOf("index.js")>-1,y=f&&!1,w=f&&!1,b=f&&!1,v=f&&!0,x=1,k={settings:{storageKey:"stb-settings",initialValue:{globalVolume:0,isEnabledStageGL:!0,language:null}}},E=Object.keys(k),O="./assets/snd/",A="silent.mp3",j="gogo.mp3",S=[0,.1,.4,1],T="se-panel-next.wav",I="se-panel-jump-out.wav",B="se-panel-rotate.wav",C="se-panel-rotate.wav",P={left:[37],up:[38],right:[39],down:[40],start:[32,13]},L=Object.keys(P),M="title",D=["loading","back","main","fix","alert"],R="createjs-container",N="createjs-canvas",_=200,$=250,G=720,U=1280,F=U/G,H=1.5,V=2688/1242,q=2224/1668,W=q,z=V,Y=!1,X=G/2,K="#00bcd4",J=15,Q=[["#2BFBF9","#16B4E8","#0B8ADE"],["#FDA798","#AA5360","#582F51"],["#2F7FA9","#306A9A","#070C21"]],Z=6,tt=15,et=1,nt=60,it=!0,st=100,ot=170,at=4,rt=1/nt,ct=3,lt=1,ut=2,dt=3,ht=1,pt=8,gt=0,mt=8,ft=30,yt=1e3,wt=300,bt=2e3,vt=400,xt=800,kt=800,Et=3333,Ot=100,At=400,jt=200,St=400,Tt=1e3,It=580,Bt=(200+U)/st,Ct=1/16,Pt=5,Lt=.9;class Mt{constructor(t,e,n=null,i=null){this.x=t,this.y=e,this.index=n,this.originIndex=n,this.vertexes=i}remove(){for(let t=this.index+1;t<this.vertexes.length;t+=1)this.vertexes[t].index-=1;this.vertexes.splice(this.index,1)}prev(){const t=(this.index-1+this.vertexes.length)%this.vertexes.length;return this.vertexes[t]}next(){const t=(this.index+1)%this.vertexes.length;return this.vertexes[t]}getTriangle(){return[this,this.next(),this.prev()]}isContainedByTriangle(t){const e=this.constructor.getTriangleDirection([t[0],t[1],this]),n=this.constructor.getTriangleDirection([t[1],t[2],this]),i=this.constructor.getTriangleDirection([t[2],t[0],this]);return e===n&&n===i&&i===e}static getTriangleDirection(t){const e=new Mt(t[1].x-t[0].x,t[1].y-t[0].y),n=new Mt(t[2].x-t[0].x,t[2].y-t[0].y);return e.x*n.y-n.x*e.y>=0?1:-1}getDistance(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}getFurthestVertex(){let t=-1/0,e=null;return this.vertexes.forEach(n=>{const i=this.getDistance(n);i>t&&(t=i,e=n)}),e}}const Dt=t=>{let e=t.getAttribute("stroke")||"#000";let n;return(t.getAttribute("style")||"").split(";").forEach(t=>{const n=t.split(":");"stroke"===n[0]&&([,e]=n)}),e=e.toLowerCase(),e=e.replace("red","#f00"),e=e.replace("black","#000"),e=e.replace("#",""),n=3===e.length?parseInt(e[0]+e[0],16)||0:parseInt(e[0]+e[1],16)||0,ht+n/255*(ft-ht)},Rt=t=>{const e=[],n=t.length/2;for(let i=0;i<n;i+=1)e[i]=new Mt(t[2*i+0],t[2*i+1],i,e);const i=new Mt(0,0,0,e),s=[];let o=0,a=i.getFurthestVertex(),r=null;for(;o<300&&e.length>=3;){o+=1;const t=a.getTriangle();let n=!1;for(let i=0;i<e.length;i+=1){const s=e[i];let o=!1;for(let e=0;e<t.length;e+=1)if(s===t[e]){o=!0;break}if(!o&&s.isContainedByTriangle(t)){n=!0;break}}if(n)r||(r=t),a=a.prev();else{if(r){if(Mt.getTriangleDirection(r)!==Mt.getTriangleDirection(t)){a=a.prev();continue}}s.push(t),a.remove(),a=i.getFurthestVertex(),r=null}}const c=[];return s.forEach(t=>{let e=!0;e&&c.push([t[0].x,t[0].y,t[1].x,t[1].y,t[2].x,t[2].y])}),c},Nt=t=>{const e=[];t.forEach(t=>{if("path"!==t.type)e.push(t);else if(Math.floor(t.path.length/2)<=3)e.push(t);else{Rt(t.path).forEach(n=>{e.push({type:t.type,density:t.density,path:n})})}});const n=[];e.forEach(t=>{switch(t.type){case"circle":{const e=t.cx,i=t.cy,s=t.density*(t.r*t.r*Math.PI);n.push({m:s,x:e,y:i});break}case"path":{const e=(t.path[0]+t.path[2]+t.path[4])/3,i=(t.path[1]+t.path[3]+t.path[5])/3,s=t.density*((t,e,n,i,s,o)=>{const a=(t-s)*(i-o),r=(n-s)*(e-o);return Math.abs(a-r)/2})(...t.path);n.push({m:s,x:e,y:i});break}}});let i=0,s=0,o=0;return n.forEach(t=>{i+=t.m*t.x,s+=t.m*t.y,o+=t.m}),{x:Math.floor(i/o),y:Math.floor(s/o)}};class _t{constructor(t){const{width:e,height:n,shapes:i}=(t=>{const e=t.getElementsByTagName("svg")[0],n=e.getAttribute("viewBox");let i,s;if(n){const t=n.split(" ");i=parseFloat(t[2]),s=parseFloat(t[3])}else i=parseFloat(e.getAttribute("width")),s=parseFloat(e.getAttribute("height"));const o=t.getElementsByTagName("circle"),a=t.getElementsByTagName("ellipse"),r=t.getElementsByTagName("path"),c=[];return o&&Array.prototype.forEach.call(o,t=>{const e=Dt(t),n=parseFloat(t.getAttribute("cx")),i=parseFloat(t.getAttribute("cy")),s=parseFloat(t.getAttribute("r"));c.push({type:"circle",density:e,cx:n,cy:i,r:s})}),a&&Array.prototype.forEach.call(a,t=>{const e=Dt(t),n=parseFloat(t.getAttribute("cx")),i=parseFloat(t.getAttribute("cy")),s=(parseFloat(t.getAttribute("rx"))+parseFloat(t.getAttribute("ry")))/2;c.push({type:"circle",density:e,cx:n,cy:i,r:s})}),r&&Array.prototype.forEach.call(r,t=>{const e=Dt(t),n=t.getAttribute("d");let i="",s=[],o="",a=!0,r=0,l=0,u=!1;const d={x:0,y:0};function h(){let t=parseFloat(i);if(!Number.isNaN(t)){if(r>0)r-=1;else{let e;switch(e=s.length%2==0&&"V"!==o?"x":"y",a||(t+=d[e]),o){case"H":s.push(t),s.push(d.y),d.x=t;break;case"V":s.push(d.x),s.push(t),d.y=t;break;default:s.push(t),d[e]=t}r-=1,r<=-2&&(r=l)}i="",u=!1}return!0}for(let t=0;t<n.length;t+=1){let p=n.charAt(t);const g=p===p.toUpperCase();switch(p=p.toUpperCase(),p){default:i+=p;break;case" ":case",":h();break;case"-":h(),i+=p;break;case".":u&&h(),u=!0,i+=p;break;case"H":h(),a=g,o="H";break;case"V":h(),a=g,o="V";break;case"L":case"M":case"Z":case"T":h(),a=g,o="",r=0,l=0;break;case"C":h(),a=g,o="",l=4,r=4;break;case"S":case"Q":h(),a=g,o="",l=2,r=2}"Z"===p&&(c.push({type:"path",density:e,path:s}),d.x=s[0]||0,d.y=s[1]||0,l=0,r=0,a=!0,o="",s=[])}}),{width:i,height:s,shapes:c}})(t),s=(t=>{const e=[];return t.forEach(t=>{if("path"!==t.type)e.push(t);else if(Math.floor(t.path.length/2)<=mt)e.push(t);else{Rt(t.path).forEach(n=>{e.push({type:t.type,density:t.density,path:n})})}}),e})(i),o=Nt(s);this.width=e,this.height=n,this.gCenter=o,this.shapes=s}}const{b2Vec2:$t}=window,Gt={},Ut={},Ft={},Ht={},Vt=void 0!==window.performance;let qt=null;function Wt(t){return t*(180/Math.PI)}function zt(t){return t*(Math.PI/180)}function Yt(t,e){return Math.round(t*10**e)/10**e}function Xt(t){return t.substr(0,1).toUpperCase()+t.substr(1)}const Kt={log:console.log,info:console.info,warn:console.warn,error:console.error,getMarkerStyle:t=>`background: linear-gradient(transparent 60%, ${t} 60%);\n      font-weight: bold;`,getBigMarkerStyle:(t,e="black")=>`background: linear-gradient(transparent 0%, ${t} 0%);\n      color: ${e}; font-weight: bold;`};function Jt(t){const e=void 0!==t.x?t.x:t.body.GetPosition().x,n=void 0!==t.y?t.y:t.body.GetPosition().y,i=void 0!==t.angle?t.angle:t.body.GetAngle();t.body.SetTransform(new $t(e,n),i)}function Qt(t){const e=t.body.GetPosition(),n=void 0!==t.x?t.x:0,i=void 0!==t.y?t.y:0,s=void 0!==t.angle?t.angle*(Math.PI/180):0;Jt({body:t.body,x:e.x+n,y:e.y+i,angle:t.body.GetAngle()+s})}function Zt(t){return new Promise(e=>{if(t in Gt)return void e(Gt[t]);const n=new Image;n.onload=()=>{Gt[t]=n,e(n)},n.src=t})}function te(t){return new Promise(e=>{if(t in Ut)return void e(Ut[t]);const n=new XMLHttpRequest;n.open("GET",t,!0),n.onerror=()=>{e(null)},n.onreadystatechange=()=>{if(n.readyState===n.DONE)if(200===n.status||304===n.status){const i=new _t(n.responseXML);Ut[t]=i,e(i)}else e(null)},n.send(null)})}function ee(t){return new Promise(e=>{const n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=()=>{n.readyState===n.DONE&&(404===n.status?e(!1):e(!0))},n.send(null)})}function ne(){return window.innerWidth||!!document.body&&document.body.clientWidth||document.documentElement.clientWidth}function ie(){return window.innerHeight||!!document.body&&document.body.clientHeight||document.documentElement.clientHeight}function se(){return Vt?window.performance.now():(new Date).getTime()}function oe(t){return`00${t}`.slice(-2)}function ae(){const t=new Date;return`${t.getFullYear()}/${oe(t.getMonth()+1)}/${oe(t.getDate())} ${["Sun","Mon","The","Wed","Thu","Fri","Sat"][t.getDay()]} ${oe(t.getHours())}:${oe(t.getMinutes())}:${oe(t.getSeconds())}`}function re(){const t=new Date,e=t.getFullYear(),n=oe(t.getMonth()+1),i=oe(t.getDate()),s=oe(t.getHours()),o=oe(t.getMinutes()),a=oe(t.getSeconds());return{date:e+n+i,unix:Math.floor(t.getTime()/1e3),string:`${e}/${n}/${i} ${s}:${o}:${a}`}}function ce(){return!!window.electron}function le(){const t=window.navigator.userAgent.toLowerCase();return t.indexOf("msie")>-1||t.indexOf("trident")>-1?"ie":t.indexOf("edge")>-1?"edge":t.indexOf("chrome")>-1?"chrome":t.indexOf("safari")>-1?"safari":t.indexOf("firefox")>-1?"firefox":t.indexOf("opera")>-1?"opera":"other"}function ue(){const t=window.navigator.userAgent.toLowerCase();return t.indexOf("iphone")>-1?"iphone":t.indexOf("ipad")>-1?"ipad":t.indexOf("android")>-1?(t.indexOf("mobile"),"android"):t.indexOf("windows")>-1?"windows":t.indexOf("mac os x")>-1?"mac":"other"}function de(){if(qt)return qt;const t=window.location.search.slice(1),e={};return t&&t.split("&").forEach(t=>{const n=t.split("=");n[1]?[,e[n[0]]]=n:e[n[0]]=""}),qt=e,e}function he(t,e=0){let n=0;return t.children.forEach(t=>{t instanceof createjs.Container?n+=he(t,e+1):n+=1}),0===e&&console.log(`${n} display obejcts exist.`),n}function pe(t){const e="string"==typeof t?document.querySelector(t):t;for(;e.firstChild;)e.removeChild(e.firstChild)}function ge(t,e={}){t in Ft||(Ft[t]=document.createEvent("HTMLEvents")),Ft[t].initEvent(t,!1,!1),Ft[t].detail=e,document.dispatchEvent(Ft[t])}function me(t,e){const[n,i]=t.split(".");n in Ht||(Ht[n]=[],document.addEventListener(n,t=>{Ht[n].forEach(e=>{e.callback(t)})})),Ht[n].push({groupName:i,callback:e})}function fe(t){const[e,n]=t.split(".");if(e in Ht)if(n)for(let t=0;t<Ht[e].length;t+=1)n===Ht[e][t].groupName&&(Ht[e].splice(t,1),t-=1);else for(;Ht[e][0];)Ht[e].pop()}function ye(t,e){const n=document.createElement("div"),i=document.createElement("pre");i.style.webkitUserSelect="auto",i.style.userSelect="auto",n.appendChild(i).textContent=t;const s=n.style;s.position="fixed",s.right="200%",document.body.appendChild(n),document.getSelection().selectAllChildren(n);const o=document.execCommand("copy");if(document.body.removeChild(n),e){const t=document.getElementById(e);t.style.webkitUserSelect="auto",t.style.userSelect="auto",window.getSelection().selectAllChildren(t)}return o}function we(t){return new Promise(e=>{setTimeout(()=>{e(null)},t)})}function be(){console.log(`%c\n███████╗ █████╗ ██╗     ███╗   ███╗ ██████╗ ███╗   ██╗\n██╔════╝██╔══██╗██║     ████╗ ████║██╔═══██╗████╗  ██║\n███████╗███████║██║     ██╔████╔██║██║   ██║██╔██╗ ██║\n╚════██║██╔══██║██║     ██║╚██╔╝██║██║   ██║██║╚██╗██║\n███████║██║  ██║███████╗██║ ╚═╝ ██║╚██████╔╝██║ ╚████║\n╚══════╝╚═╝  ╚═╝╚══════╝╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═══╝\n%c                                                      \n████████╗ ██████╗ ██╗    ██╗███████╗██████╗           \n╚══██╔══╝██╔═══██╗██║    ██║██╔════╝██╔══██╗          \n   ██║   ██║   ██║██║ █╗ ██║█████╗  ██████╔╝          \n   ██║   ██║   ██║██║███╗██║██╔══╝  ██╔══██╗          \n   ██║   ╚██████╔╝╚███╔███╔╝███████╗██║  ██║          \n   ╚═╝    ╚═════╝  ╚══╝╚══╝ ╚══════╝╚═╝  ╚═╝          \n                                                      \n██████╗  █████╗ ████████╗████████╗██╗     ███████╗    \n██╔══██╗██╔══██╗╚══██╔══╝╚══██╔══╝██║     ██╔════╝    \n██████╔╝███████║   ██║      ██║   ██║     █████╗      \n██╔══██╗██╔══██║   ██║      ██║   ██║     ██╔══╝      \n██████╔╝██║  ██║   ██║      ██║   ███████╗███████╗    \n╚═════╝ ╚═╝  ╚═╝   ╚═╝      ╚═╝   ╚══════╝╚══════╝\n\n%cVer.${p} ${f?"(DEVELOPMENT)":""}\n`,"color: orange;","color: limegreen;","color: orange; font-weight: bold; font-size: 24px;"),p!==m&&console.error(`%cMismatch app version (${p}) and query parameter (${m})`,Kt.getBigMarkerStyle("pink"))}v||Object.keys(Kt).forEach(t=>{Kt[t]=()=>{}});class ve{constructor(t){this.x=123456789,this.y=362436069,this.z=521288629,this.w=t||88675123}random(){const t=this.x^this.x<<11;return this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>19^t^t>>8,this.w}getRandom(t){return this.random()%t}}const xe={linearTween:(t,e,n,i)=>n*t/i+e,easeInQuad:(t,e,n,i)=>n*(t/=i)*t+e,easeOutQuad:(t,e,n,i)=>-n*(t/=i)*(t-2)+e,easeInOutQuad:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t+e:-n/2*((t-=1)*(t-2)-1)+e,easeInCubic:(t,e,n,i)=>n*(t/=i)*t*t+e,easeOutCubic:(t,e,n,i)=>(t/=i,n*((t-=1)*t*t+1)+e),easeInOutCubic:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e,easeInQuart:(t,e,n,i)=>n*(t/=i)*t*t*t+e,easeOutQuart:(t,e,n,i)=>(t/=i,-n*((t-=1)*t*t*t-1)+e),easeInOutQuart:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e,easeInQuint:(t,e,n,i)=>n*(t/=i)*t*t*t*t+e,easeOutQuint:(t,e,n,i)=>(t/=i,n*((t-=1)*t*t*t*t+1)+e),easeInOutQuint:(t,e,n,i)=>(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e,easeInSine:(t,e,n,i)=>-n*Math.cos(t/i*(Math.PI/2))+n+e,easeOutSine:(t,e,n,i)=>n*Math.sin(t/i*(Math.PI/2))+e,easeInOutSine:(t,e,n,i)=>-n/2*(Math.cos(Math.PI*t/i)-1)+e,easeInExpo:(t,e,n,i)=>n*Math.pow(2,10*(t/i-1))+e,easeOutExpo:(t,e,n,i)=>n*(1-Math.pow(2,-10*t/i))+e,easeInOutExpo:(t,e,n,i)=>(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:(t-=1,n/2*(2-Math.pow(2,-10*t))+e),easeInCirc:(t,e,n,i)=>(t/=i,-n*(Math.sqrt(1-t*t)-1)+e),easeOutCirc:(t,e,n,i)=>(t/=i,t-=1,n*Math.sqrt(1-t*t)+e),easeInOutCirc:(t,e,n,i)=>(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:(t-=2,n/2*(Math.sqrt(1-t*t)+1)+e)};class ke{constructor(t){this.parentObject=t,this.isUpdate=!1,this.onComplete=null,this.queue=[],this.handle={}}addAnim(t,...e){let n,i=1e3,s="easeOutCubic",o=null,a={},r=!1;e.forEach(t=>{switch(typeof t){case"number":i=t;break;case"string":s=t;break;case"function":o=t;break;case"object":a=t}});const c=Math.floor(i/1e3*nt);if(0!==this.queue.length&&a.isOverwrite){for(;this.queue.length>=2;)this.queue.pop();n=this.queue[0],"function"==typeof n.callback&&n.callback(),n.frame=0,n.type=s,n.callback=o,n.duration=c,Object.keys(t).forEach(e=>{const i=this.parentObject[e],s=t[e],o=s-i;0!==o&&(r=!0,n.props[e].startValue=i,n.props[e].endValue=s,n.props[e].changeInValue=o)}),r||("function"==typeof n.callback&&n.callback(),this.queue.pop())}else n={props:{},frame:0,duration:c,type:s,callback:o},Object.keys(t).forEach(e=>{const i=this.parentObject[e],s=t[e],o=s-i;0!==o&&(r=!0,n.props[e]={startValue:i,endValue:s,changeInValue:o})}),0!==this.queue.length||r?this.queue.push(n):"function"==typeof n.callback&&n.callback();return this}stop(){for(;this.queue.length;)this.queue.shift();this.onComplete=null}call(t){this.onComplete=t}getProperty(t){return this.parentObject[t]}getTargetProperty(t){if(this.queue.length>0){this.queue.length;for(let e=this.queue.length-1;e>=0;e-=1)if(t in this.queue[e].props)return this.queue[e].props[t].endValue}return this.parentObject[t]}tick(){if(0===this.queue.length)return this.isUpdate=!1,!1;const t=this.queue[0];t.frame+=1;const e={};if(Object.keys(t.props).forEach(n=>{const i=t.props[n],s=t.frame>=t.duration?i.endValue:xe[t.type](t.frame,i.startValue,i.changeInValue,t.duration);this.parentObject[n]=s,e[n]=s}),this.parentObject instanceof b2Body&&(e.body=this.parentObject,Jt(e)),t.frame>=t.duration){if("function"==typeof t.callback&&t.callback(),this.queue.shift(),0!==this.queue.length){let t,e=!1;do{t=this.queue[0],Object.keys(t.props).forEach(n=>{t.props[n].startValue=this.parentObject[n],t.props[n].changeInValue=t.props[n].endValue-t.props[n].startValue,0!==t.props[n].changeInValue&&(e=!0)}),e||("function"==typeof t.callback&&t.callback(),this.queue.shift())}while(this.queue.length>0&&!e)}0===this.queue.length&&"function"==typeof this.onComplete&&(this.onComplete(),this.onComplete=null)}return this.isUpdate=!0,!0}}class Ee{constructor(t){this.lisners={},this.isFalled=!1,this.isBookedFalling=!1,this.hasJumpedOut=!1,this.cjsObjects=[],this.cjsClick=null,this.cjsCloud=null,this.cjsBitmap=null,this.cjsPolygon=null,this.cjsBounds=null,this.physicsBody=null,this.sendOperationTimer=-1,this.isMoved=!1,this.isForced=!1,Object.assign(this,t),this.scale?(this.width=this.pathData.width*this.scale,this.height=this.pathData.height*this.scale):this.width?(this.scale=this.width/this.pathData.width,this.height=this.pathData.height*this.scale):this.height?(this.scale=this.height/this.pathData.height,this.width=this.pathData.width*this.scale):this.scale=1;const e=new b2BodyDef;if(e.type=b2_staticBody,e.position.Set(this.x/st,this.y/st),this.physicsBody=this.world.CreateBody(e),Object.assign(this.physicsBody,{x:0,y:0,vx:0,vy:0,angle:0,vangle:0,teleportX:0,shakeCount:0,rotateCount:0,name:this.name,vangleDirection:0,onAnimationEnd:null,animater:new ke(this.physicsBody)}),this.pathData){const t=this.scale/st,e=t*(this.pathData.width/2),n=t*(this.pathData.height/2);this.pathData.shapes.forEach(i=>{switch(i.type){case"circle":{const s=new b2CircleShape;s.radius=t*i.r,s.position=new b2Vec2(t*i.cx-e,t*i.cy-n);const o=new b2FixtureDef;o.density=i.density,o.friction=pt,o.restitution=gt,o.shape=s,this.physicsBody.CreateFixtureFromDef(o);break}case"path":{const{path:s}=i,o=new b2PolygonShape,a=Math.floor(s.length/2);a>mt&&Kt.log("フィクスチャに指定できる頂点の限界数を超えています。");for(let i=0;i<a;i+=1)o.vertices[i]=new b2Vec2(t*s[2*i+0]-e,t*s[2*i+1]-n);const r=new b2FixtureDef;r.density=i.density,r.friction=pt,r.restitution=gt,r.shape=o,this.physicsBody.CreateFixtureFromDef(r);break}}})}else{const t=new b2PolygonShape,e=this.width/2/st,n=this.height/2/st;t.SetAsBoxXYCenterAngle(e,n,new b2Vec2(0,0),0);const i=new b2FixtureDef;i.density=ht,i.friction=pt,i.restitution=gt,i.shape=t,this.physicsBody.CreateFixtureFromDef(i)}return w&&(this.cjsBounds=new createjs.Shape,this.stage.addChild(this.cjsBounds),this.cjsObjects.push(this.cjsBounds)),this.image&&!this.isField&&this.isOperable&&(this.cjsClick=new createjs.Shape,this.cjsClick.isClickObject=!0,this.cjsClick.set({x:0,y:0}),this.cjsClick.graphics.beginFill("#ffffff").rect(0,0,this.image.naturalWidth,this.image.naturalHeight),this.cjsObjects.push(this.cjsClick)),this.image&&(this.cjsBitmap=new createjs.Bitmap(this.image),this.cjsBitmap.set({x:this.x,y:this.y,scaleX:this.width/this.image.naturalWidth,scaleY:this.width/this.image.naturalWidth,regX:Math.floor(this.image.naturalWidth/2),regY:Math.floor(this.image.naturalHeight/2),hitArea:this.cjsClick}),this.stage.addChild(this.cjsBitmap),this.cjsObjects.push(this.cjsBitmap)),w&&(this.cjsPolygon=new createjs.Shape,this.cjsPolygon.set({x:this.x,y:this.y,regX:Math.floor(this.width/2),regY:Math.floor(this.height/2)}),this.stage.addChild(this.cjsPolygon),this.cjsObjects.push(this.cjsPolygon),this.refreshStroke(!1)),this.isField||(this.isOperable&&(this.sendOperation(),this.setupDragEvent(this.cjsBitmap)),this.cjsCloud=new createjs.Bitmap(this.cloudImage),this.cjsCloud.cloudAnimater=new ke(this.cjsCloud),this.cjsCloud.set({x:this.x,y:this.y,originX:this.x,originY:this.y,regX:Math.floor(this.cloudImage.naturalWidth/2),regY:Math.floor(this.cloudImage.naturalHeight/2),scale:.8,alpha:1}),this.stage.addChild(this.cjsCloud),this.cjsObjects.push(this.cjsCloud),this.cjsCloud.cloudAnimater.addAnim({scale:1,alpha:0},bt,()=>{this.stage.removeChild(this.cjsCloud),this.cjsCloud=null}),this.physicsBody.teleportX=Ot,Qt({body:this.physicsBody,x:this.physicsBody.teleportX})),this.tick(!0),this}setupDragEvent(){let t,e,n,i=!1;this.cjsBitmap.cursor="pointer",this.lisners.onmousedown=this.cjsBitmap.on("mousedown",()=>{this.needsOperate()&&(e=this.stage.mouseX-this.cjsBitmap.x,this.physicsBody.SetAwake(!0),t=se(),i=!0,n=this.stage.mouseX)}),this.lisners.onpressmove=this.cjsBitmap.on("pressmove",()=>{if(this.needsOperate()&&i){const t=this.stage.mouseX-e-this.canvasDetail.padding.x;Jt({body:this.physicsBody,x:t/st+this.physicsBody.teleportX}),this.isMoved=!0}}),this.lisners.onpressup=this.cjsBitmap.on("pressup",()=>{i&&this.isMovable()&&(n===this.stage.mouseX&&se()-t<200&&this.rotate(),i=!1)})}removeDragEvent(){this.cjsBitmap.cursor="",this.cjsBitmap.off("mousedown",this.lisners.onmousedown),this.cjsBitmap.off("pressmove",this.lisners.onpressmove),this.cjsBitmap.off("pressup",this.lisners.onpressup)}refreshStroke(t){const e=t?"rgba(255, 100, 0, 1)":"rgba(0, 100, 255, 1)",n=t?"rgba(255, 100, 0, 0.5)":"rgba(0, 100, 255, 0.5)";if(this.pathData){this.cjsPolygon.graphics.clear().beginFill(n).setStrokeStyle(ut),this.pathData.shapes.forEach(t=>{switch(t.type){case"circle":this.cjsPolygon.graphics.beginStroke(e).drawCircle(this.scale*t.cx,this.scale*t.cy,this.scale*t.r).endStroke();break;case"path":{this.cjsPolygon.graphics.beginStroke(e);const{path:n}=t,i=Math.floor(n.length/2);for(let t=0;t<=i;t+=1){const e=0===t?"moveTo":"lineTo",s=t<i?t:0,o=n[2*s+0]*this.scale,a=n[2*s+1]*this.scale;this.cjsPolygon.graphics[e](o,a)}this.cjsPolygon.graphics.endStroke();break}}});const t="rgba(255, 100, 0, 1)",i={x:this.width/2,y:this.height/2};this.cjsPolygon.graphics.beginStroke(t).setStrokeStyle(6).moveTo(i.x-10,i.y).lineTo(i.x+10,i.y).endStroke().beginStroke(t).moveTo(i.x,i.y-10).lineTo(i.x,i.y+10).setStrokeStyle(ut).endStroke();const s="rgba(255, 0, 255, 1)",o=-this.physicsBody.GetAngle(),a=Math.sin(o),r=Math.cos(o),c={x:this.scale*this.pathData.gCenter.x,y:this.scale*this.pathData.gCenter.y},l=t=>({x:-a*t.y+r*t.x,y:a*t.x+r*t.y}),u=l({x:0,y:100}),d=l({x:-5,y:90}),h=l({x:5,y:90});this.cjsPolygon.graphics.beginFill(s).drawCircle(c.x,c.y,6).beginStroke(s).moveTo(c.x,c.y).lineTo(c.x+u.x,c.y+u.y).endStroke().beginStroke(s).moveTo(c.x+u.x,c.y+u.y).lineTo(c.x+d.x,c.y+d.y).endStroke().beginStroke(s).moveTo(c.x+u.x,c.y+u.y).lineTo(c.x+h.x,c.y+h.y).endStroke();const p=Math.min(0,c.x+u.x),g=Math.min(0,c.y+u.y),m=Math.max(this.width,c.x+Math.abs(u.x)),f=Math.max(this.height,c.y+Math.abs(u.y));this.cjsPolygon.cache(p-ut,g-ut,m+2*ut,f+2*ut)}else this.cjsPolygon.graphics.clear().beginFill(n).setStrokeStyle(ut).beginStroke(e).drawRect(0,0,this.width,this.height).endStroke(),this.cjsPolygon.cache(0-ut,0-ut,this.width+2*ut,this.height+2*ut)}calcLeftTime(){const t=se()-this.timeCreate;return 1e3*this.timeLimit-t}tick(t){this.cjsCloud&&this.cjsCloud.cloudAnimater.tick();const e=t||this.needsRedraw();if(e){const t=this.physicsBody.GetPosition().x-this.physicsBody.teleportX,{y:e}=this.physicsBody.GetPosition(),n={x:t*st+this.canvasDetail.padding.x,y:e*st+this.canvasDetail.padding.y+this.scroller.getProperty("y"),rotation:Wt(this.physicsBody.GetAngle())};if(this.cjsBitmap&&this.cjsBitmap.set(n),this.cjsCloud&&this.cjsCloud.set({x:this.cjsCloud.originX+this.canvasDetail.padding.x,y:this.cjsCloud.originY+this.canvasDetail.padding.y+this.scroller.getProperty("y"),rotation:0}),this.cjsPolygon&&(this.cjsPolygon.set(n),this.refreshStroke(this.physicsBody.isAwake)),this.cjsBounds){const t=(this.cjsBitmap||this.cjsPolygon).getTransformedBounds();this.cjsBounds.x=t.x,this.cjsBounds.y=t.y,this.cjsBounds.graphics.clear().beginFill("rgba(100, 255, 0, 0.2)").setStrokeStyle(ut).beginStroke("rgba(100, 255, 0, 1)").drawRect(0,0,t.width,t.height).endStroke(),this.cjsBounds.cache(0-ut,0-ut,t.width+2*ut,t.height+2*ut)}}return this.saveTransform(),e}saveTransform(){Object.assign(this.physicsBody,{angle:this.physicsBody.GetAngle(),x:this.physicsBody.GetPosition().x,y:this.physicsBody.GetPosition().y,vx:this.physicsBody.GetLinearVelocity().x,vy:this.physicsBody.GetLinearVelocity().y,vangle:this.physicsBody.GetAngularVelocity()})}needsRedraw(){let t=!0;this.physicsBody.angle===this.physicsBody.GetAngle()&&this.physicsBody.x===this.physicsBody.GetPosition().x&&this.physicsBody.y===this.physicsBody.GetPosition().y&&(t=!1);const e=t!==this.physicsBody.isAwake;return this.physicsBody.isAwake=t,this.scroller.isUpdate||t||e||this.physicsBody.animater.isUpdate||this.cjsCloud}move(t){this.isMoved=!0;const e=this.physicsBody.GetPosition().x+t;this.physicsBody.animater.addAnim({x:e},wt,{isOverwrite:!0})}createOperation(t){const e={};return t?(e.x=this.physicsBody.GetPosition().x,e.y=this.physicsBody.GetPosition().y,e.angle=this.physicsBody.GetAngle()):(e.x=this.physicsBody.animater.getTargetProperty("x"),e.y=this.physicsBody.animater.getTargetProperty("y"),e.angle=this.physicsBody.animater.getTargetProperty("angle")),e.uid=this.ownerUid,t&&(e.isDown=t),this.isForced&&(e.isForced=this.isForced),e}sendOperation(){if(this.sendOperationTimer=setTimeout(()=>{this.sendOperation()},Et),this.needsOperate()&&this.isMoved&&this.isOnline){const t=this.createOperation(!1);this.app.network.sendOperation(this.stepCount,t),this.isMoved=!1}}isMovable(){return!this.isFalled&&!this.isBookedFalling}needsOperate(){return this.isOperable&&this.isMovable()}setDynamic(){this.physicsBody.SetType(b2_dynamicBody)}setStatic(){this.physicsBody.SetType(b2_staticBody)}teleport(){Qt({body:this.physicsBody,x:Ot})}drop(){if(document.getElementById("ope-button-outer").style.setProperty("display","none"),this.leftTimeElm.textContent="",0===this.physicsBody.animater.queue.length){const t=this.createOperation(!0);Jt({body:this.physicsBody,x:t.x,y:t.y,angle:t.angle}),Qt({body:this.physicsBody,x:-this.physicsBody.teleportX}),this.physicsBody.teleportX=0,this.physicsBody.SetType(b2_dynamicBody),this.isFalled=!0,this.removeDragEvent(),clearTimeout(this.sendOperationTimer),this.isOnline&&this.isOperable&&this.app.network.sendOperation(this.stepCount,t),this.app.sound.play(C)}else this.isBookedFalling=!0,this.physicsBody.animater.onComplete=()=>{this.drop()}}rotate(){this.isMoved=!0,this.physicsBody.rotateCount+=1;const t=zt(this.physicsBody.rotateCount/8*360);this.physicsBody.animater.addAnim({angle:t},wt,{isOverwrite:!0}),this.app.sound.play(B)}initShakeCount(){this.physicsBody.shakeCount=0}pushTo(t){return this.panels=t,this.index=t.length,t.push(this),this}remove(){this.world.DestroyBody(this.physicsBody),this.cjsObjects.forEach(t=>{this.stage.removeChild(t)});for(let t=this.index+1;t<this.panels.length;t+=1)this.panels[t].index-=1;this.panels.splice(this.index,1)}jumpOut(){this.hasJumpedOut=!0,this.setStatic(),this.teleport(),this.app.sound.play(I)}}const{createjs:Oe,b2AABB:Ae,b2World:je,b2Vec2:Se}=window,{logger:Te}=s;let Ie,Be,Ce,Pe,Le,Me,De,Re;const Ne=new ke({y:0}),_e=[];let $e,Ge,Ue,Fe=0;const He=[],Ve={},qe=[];let We,ze,Ye,Xe,Ke,Je,Qe,Ze,tn,en,nn=!1,sn=!1,on=!1,an=tt,rn=0;function cn(t){en=t}function ln(){return b?x:We}function un(){We=re().date}function dn(){We=re().unix}function hn(t){an=void 0===t?tt:t}function pn(t){We=t}function gn(t){sn=t}function mn(t){nn=t}function fn(t){$e=t}function yn(t){const e=J*Q.length,n=(t+e)%e;return Math.floor(n/J)}function wn(){return $e[Re].uid===en.network.getOwnUid()}function bn(){return!!y||(!sn||wn())}function vn(){let t=Tt;_e.forEach(e=>{const n=e.cjsBitmap.getTransformedBounds().y-Ne.getProperty("y")-en.view.canvasDetail.padding.y;n<t&&(t=n)}),t=Math.floor(t);const e={body:null,ReportFixture(t){this.body=t.body}},n=new Ae;if(t<Tt)for(let i=0;i<300;i+=1)if(t+=1,n.lowerBound.Set(-300/st,t/st),n.upperBound.Set((G+300)/st,t/st+.01),Ie.QueryAABB(e,n),e.body){t+=10;break}return t=Math.min(t,Tt),t}function xn(){const t=h;let e=0;t.forEach(t=>{e+=t.frequency});const n=[];for(let t=0;t<e;t+=1)n.push(t);const i=[];for(let s=0;s<e;s+=1){const e=Ue.getRandom(n.length);let s=n[e],o=t[0].id;for(let e=0;e<t.length;e+=1){if(s<t[e].frequency){o=t[e].id;break}s-=t[e].frequency}i.push(o),n.splice(e,1)}return i}function kn(){let t=0;return $e.forEach(e=>{e.life>0&&(t+=1)}),t}function En(){let t="Null";for(let e=0;e<$e.length;e+=1)if($e[e].life>0){t=$e[e].displayName;break}return t}function On(){Ce&&Ce.isOperable&&Ce.isMovable()&&Ce.rotate()}function An(){Ce&&Ce.isOperable&&Ce.isMovable()&&(Ce.drop(),_e.forEach(t=>{t.isField||t.setDynamic()}))}function jn(){Ce.isOperable=!0,Ce.isForced=!0,Ce.ownerUid=en.network.getOwnUid(),An()}function Sn(t,e){e<Pe||(e>Pe?t.isDown&&Ye.push(t):sn&&t.uid===en.network.getOwnUid()||Ce&&Ce.isForced||(!Ce||Ce.isMovable()||t.isForced)&&(t.isForced&&(Ce.isOperable=!1,Ce.ownerUid=t.uid),t.isDown?(Ce.physicsBody.animater.stop(),Jt({x:t.x,y:t.y,angle:t.angle,body:Ce.physicsBody}),Ce.drop()):Ce.physicsBody.animater.addAnim({angle:t.angle},kt,{isOverwrite:!0}).addAnim({x:t.x,y:t.y},kt),Te.log("receive operation: %o",t)))}async function Tn(){De=!1;const t=vn();0===Pe&&(Je=t),Me=_e.length-1;const e=Math.min(At,t-jt),n=Math.max(0,-e+St);Ne.addAnim({y:n},yt,{isOverwrite:!0});const i=yn(Pe);i!==Fe&&(qe[i].addAnim({alpha:1},yt,{isOverwrite:!0}),qe[Fe].addAnim({alpha:0},yt,{isOverwrite:!0}),Fe=i);const s=Ge[Pe%Ge.length];let o=h[0];for(let t=0;t<h.length;t+=1)if(s===h[t].id){o=h[t];break}const a=kn();do{Re=(Re+1)%$e.length}while($e[Re].life<=0&&a>=1);Qe.textContent="";const r=Pe+1,c=en.view.getTranslatedText(o.name);document.getElementById("step-info").innerText=`${r}. ${c}`;const l=se(),u=bn();if(Ce=new Ee({name:`${o.name}`,x:X,y:e,scale:o.scale,cloudImage:await Zt("./assets/img/monsters/cloud.png"),image:await Zt(`./assets/img/monsters/${o.name}.png`),pathData:await te(`./assets/img/monsters/${o.name}.svg`),ownerUid:$e[Re].uid,app:en,stage:Be,world:Ie,scroller:Ne,isOnline:sn,stepCount:Pe,timeLimit:an,timeCreate:l,leftTimeElm:Qe,isOperable:u,canvasDetail:en.view.canvasDetail}).pushTo(_e),sn&&u&&en.network.sendOperation(Pe,{isDown:!1}),en.sound.play(T),sn?wn()?(document.getElementById("ope-button-outer").style.setProperty("display","block"),document.getElementById("ones-turn-outer").style.setProperty("display","none"),en.view.log("your-turn")):(document.getElementById("turn-name").textContent=$e[Re].displayName,document.getElementById("ope-button-outer").style.setProperty("display","none"),document.getElementById("ones-turn-outer").style.setProperty("display","block")):document.getElementById("ope-button-outer").style.setProperty("display","block"),Ye.length>0){Sn(Ye.shift(),Pe)}if(on){const t=`000${Pe}`.slice(-3);Sn(Ke[`step-${t}`],Pe)}ge("gamestep",{stepCount:Pe,panelCount:Me,towerHeight:Le}),Te.log(`%cStep ${Pe+1}. ${Xt(o.name)} (${Le}m)`,Te.getMarkerStyle("orange")),Te.log(`Player: ${$e[Re].displayName} `+`${u?"(Your Turn)":" (Other's Turn)"}`)}function In(t){if(t){const t=$e[Re];t.life-=1,t.life<=0&&(t.deathOrder=Ze,Ze+=1,Te.log(`${t.displayName} died!`)),kn()<=1?(ge("gamefinish",{stepCount:Pe,panelCount:Me,towerHeight:Le,playerStates:$e,stageCache:tn}),Te.log(`${En()} win!`)):Tn()}else Tn()}function Bn(t){if(!t)return;let e=!1;const n=JSON.parse(t),i=Object.keys(n);Te.log("receive panelStates: %o",n);for(let t=0;t<_e.length;t+=1){const s=_e[t],o=`${s.stepCount}`;if(!s.isField&&i.indexOf(o)>-1){const i=n[o];i.j?(s.hasJumpedOut||en.sound.play(I),e=!0,Kt.log(`${s.name} jumped out!`),s.remove(),t-=1):(s.hasJumpedOut=!1,s.setStatic(),Jt({body:s.physicsBody,x:i.x,y:i.y,angle:i.a}))}}De=!0,Pe+=1;const s=Ce.hasJumpedOut?xt:vt;setTimeout(()=>{In(e)},s),Be.update(),Ce=null;const o=en.view.canvasDetail;Be.cache(o.padding.x,o.padding.y,o.originWidth,o.originHeight),tn=Be.getCacheDataURL(),Be.uncache(),Le=Yt((Je-vn())/ot,2)}function Cn(){const t={};return _e.forEach(e=>{e.isField||(t[e.stepCount]={a:e.physicsBody.GetAngle(),x:e.physicsBody.GetPosition().x,y:e.physicsBody.GetPosition().y,j:e.hasJumpedOut})}),t}function Pn(){if(Te.log("all bodies sleep"),Pe+=1,!sn){let t=!1;for(let e=0;e<_e.length;e+=1){const n=_e[e];n.initShakeCount(),n.hasJumpedOut&&(t=!0,Kt.log(`${n.name} jumped out!`),n.remove(),e-=1)}nn?Tn():In(t)}}function Ln(){Q.forEach((t,e)=>{He[e].graphics.clear().beginLinearGradientFill(t,[0,.5,1],0,Xe.height,0,0).drawRect(0,0,Xe.width,Xe.height),He[e].cache(0,0,Xe.width,Xe.height)}),Ve.boat.set({x:Math.floor(.5*Xe.width),y:Math.floor(.4*Xe.height),regX:Math.floor(Ve.boat.image.naturalWidth/2),regY:Math.floor(Ve.boat.image.naturalHeight/2),scale:.7,alpha:.4}),Ve.rock.set({x:Math.floor(.5*Xe.width),y:Math.floor(.25*Xe.height),regX:Math.floor(Ve.rock.image.naturalWidth/2),regY:Math.floor(Ve.rock.image.naturalHeight/2),scale:.7,alpha:.6})}function Mn(){Ie.Step(rt,ct,lt),_e.forEach(t=>{const e=t.physicsBody;if(e.animater.tick(),!1===e.isAwake)return;e.GetPosition().y>Bt&&(t.hasJumpedOut||t.jumpOut());const n=e.GetLinearVelocity();let i=e.GetAngularVelocity();const s=i>=0?1:-1;0!==e.vangleDirection&&e.vangleDirection!==s&&(e.shakeCount+=1),e.vangleDirection=s;const o=0!==e.vy&&0===e.vx&&0===e.vangle,a=0!==n.x||0!==i||e.vy>n.y;o&&a?(n.x*=Ct,n.y*=Ct,i*=Ct):0!==i&&e.shakeCount>=Pt&&(i*=Lt),n.y=Math.min(dt,n.y),e.SetLinearVelocity(n),e.SetAngularVelocity(i)})}function Dn(t){let e=!!t.needsRedraw;if(Mn(),e=Ne.tick()||e,qe.forEach(t=>{e=t.tick()||e}),_e.forEach(t=>{e=t.tick()||e}),e&&Be.update(),Ce&&Ce.isFalled&&!e)if(sn&&!De&&Ce.isOperable){const t=Cn();en.network.sendPanelStates(t),De=!0}else if(!sn){const t=Ce.hasJumpedOut?xt:vt;setTimeout(()=>{Pn()},t),Be.update(),Ce=null;const e=en.view.canvasDetail;Be.cache(e.padding.x,e.padding.y,e.originWidth,e.originHeight),tn=Be.getCacheDataURL(),Be.uncache(),Le=Yt((Je-vn())/ot,2)}if(an>0&&Ce&&Ce.needsOperate()){const t=Ce.calcLeftTime(),e=Math.max(0,Math.ceil(t/1e3));e!==rn&&(Qe.setAttribute("time",e),Qe.classList.remove("animation"),setTimeout(()=>{Qe.classList.add("animation"),Qe.textContent=e},17)),t<=0&&Ce.drop(),rn=e}}async function Rn(){const t=f&&"firefox"===le()?30:at;Ie=new je(new Se(0,t)),window.world=Ie,Xe=document.getElementById(N),en.storage.get("settings").isEnabledStageGL?(Be=new Oe.StageGL(Xe),Be.setClearColor(K)):Be=new Oe.Stage(Xe),Xe.stage=Be,Be.enableMouseOver(),Oe.Touch.isSupported()&&Oe.Touch.enable(Be),it?(Oe.Ticker.timingMode=Oe.Ticker.TIMEOUT,Oe.Ticker.framerate=nt):nt>=60?Oe.Ticker.timingMode=Oe.Ticker.RAF:(Oe.Ticker.timingMode=Oe.Ticker.RAF_SYNCHED,Oe.Ticker.framerate=nt);for(let t=0;t<Q.length;t+=1)He[t]=new Oe.Shape,He[t].alpha=0===t?1:0,qe[t]=new ke(He[t]),Be.addChild(He[t]);const e=await Zt("./assets/img/back/boat.png"),n=new Oe.Bitmap(e);Be.addChild(n),Ve.boat=n;const i=await Zt("./assets/img/back/rock.png"),s=new Oe.Bitmap(i);Be.addChild(s),Ve.rock=s,Ln(),Be.update(),me("canvasresize.stage",t=>{Be instanceof Oe.StageGL&&Be.updateViewport(t.detail.width,t.detail.height),_e.forEach(t=>{t.tick(!0)}),Ln(),Be.update()}),Te.log("%cGame initialized",Te.getMarkerStyle("skyblue"))}function Nn(){for(;_e[0];)_e[0].remove();Ne.addAnim({y:0},yt,{isOverwrite:!0}),0!==Fe&&(qe[0].addAnim({alpha:1},yt,{isOverwrite:!0}),qe[Fe].addAnim({alpha:0},yt,{isOverwrite:!0})),Ce=null,Pe=0,Le=0,Me=0,Re=-1,ze=!0,Fe=0,Ye=[],rn=0,Ze=0,Qe&&(Qe.textContent=""),Oe.Ticker.reset(),Dn({needsRedraw:!0}),Te.log("%cGame finished",Te.getMarkerStyle("skyblue"))}async function _n(t){if(ze||Nn(),t){const e=[];Object.keys(t.orders).forEach(n=>{const i=t.orders[n],s=parseInt(n.split("-")[1],10);e[s]={uid:i,displayName:t.members[i].displayName,photoURL:t.members[i].photoURL}}),fn(e),pn(t.seed),mn(!1)}for(let t=0;t<$e.length;t+=1)$e[t].life=et,$e[t].deathOrder=$e.length-1;const e=ln();Ue=new ve(e),Qe=document.getElementById("left-time"),Ge=xn(),new Ee({name:"floor",x:X,y:Tt,width:It,isField:!0,image:await Zt("./assets/img/monsters/field.png"),pathData:await te("./assets/img/monsters/field.svg"),app:en,canvasDetail:en.view.canvasDetail,stage:Be,world:Ie,scroller:Ne}).pushTo(_e),Tn(),ze=!1,Oe.Ticker.on("tick",Dn),ge("gamebegin",{seed:e}),Te.log(`Seed: ${e}`),Te.log(`Monster Tiles: ${JSON.stringify(Ge)}`),Te.log(`Player Names: ${JSON.stringify($e)}`),Te.log("%cGame begined",Te.getMarkerStyle("skyblue"))}function $n(t){Ce&&Ce.isOperable&&!Ce.isFalled&&Ce.move(t)}function Gn(t){sn=!1,nn=!0,$e=[{uid:"1P",displayName:"1P"},{uid:"2P",displayName:"2P"}],We=t.seed,Ke=t.operations,on=!0,_n()}function Un(){_n()}function Fn(){dn(),_n()}const Hn={label:"loading",async enter(){let t=0;const e=["./assets/img/forcss/volume-0.png","./assets/img/forcss/volume-1.png","./assets/img/forcss/volume-2.png","./assets/img/forcss/volume-3.png","./assets/img/forcss/mask-hooked.png","./assets/img/forcss/mask-holed.png","./assets/img/forcss/mask-chipped.svg","./assets/img/forcss/wave-1.png"],n=e.length+2*h.length;function i(){t+=1;Math.floor(100*t/n)}this.app.view.showLoading();for(let t=0;t<e.length;t+=1)await Zt(e[t]),i();for(let t=0;t<h.length;t+=1)await Zt(`./assets/img/monsters/${h[t].name}.png`),i(),await te(`./assets/img/monsters/${h[t].name}.svg`),i();setTimeout(()=>{this.app.view.hideLoading(),this.app.view.firstJump()},100)},leave(){}},Vn={label:"title",bgm:"gogo.mp3",enter(){if(this.append({id:"sign-state-container",class:"sign-state-container",contents:[{id:"connecting",class:"sign-state",style:{display:"none"},contents:[{text:"connecting",class:"sign-state-connecting"}]},{id:"signed-in",class:"sign-state",style:{display:"none"},contents:[{tag:"img",src:"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7",class:"sign-state-photo",onclick:()=>{this.app.view.alert({title:"sign-out",message:"sign-out-heads-up",ok:()=>{this.app.network.signOut()}})}},{class:"sign-state-name"}]},{id:"sign-in",class:"sign-state clickable",style:{display:"none"},contents:[{text:"sign-in-with-twitter",class:"sign-state-sign-in",onclickonce:()=>{this.app.network.signIn()}}]}]}),this.append({id:"title-logo",class:"title-logo",contents:[{text:"logo-salmon",class:"title-logo-salmon"},{text:"logo-tower-battle",class:"title-logo-tower-battle"}]}),this.append({id:"play-in-offline",class:"title-button clickable",jump:"offline-game",contents:[{class:"title-button-back"},{text:"play-in-offline",class:"title-button-content shadow-text"},{text:"play-in-offline-footer",class:"title-button-footer shadow-text"}]}),this.append({id:"create-private-room",class:"title-button clickable",onclick:()=>{"signed-in"===this.app.network.getSignState()?this.app.view.jump("private-room"):this.app.view.alert({title:"heads-up",message:"private-room-not-signed-in"})},contents:[{class:"title-button-back"},{text:"private-room",class:"title-button-content shadow-text"},{text:"create-private-room-footer",class:"title-button-footer shadow-text"}]}),this.append({id:"settings",class:"title-button clickable",jump:"settings",contents:[{class:"title-button-back"},{text:"settings",class:"title-button-content shadow-text"},{text:"settings-footer",class:"title-button-footer shadow-text"}]}),this.append({text:`Ver.${this.constants.APP_VERSION}`,class:"title-version"}),!document.getElementById("speaker")){const{app:t}=this,{globalVolume:e}=t.storage.get("settings");this.append({layer:"fix",id:"speaker",class:`speaker volume-${e}`,attr:{volume:e},onclick(){const e=parseInt(this.getAttribute("volume"),10),n=(e+4+1)%4;this.setAttribute("volume",n),this.classList.remove(`volume-${e}`),this.classList.add(`volume-${n}`),t.sound.changeVolume(n)}}),document.title=this.app.view.getTranslatedText("title")}if("connecting"===this.app.network.getSignState())this.utilities.addDocumentEventListener("authstatechange",t=>{document.getElementById("connecting").style.setProperty("display","none"),this.updateSignState(t.detail)}),document.getElementById("connecting").style.setProperty("display","block");else{const t=this.app.network.getOwnUserData();this.updateSignState(t)}},updateSignState(t){t?(document.getElementById("signed-in").style.setProperty("display","block"),document.querySelector(".sign-state-photo").setAttribute("src",t.photoURL),document.querySelector(".sign-state-name").textContent=t.displayName):document.getElementById("sign-in").style.setProperty("display","block")},leave(){this.utilities.removeDocumentEventListener("authstatechange")}},qn={label:"private-room",async createRoom(){this.app.view.clearLayer("main"),this.app.view.showLoading();const t=await this.app.network.createRoom("private");this.app.view.jump("wait-online-game",{roomId:t,isHost:!0}),this.app.view.hideLoading()},async enter(){this.app.view.showLoading();const t=(await this.app.network.getOwnUserDataNewly()).ownPrivateRoom,e=this.utilities.getQueries().invite;this.app.view.hideLoading(),t||this.append({class:"spiky-button",text:"create-private-room",onclick:()=>{t?this.app.view.alert({title:"heads-up",message:"create-private-room-caution",ok:()=>{this.createRoom()}}):this.createRoom()}}),t&&(this.append({class:"spiky-button",text:"go-to-own-private-room",onclick:()=>{this.app.view.jump("wait-online-game",{roomId:t,isHost:!0})}}),this.append({class:"spiky-button danger",text:"destroy-own-private-room",onclick:()=>{this.app.view.alert({title:"heads-up",message:"destroy-private-room-caution",ok:async()=>{this.app.view.clearLayer("main"),this.app.view.showLoading(),await this.app.network.destroyRoom("private",t),this.app.view.hideLoading(),this.app.view.jump("private-room")}})}})),e&&this.append({class:"spiky-button",text:"go-to-invited-private-room",onclick:()=>{this.app.view.jump("wait-online-game",{roomId:e,isHost:!1})}}),this.append({class:"return-title-lb",text:"exit",jump:"title"})},leave(){}},Wn={label:"sign-in",enter(){const t={layer:0,x:"50%",width:600,centering:!0,style:{color:"#000000",position:"absolute","font-size":"60px","line-height":"100%",margin:"0","text-align":"center"}};this.append("div","sign-in-with-twitter",t,{y:100,onclick:()=>{}}),this.append("div","go-title",t,{y:200,jump:"title"})},leave(){}},zn={label:"settings",enter(){function t(t){const e=t.parentNode.childNodes;Array.prototype.forEach.call(e,t=>{t.classList.remove("selected")}),t.classList.add("selected")}const{app:e}=this;this.append({text:"webgl-desc",class:"config-desc"}),this.append({class:"config-line",contents:[{text:"WebGL",class:"config-line-content"},{class:"config-line-item-container",contents:[{id:"webgl-off",text:"OFF",class:"config-line-item config-webgl",onclick(){t(this),e.storage.get("settings").isEnabledStageGL=!1,e.storage.save("settings")}},{id:"webgl-on",text:"ON",class:"config-line-item config-webgl",onclick(){t(this),e.storage.get("settings").isEnabledStageGL=!0,e.storage.save("settings")}}]}]}),this.append({text:"lang-desc",class:"config-desc"}),this.append({class:"config-line",contents:[{text:"language",class:"config-line-content"},{class:"config-line-item-container",contents:[{id:"lang-ja",text:"日本語",class:"config-line-item config-lang",onclick(){t(this),e.storage.get("settings").language="ja",e.storage.save("settings"),e.view.jump("settings")}},{id:"lang-en",text:"English",class:"config-line-item config-lang",onclick(){t(this),e.storage.get("settings").language="en",e.storage.save("settings"),e.view.jump("settings")}}]}]});const n=[];n.push(this.app.storage.get("settings").isEnabledStageGL?"webgl-on":"webgl-off"),n.push("ja"===this.app.storage.get("settings").language?"lang-ja":"lang-en"),n.forEach(t=>{document.getElementById(t).classList.add("selected")}),this.append({text:"戻る",class:"return-title-lb",jump:"title"})},leave(){}},Yn={label:"invite",bgm:"gogo.mp3",async enter(){this.app.view.showLoading();const t=this.app.network.getOwnUserData();if(void 0!==t){if(this.app.view.hideLoading(),null===t)this.enterNotSignedIn();else{const t=this.utilities.getQueries().invite,e=await this.app.network.getRoom("private",t);e?this.enterInvatation(e,t):this.enterInvalidInvatation()}if(!document.getElementById("speaker")){const{app:t}=this,{globalVolume:e}=t.storage.get("settings");this.append({layer:"fix",id:"speaker",class:`speaker volume-${e}`,attr:{volume:e},onclick(){const e=parseInt(this.getAttribute("volume"),10),n=(e+4+1)%4;this.setAttribute("volume",n),this.classList.remove(`volume-${e}`),this.classList.add(`volume-${n}`),t.sound.changeVolume(n)}})}this.append({class:"return-title-lb",text:"exit",jump:"title"})}else this.utilities.addDocumentEventListener("authstatechange",()=>{this.utilities.removeDocumentEventListener("authstatechange"),this.enter()})},enterNotSignedIn(){this.append({id:"invite-card-not-signed",class:"invite-card",contents:[{class:"invite-card-back"},{text:"invitation-not-signed-in",class:"invite-message"},{text:"sign-in-with-twitter",class:"invite-sign-in-button",onclick:()=>{this.app.network.signIn()}}]})},enterInvalidInvatation(){this.append({id:"invite-card-not-signed",class:"invite-card",contents:[{class:"invite-card-back"},{text:"invitation-invalid",class:"invite-message"}]})},enterInvatation(t,e){this.append({id:"invite-card",class:"invite-card",contents:[{class:"invite-card-back"},{tag:"img",src:t.ownerUser.photoURL,class:"invite-photo"},{text:"invitation",innerSpanText:t.ownerUser.displayName,class:"invite-message"},{text:"join",class:"invite-join-button",onclick:async()=>{this.app.view.jump("wait-online-game",{roomId:e,isHost:!1})}}]})},leave(){}},Xn={label:"offline-game",enter(){this.append({class:"game-random-seed",contents:[{tag:"span",text:"offline-seed"},{tag:"span",class:"count"}]}),this.append({class:"game-panel-count",contents:[{tag:"span",text:"offline-salmonids"},{tag:"span",class:"count"}]}),this.append({class:"game-tower-height",contents:[{tag:"span",text:"offline-height"},{tag:"span",class:"count"}]}),this.append({id:"left-time",class:"left-time"}),this.append({id:"step-info",class:"step-info"}),this.append({id:"ope-button-outer",class:"ope-button-outer",contents:[{text:"drop",class:"drop-button",onclick:()=>{this.app.game.execOperationDown()}},{class:"rotate-button",onclick:()=>{this.app.game.execOperationRotate()},contents:[{tag:"img",src:"./assets/img/forcss/rotate.svg"}]}]}),this.append({class:"game-menu-rt",onclick:()=>{document.querySelector(".game-menu-outer").style.setProperty("display","block")}}),this.append({class:"game-menu-outer",style:{display:"none"},contents:[{class:"game-menu-button-outer",contents:[{class:"alert-button",text:"game-start-over",onclick:()=>{this.app.game.startOver(),document.querySelector(".game-menu-outer").style.setProperty("display","none")}},{class:"gemu-menu-button-desc right",text:"game-start-over-desc"}]},{class:"game-menu-button-outer",contents:[{class:"gemu-menu-button-desc left",text:"game-start-again-desc"},{class:"alert-button",text:"game-start-again",onclick:()=>{this.app.game.startAgain(),document.querySelector(".game-menu-outer").style.setProperty("display","none")}}]},{class:"game-menu-button-outer",contents:[{class:"alert-button",text:"game-exit",jump:"title"},{class:"gemu-menu-button-desc right",text:"game-exit-desc"}]},{class:"game-menu-close",text:"close",onclick:()=>{document.querySelector(".game-menu-outer").style.setProperty("display","none")}}]}),this.utilities.addDocumentEventListener("gamebegin",t=>{document.querySelector(".game-random-seed .count").textContent=`${t.detail.seed}`}),this.utilities.addDocumentEventListener("gamestep",t=>{const e=this.app.view.getTranslatedText("salmonid-counter");document.querySelector(".game-tower-height .count").textContent=`${t.detail.towerHeight} m`,document.querySelector(".game-panel-count .count").textContent=`${t.detail.panelCount} ${e}`}),this.app.game.setIsOnline(!1),this.app.game.setIsEndless(!0),this.app.game.setTimeLimit(0),this.app.game.setPlayerStates([{uid:"1P",displayName:"1P"}]),this.app.game.setUnixSeed(),this.app.game.setTodaySeed(),this.app.game.beginGame()},oncanvasresize(t){const e=document.getElementById("createjs-bottom-buttons");e&&(e.style.setProperty("left",`${t.detail.padding.x}px`),e.style.setProperty("bottom",`${t.detail.padding.y}px`),e.style.setProperty("width",`${t.detail.width}px`))},leave(){this.utilities.removeDocumentEventListener("gamebegin"),this.utilities.removeDocumentEventListener("gamestep"),this.app.game.finishGame()}},Kn={label:"online-game",enter(t){this.roomId=t.roomId,this.append({id:"left-time",class:"left-time"}),this.append({id:"step-info",class:"step-info"}),this.append({id:"ope-button-outer",class:"ope-button-outer",contents:[{text:"drop",class:"drop-button",onclick:()=>{this.app.game.execOperationDown()}},{class:"rotate-button",onclick:()=>{this.app.game.execOperationRotate()},contents:[{tag:"img",src:"./assets/img/forcss/rotate.svg"}]}]}),this.append({id:"ones-turn-outer",class:"ope-button-outer",contents:[{class:"turn-title selectable",text:'<span id="turn-name">サーモン太郎</span>のターン'}]}),t.isHost&&(this.append({class:"game-menu-rt",onclick:()=>{document.getElementById("game-menu-rt").style.setProperty("display","block")}}),this.append({id:"game-menu-rt",class:"game-menu-outer",style:{display:"none"},contents:[{class:"game-menu-button-outer",contents:[{class:"gemu-menu-button-desc left",text:"game-online-forced-drop-desc"},{class:"alert-button",text:"game-online-forced-drop",onclick:()=>{this.app.game.execOperationDownForcibly(),document.getElementById("game-menu-rt").style.setProperty("display","none")}}]},{class:"game-menu-button-outer",contents:[{class:"alert-button",text:"game-online-exit",onclick:()=>{this.app.network.finishGame("private",t.roomId)}},{class:"gemu-menu-button-desc right",text:"game-online-exit-desc"}]},{class:"game-menu-close",text:"close",onclick:()=>{document.getElementById("game-menu-rt").style.setProperty("display","none")}}]}));const e=t.isHost?{class:"game-result-return",text:"result-return",onclick:()=>{document.getElementById("game-result").style.setProperty("display","none"),this.app.network.finishGame("private",t.roomId)}}:null,n=t.isHost?{class:"game-result-again",text:"result-again",onclick:()=>{document.getElementById("game-result").style.setProperty("display","none"),this.app.network.againGame("private",t.roomId)}}:null;this.append({id:"game-result",class:"game-menu-outer",style:{display:"none","padding-left":`${this.app.view.canvasDetail.padding.x}px`,"padding-top":`${this.app.view.canvasDetail.padding.y}px`},contents:[{class:"game-result-container",contents:[{class:"result-detail",contents:[{class:"result-fall-count-desc",text:"result-fall-count-desc"},{class:"result-fall-count"},{class:"result-ride-count-desc",text:"result-ride-count-desc"},{class:"result-ride-count"},{class:"result-height-desc",text:"result-height-desc"},{class:"result-height"}]},{class:"result-win-text",innerHTML:"WIN!"},{tag:"img",class:"result-screen",src:"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7"},{class:"result-winner",contents:[{tag:"img",src:"data:image/gif;base64,R0lGODlhAQABAGAAACH5BAEKAP8ALAAAAAABAAEAAAgEAP8FBAA7"},{tag:"br"},{tag:"span"}]},{id:"result-players",class:"result-players"},e,n]}]}),this.app.game.setTimeLimit(),this.app.game.setIsOnline(!0),this.app.game.setIsEndless(!1),this.app.game.beginGame(t.room);const i=()=>{this.app.view.alert({title:"heads-up",message:"room-was-destroyed",ok:()=>{this.app.view.jump("title")},onlyok:!0})};this.app.network.setupGaming("private",t.roomId,{onremovemember:(e,n)=>{n!==this.app.network.getOwnUid()?n===t.room.ownerUser.uid&&i():i()},onchangeroomstate:async e=>{if("waiting"===e)this.app.view.jump("wait-online-game",{roomId:t.roomId,isHost:t.isHost,isWaitingGame:!0});else if(e.indexOf("playing")>-1){document.getElementById("game-result").style.setProperty("display","none");const e=await this.app.network.getRoom("private",t.roomId);this.app.game.beginGame(e)}}}),this.utilities.addDocumentEventListener("gamefinish",t=>{const e=document.getElementById("game-result"),n=this.app.view.getTranslatedText("salmonid-counter");e.querySelector(".result-fall-count").textContent=`${t.detail.stepCount} ${n}`,e.querySelector(".result-ride-count").textContent=`${t.detail.panelCount} ${n}`,e.querySelector(".result-height").textContent=`${t.detail.towerHeight} m`,e.querySelector(".result-screen").src=t.detail.stageCache,this.utilities.emptyElement(".result-players");const i=[],s=t.detail.playerStates;s.forEach(t=>{const e=s.length-t.deathOrder-1;i[e]=t}),e.querySelector(".result-winner>img").src=i[0].photoURL,e.querySelector(".result-winner>span").textContent=i[0].displayName;for(let t=1;t<i.length;t+=1)this.append({layer:"result-players",tag:"img",src:i[t].photoURL});e.style.setProperty("display","block")}),window.onbeforeunload=()=>{if(t.isHost)return"いまウィンドウを閉じると、部屋が崩れることになります。よろしいですか？"},window.onunload=()=>{this.app.network.leaveRoom("private",t.roomId)}},leave(t){window.onbeforeunload=null,window.onunload=null,this.utilities.removeDocumentEventListener("gamefinish"),this.app.network.teardownGaming("private",this.roomId),this.app.game.finishGame(),t.isWaitingGame||this.app.network.leaveRoom("private",this.roomId)}},Jn={label:"replay",enter(t){this.append({id:"left-time",class:"left-time"}),this.append({id:"step-info",class:"step-info"}),this.append({id:"ope-button-outer",class:"ope-button-outer",contents:[{text:"drop",class:"drop-button",onclick:()=>{this.app.game.execOperationDown()}},{class:"rotate-button",onclick:()=>{this.app.game.execOperationRotate()},contents:[{tag:"img",src:"./assets/img/forcss/rotate.svg"}]}]}),this.app.game.replayGame(t.room)},leave(){}},Qn={label:"wait-online-game",async enter(t){this.app.view.showLoading(),this.roomId=t.roomId;const e=`${window.location.href.split("?")[0]}?invite=${t.roomId}`,n=t.isHost?"host":"gest";let i;if(i=await this.app.network.getRoom("private",t.roomId)?await this.app.network.joinRoom("private",t.roomId):"room-doesnt-exist",i)return this.app.view.hideLoading(),void this.app.view.alert({title:"heads-up",message:i,ok:()=>{this.app.view.jump("title")},onlyok:!0});t.isHost&&await this.app.network.readyRoom("private",t.roomId),this.app.view.hideLoading(),t.isHost&&this.append({text:"招待URLを見る",class:"show-url-button",onclick:()=>{document.querySelector(".invite-url-outer").style.setProperty("display","block")}}),this.append({id:"room-member-outer",class:`room-member-outer room-member-outer-${n}`});let s=!1;if(t.isHost?this.append({id:"game-start-button",class:"game-start-button",text:"start",style:{display:"block"},onclick:async()=>{if(s)return;s=!0;const e=await this.app.network.getRoom("private",t.roomId),n=Object.keys(e.members);let i=!0;for(let t=0;t<n.length;t+=1){if("waiting"!==e.members[n[t]].state){i=!1;break}}i?this.app.network.beginGame("private",t.roomId):this.app.view.alert({title:"heads-up",message:"not-all-waiting"}),s=!1}}):this.append({class:"waiting-start",text:"waiting-game-start"}),this.append({class:"return-title-lb",text:"exit",jump:"title"}),t.isHost){let t=null;this.append({style:{display:"none"},class:"invite-url-outer",contents:[{class:"invite-url-desc",text:"please-share-url"},{id:"invite-url",class:"invite-url",innerHTML:e},{class:"invite-url-copy",text:"copy",onclick:()=>{const n=document.getElementById("invite-url-copied");this.utilities.execCopy(e,"invite-url")&&(clearTimeout(t),n.classList.remove("animation"),t=setTimeout(()=>{n.classList.add("animation")},17))}},{id:"invite-url-copied",class:"invite-url-copied",text:"copied"},{class:"invite-url-close",text:"close",onclick:()=>{window.getSelection().removeAllRanges(),document.getElementById("invite-url-copied").classList.remove("animation"),document.querySelector(".invite-url-outer").style.setProperty("display","none")}}]})}this.app.network.setupWaiting("private",t.roomId,{onaddmember:(e,n)=>{t.isHost&&document.getElementById("game-start-button").style.setProperty("display","block"),this.append({id:n,attr:{state:e.state},layer:"room-member-outer",class:"room-member",contents:[{class:"room-member-back"},{tag:"img",class:"room-member-photo",src:e.photoURL},{class:"room-member-name",innerHTML:e.displayName},{class:"room-member-state",text:e.state}],onclick:()=>{if(t.isHost&&n!==this.app.network.getOwnUid()){const i=e.displayName.length>10?`${e.displayName.substr(0,10)}…`:e.displayName;this.app.view.alert({title:"heads-up",message:"deport-room-member",vars:{name:i},ok:()=>{this.app.network.remove(`private-rooms/${t.roomId}/members/${n}`)}})}}})},onremovemember:(t,e)=>{const n=document.getElementById(e);n&&n.parentNode.removeChild(n),e===this.app.network.getOwnUid()&&this.app.view.alert({title:"heads-up",message:"room-was-destroyed",ok:()=>{this.app.view.jump("title")},onlyok:!0})},onchangeroomstate:async e=>{if(e.indexOf("playing")>-1){const e=await this.app.network.getRoom("private",t.roomId);this.app.view.jump("online-game",{userData:this.app.network.getOwnUserData(),room:e,roomId:t.roomId,isHost:t.isHost,isStartingGame:!0})}},onchangememberstate:(t,e)=>{const n=document.getElementById(e);n&&(n.setAttribute("state",t.state),n.querySelector(".room-member-state").textContent=this.app.view.getTranslatedText(t.state))}}),window.onunload=()=>{this.app.network.leaveRoom("private",t.roomId)}},leave(t){window.onbeforeunload=null,window.onunload=null,this.app.network.teardownWaiting("private",this.roomId),t.isStartingGame||this.app.network.leaveRoom("private",this.roomId)}};var Zn={title:{ja:"サーモンタワーバトル",en:"Salmon Tower Battle"},"logo-salmon":{ja:"サーモン",en:"Salmon"},"logo-tower-battle":{ja:"タワーバトル",en:"Tower Battle"},"sign-in-with-twitter":{ja:"Twitterでログインする",en:"Sign In With Twitter"},"private-room":{ja:"プライベートルーム",en:"Private Room"},"create-private-room-footer":{ja:"フレンドを招待していっしょに遊べる！",en:"You can invite and play with friends!"},"play-in-offline":{ja:"ひとりで遊ぶ",en:"Play by Myself"},"play-in-offline-footer":{ja:"ひとりでとことん練習できる！",en:"You can practice by myself thoroughly!"},settings:{ja:"オプション",en:"Settings"},"settings-footer":{ja:"ゲーム設定を変更する",en:"You can change game settings"},"heads-up":{ja:"注意",en:"HEADS UP"},"private-room-not-signed-in":{ja:"プライベートルームを作るためには<br><b>Twitterでログイン</b>する必要があります",en:"You should <b>sign in with Twitter</b><br>in order to create a private room"},"sign-out":{ja:"ログアウト",en:"SIGN OUT"},"sign-out-heads-up":{ja:"ログアウトします<br>よろしいですか？",en:"Would you like to sign out?"},cool:{ja:"はい！",en:"Cool!"},"not-cool":{ja:"いいえ",en:"Not Cool"},ok:{ja:"はい！",en:"OK!"},"webgl-desc":{ja:"動作が低速または不安定の場合、<br>OFFにすると改善する可能性があります(リロード後に有効)",en:'If your app is slow or unstable, <br>please try setting "OFF" (valid after a reload)'},language:{ja:"言語",en:"Language"},"lang-desc":{ja:"言語を日本語または英語から選ぶことができます",en:"Please choose language from Japanese or English"},exit:{ja:"戻る",en:"Exit"},"create-private-room":{ja:"プライベートルームを作る",en:"Create private room"},"create-private-room-caution":{ja:"いまあるプライベートルームは崩れますが<br>よろしいですか？",en:"Existing room will be destroyed<br>Are you cool with that?"},"destroy-private-room-caution":{ja:"プライベートルームを崩します<br>よろしいですか？",en:"The room will be destroyed<br>Are you cool with that?"},"go-to-own-private-room":{ja:"自分のプライベートルームに行く",en:"Go to my private room"},"destroy-own-private-room":{ja:"自分のプライベートルームを壊す",en:"Destroy my private room"},"go-to-invited-private-room":{ja:"招待されているプライベートルームに行く",en:"Go to room you are invited"},start:{ja:"スタート！",en:"START!"},"please-share-url":{ja:"以下の招待URLを<br>Twitterのともだちに<br>教えてあげてください",en:"Please share this URL<br>with your Twitter friends"},copy:{ja:"コピー",en:"COPY"},copied:{ja:"コピーしました！",en:"Copied!"},close:{ja:"閉じる",en:"Close"},"not-all-waiting":{ja:"待機中ではないメンバーがいます",en:"Some players are not 'waiting'"},"waiting-game-start":{ja:"ホストのゲーム開始を待っています…",en:"Waiting for the host to start the game…"},"room-was-destroyed":{ja:"部屋が崩れました<br>タイトルに戻ります",en:"The room was destroyed<br>Return title"},"deport-room-member":{ja:"%name%<br>を退去させますか？",en:"Would you like to deport<br>%name%?"},waiting:{ja:"待機中",en:"waiting"},playing:{ja:"ゲーム中",en:"playing"},"invitation-not-signed-in":{ja:"招待を受け取るためには<br><b>Twitterでログイン</b>する必要があります",en:"You should <b>sign in with Twitter</b><br>in order to accept a invitation"},invitation:{ja:'<span id="invite-user"></span> さんに招待されています',en:'You\'ve been invited to join by <span id="invite-user"></span>'},"invitation-invalid":{ja:"無効な招待URLです",en:"This invitation URL is invalid"},"room-doesnt-exist":{ja:"部屋が存在しません",en:"The room doesn't exist"},join:{ja:"参加する！",en:"JOIN!"},"error-room-is-full":{ja:"部屋が満員なので<br>部屋に入ることができませんでした",en:"Failed to enter the room<br>because the room is full"},"error-room-is-active":{ja:"ゲームが行われている最中なので<br>部屋に入ることができませんでした",en:"Failed to enter the room<br>because the room is active"},"error-room-versions-dont-match":{ja:"ホストとバージョンが一致しないため<br>部屋に入ることができませんでした",en:"Failed to enter the room<br>because the versions don't match"},connecting:{ja:"接続中…",en:"Connecting…"},"salmonid-counter":{ja:"匹",en:""},"offline-seed":{ja:"シード値",en:"Seed"},"offline-salmonids":{ja:"乗っている数",en:"Remaining"},"offline-height":{ja:"高さ",en:"Height"},"result-fall-count-desc":{ja:"落ちてきた数",en:"Falling"},"result-ride-count-desc":{ja:"最後に乗っていた数",en:"Remaining"},"result-height-desc":{ja:"積み上げた高さ",en:"Height"},"result-return":{ja:"戻る",en:"Return"},"result-again":{ja:"もう一度！",en:"Again!"},drop:{ja:"落下",en:"DROP"},"your-turn":{ja:"あなたのターン！",en:"Your Turn!"},"game-start":{ja:"ゲーム開始！",en:"Game Start!"},"game-start-over":{ja:"やりなおす",en:"Start Over"},"game-start-again":{ja:"リスタート",en:"Start Again"},"game-exit":{ja:"タイトルへ",en:"Exit"},"game-start-over-desc":{ja:"同じシャケ順で<br>やりなおします",en:"Start over<br>with same order"},"game-start-again-desc":{ja:"シャケ順を変えて<br>リスタートします",en:"Start again<br>with different order"},"game-exit-desc":{ja:"ゲームをやめて<br>タイトル画面に戻ります",en:"Quit playing game <br>and Return to title"},"game-online-forced-drop-desc":{ja:"誰のターンであっても<br>強制的に落下させます<br>(ホストのみ)",en:"No matter who's turn<br>Drop forcibly<br>(Host only)"},"game-online-exit-desc":{ja:"ゲームをやめて<br>ルーム画面に戻ります",en:"Quit playing game <br>and Return to room"},"game-online-forced-drop":{ja:"強制落下",en:"Drop forcibly"},"game-online-exit":{ja:"ルームへ",en:"Exit"},chum:{ja:"シャケ",en:"Chum"},cohock:{ja:"ドスコイ",en:"Cohock"},smallfry:{ja:"コジャケ",en:"Smallfry"},maws:{ja:"モグラ",en:"Maws"},scrapper:{ja:"テッパン",en:"Scrapper"},steeleel:{ja:"ヘビ",en:"Steeleel"},steelhead:{ja:"バクダン",en:"Steelhead"},drizzler:{ja:"コウモリ",en:"Drizzler"},flyfish:{ja:"カタパッド",en:"Flyfish"},stinger:{ja:"タワー",en:"Stinger"}};function ti(t){return"number"==typeof t?`${t}px`:t}class ei{constructor(t,e){Object.assign(this,t,e)}getLayer(t){return t in this.layers?this.layers[t]:document.getElementById(t)}append(t){const e=this.createElement(t);this.getLayer(t.layer||"main").appendChild(e)}createElement(t){const e=Object.assign({tag:"div",text:"",style:{},attr:{}},t),n=document.createElement(e.tag);if(e.innerHTML?n.innerHTML=e.innerHTML:e.text&&(n.innerHTML=this.app.view.getTranslatedText(e.text)),e.innerSpanText){const t=n.getElementsByTagName("span")[0];t&&(t.textContent=e.innerSpanText)}return e.id&&n.setAttribute("id",e.id),e.src&&n.setAttribute("src",e.src),e.class&&e.class.split(" ").forEach(t=>{n.classList.add(t)}),e.x&&(e.x=ti(e.x),n.style.setProperty("left",e.x),Object.assign(e.style,{position:"absolute"})),e.y&&(e.y=ti(e.y),n.style.setProperty("top",e.y),Object.assign(e.style,{position:"absolute"})),e.width&&(e.width=ti(e.width),n.style.setProperty("width",e.width)),e.height&&(e.height=ti(e.height),n.style.setProperty("height",e.height)),e.centering&&(n.style.setProperty("left",`calc(${e.x} - (${e.width} / 2))`),n.style.setProperty("top",`calc(${e.y} - (${e.height} / 2))`)),e.style&&Object.keys(e.style).forEach(t=>{n.style.setProperty(t,e.style[t])}),e.attr&&Object.keys(e.attr).forEach(t=>{n.setAttribute(t,e.attr[t])}),e.onclick?(n.classList.add("clickable"),n.addEventListener("click",e.onclick)):e.onclickonce?(n.classList.add("clickable"),n.addEventListener("click",e.onclickonce,{once:!0})):e.jump&&(n.classList.add("clickable"),"string"==typeof e.jump?n.addEventListener("click",()=>{this.app.view.jump(e.jump)},{once:!0}):n.addEventListener("click",()=>{this.app.view.jump(e.jump[0],e.jump[1])},{once:!0})),e.contents&&e.contents.forEach(t=>{if(t){const e=this.createElement(t);n.appendChild(e)}}),n}}let ni={};const ii={},si={};let oi,ai,ri,ci,li=0;const ui={originWidth:0,originHeight:0,targetWidth:0,targetHeight:0,windowWidth:0,windowHeight:0,scale:1,width:0,height:0,margin:{x:0,y:0},padding:{x:0,y:0}};function di(t){ci=t}function hi(){const t=ne(),e=ie(),n=e/t,i=G,s=U,o=F;let a,r;const c=Math.max(W,Math.min(z,n));let l,u,d,h,p;c>o?(a=i,r=i*c,l=t/a,u=0,d=Math.floor((e-r*l)/2),h=0,p=Math.floor((r-s)/2)):(a=s*(1/c),r=s,l=e/r,u=Math.floor((t-a*l)/2),d=0,h=Math.floor((a-i)/2),p=0),a=Math.floor(a),r=Math.floor(r),oi.setAttribute("width",a),oi.setAttribute("height",r),Object.assign(ui,{windowWidth:t,windowHeight:e,originWidth:i,originHeight:s,targetWidth:Math.floor(a*l),targetHeight:Math.floor(r*l),width:a,height:r,scale:l,margin:{x:u,y:d},padding:{x:h,y:p}}),ai.style.setProperty("transform",`translateX(${u}px) translateY(${d}px) scale(${l})`),ai.style.setProperty("width",`${a}px`),ai.style.setProperty("height",`${r}px`),ge("canvasresize",ui)}function pi(){clearTimeout(ri),ri=setTimeout(()=>{hi()},$)}function gi(){ci.sound.unlock(),window.removeEventListener("mousedown",gi),oi.removeEventListener("touchstart",gi)}function mi(){window.addEventListener("mousedown",gi),oi.addEventListener("touchstart",gi)}function fi(t){pe(ii[t])}function yi(){D.forEach(t=>{fi(t)})}function wi(t,e={}){const n=(new Date).getTime();if(n-li<_)return;li=n;const i=si[t];i?("function"==typeof ni.leave&&ni.leave(e),fi("main"),i.enter(e),i.bgm&&ci.sound.play(i.bgm,{volume:.3,loop:!0}),ni=i):Kt.error("シーンが定義されていません: %s",t)}function bi(t){return t in Zn&&ci.storage.get("settings").language in Zn[t]?Zn[t][ci.storage.get("settings").language]:t}function vi(){ii.alert.firstChild.classList.remove("alert-showed"),setTimeout(()=>{ii.alert.style.setProperty("display","none")},350)}function xi(t){const e=ii.alert.firstChild,n=e.querySelector(".alert-title"),i=e.querySelector(".alert-message"),s=document.getElementById("alert-button-ng"),o=document.getElementById("alert-button-ok");t.title?(n.style.setProperty("display","block"),n.textContent=bi(t.title)):n.style.setProperty("display","none");let a=bi(t.message);t.vars&&(a=a.replace(/%([A-Za-z0-9]+)%/g,(e,n)=>t.vars[n])),i.innerHTML=a,t.ok?(o.textContent=bi(t.okLabel||"cool"),o.onclick=()=>{t.ok(),vi()},t.onlyok?s.style.setProperty("display","none"):(s.style.setProperty("display","inline-block"),s.textContent=bi(t.ngLabel||"not-cool"),s.onclick=vi)):(o.textContent=bi(t.okLabel||"ok"),o.onclick=vi,s.style.setProperty("display","none")),ii.alert.style.setProperty("display","block"),setTimeout(()=>{e.classList.add("alert-showed")},17)}function ki(t){const e=document.createElement("div");e.classList.add("push-log"),e.innerHTML=bi(t),ii.main.appendChild(e),setTimeout(()=>{ii.main.removeChild(e)},3e3)}function Ei(){ii.loading.style.setProperty("display","block")}function Oi(){ii.loading.style.setProperty("display","none")}function Ai(){de().invite?wi("invite"):wi(window.INITIAL_LABEL||M)}function ji(t=M){Object.keys(a).forEach(t=>{si[a[t].label]=new ei(a[t],{layers:ii,utilities:s,constants:i,app:ci})}),ai=document.createElement("div"),ai.setAttribute("id",R),document.body.appendChild(ai),oi=document.createElement("canvas"),oi.setAttribute("id",N),oi.style.setProperty("z-index",0),ai.appendChild(oi),D.forEach((t,e)=>{const n=document.createElement("div");n.classList.add("layer"),n.classList.add(`layer-${t}`),n.style.setProperty("z-index",e+1),ai.appendChild(n),ii[t]=n}),ii.loading.style.setProperty("display","none"),ii.loading.innerHTML='<div id="loading">\n    <p>\n      <svg id="loading-tower" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 250 500" width="250" height="500">\n        <g paint-order="markers fill stroke">\n          <path d="M203.756 446.654H58.04v-40h145.715z"/>\n          <path d="M197.041 396.654h-135v-40h135z"/>\n          <path d="M189.756 346.654H64.04v-40h125.715z"/>\n          <path d="M181.041 296.654h-115v-40h115z"/>\n          <path d="M170.613 246.654H72.04v-40h98.572z"/>\n          <path d="M166.899 196.654H74.04v-40H166.9z"/>\n          <path d="M158.756 146.654H78.04v-40h80.715z"/>\n          <path d="M30.672 20.381v34.425h47.37v41.848H220.306V76.708h-54.27V38.574h-65.21V20.38zm106.469 30.074a9.014 9.014 0 019.014 9.015 9.014 9.014 0 11-9.014-9.015z"/>\n          <path d="M58.041 457.667v12.725h19.194v20.322h20.31v-20.322h67.42v20.322h20.313v-20.322h18.12v-12.725z"/>\n        </g>\n      </svg>\n    </p>\n    <p style="margin-left: 35px;">LOADING…</p>\n  </div>',ii.alert.style.setProperty("display","none"),ii.alert.innerHTML='<div class="alert-outer">\n    <div class="alert">\n      <div class="alert-back">\n        <div class="alert-back-img-outer">\n          <img src="./assets/img/forcss/alert-logo-1.png">\n          <img src="./assets/img/forcss/alert-logo-2.png">\n          <img src="./assets/img/forcss/alert-logo-3.png">\n          <img src="./assets/img/forcss/alert-logo-4.png">\n        </div>\n      </div>\n      <div class="alert-title">注意</div>\n      <div class="alert-message">評価に差があるプレイヤーと<br>バイトに参加する場合<br>評価が上がらないことがあるよ<br>それでも、バイトに参加するかい？</div>\n      <div class="alert-button-outer">\n        <div id="alert-button-ng" class="alert-button clickable">いいえ</div>\n        <div id="alert-button-ok" class="alert-button clickable">はい！</div>\n      </div>\n    </div>\n  </div>',mi(),hi(),window.addEventListener("resize",()=>{pi()}),window.addEventListener("orientationchange",()=>{pi()})}var Si={apiKey:"AIzaSyCmKBMAKgSz__8zRb4fRAB3UVsnY-gRHuo",authDomain:"salmon-tower-battle.firebaseapp.com",databaseURL:"https://salmon-tower-battle.firebaseio.com",projectId:"salmon-tower-battle",storageBucket:"salmon-tower-battle.appspot.com",messagingSenderId:"703361093744",appId:"1:703361093744:web:45e7b1e7c0e69e847da4b5"};const{logger:Ti}=s,{firebase:Ii}=window;let Bi;delete window.firebase;let Ci,Pi=null,Li=0;function Mi(t){Ci=t}function Di(){const t=window.require("electron").ipcRenderer;t.send("oauth","ping"),t.on("oauth-reply",(t,e,n)=>{if(e){Ti.log("electron-oauth-twitterモジュールの実行に成功しました。"),Ti.log(n);const t=Ii.auth.TwitterAuthProvider.credential(n.oauth_access_token,n.oauth_access_token_secret);Ii.auth().signInWithCredential(t).then(t=>{Ti.log("サインインに成功しました。"),Ti.log(t),window.location.reload()}).catch(t=>{Ti.error("サインインに失敗しました。"),Ti.error(t)})}else window.logger.error("electron-oauth-twitterの実行に失敗しました。"),window.logger.error(n)})}function Ri(){const t=new Ii.auth.TwitterAuthProvider;Y?Ii.auth().signInWithPopup(t).then(t=>{Ti.log("サインインに成功しました。"),Ti.log(t)}).catch(t=>{Ti.error("サインインに失敗しました。"),Ti.error(t)}):Ii.auth().signInWithRedirect(t)}function Ni(){ce()?Di():Ri()}function _i(){Ni()}function $i(){Ii.auth().signOut().then(()=>{Ti.log("サインアウトに成功しました。"),window.location.reload()}).catch(t=>{Ti.error("サインアウトに失敗しました。"),Ti.error(t)})}function Gi(t){const e=t.split("/"),n=e.pop().split("."),i=n.pop(),s=n.join(".").replace("_mini","").replace("_normal","").replace("_bigger","")+"{size}";return`${e.join("/")}/${s}.${i}`}async function Ui(t){const e=t.replace("{size}",""),n=t.replace("{size}","_bigger"),i=t.replace("{size}","_normal");return await ee(e)?e:await ee(n)?n:i}function Fi(t){Ii.database().ref(t).off()}function Hi(t,e){Ii.database().ref(t).on("child_added",t=>{e(t.val(),t.key)})}function Vi(t,e){Ii.database().ref(t).on("child_changed",t=>{e(t.val(),t.key)})}function qi(t,e){Ii.database().ref(t).on("child_removed",t=>{e(t.val(),t.key)})}async function Wi(t){return(await Ii.database().ref(t).once("value")).val()}function zi(t,e){return Wi(`${t}-rooms/${e}`)}async function Yi(t){await Ii.database().ref(t).remove()}async function Xi(t,e){await Ii.database().ref(t).update(e)}async function Ki(t,e){return(await Ii.database().ref(t).push(e)).key}function Ji(){Ii.auth().onAuthStateChanged(async t=>{if(t){Ti.log("%cFirebase signed in",Ti.getMarkerStyle("skyblue")),Ti.log("%cuser: %cガンジー","line-height: 30px",`line-height: 30px; padding-left: 35px;\n        font-family: sans-serif; background-image: url(${t.photoURL});\n        background-repeat: no-repeat; background-size: contain;`,"");const e=Gi(t.photoURL),n=await Ui(e),i=t.providerData&&t.providerData[0]&&t.providerData[0].uid||-1,s={},o=t.uid,a=re();await Wi(`users/${o}`)||(s[`${o}/firstSignInDate`]=a.string,s[`${o}/firstSignInUnix`]=a.unix,s[`${o}/tuid`]=i),s[`${o}/displayName`]=t.displayName,s[`${o}/photoURL`]=n,s[`${o}/lastSignInDate`]=a.string,s[`${o}/lastSignInUnix`]=a.unix,Xi("users",s),Bi={displayName:t.displayName,photoURL:n,uid:t.uid}}else Bi=null;ge("authstatechange",Bi)})}async function Qi(t,e){return await Yi(`users/${Bi.uid}/ownPrivateRoom`),Yi(`${t}-rooms/${e}`)}async function Zi(t){if(!Bi)return!1;const e=await Wi(`users/${Bi.uid}`);e&&e.ownPrivateRoom&&await Qi(t,e.ownPrivateRoom);const n=re(),i={seed:0,members:{},state:"waiting",createUnix:n.unix,createDate:n.string,ownerUser:{uid:Bi.uid,displayName:Bi.displayName,photoURL:Bi.photoURL},version:p};i.members[Bi.uid]={displayName:Bi.displayName,photoURL:Bi.photoURL,state:"waiting"};const s=await Ki(`${t}-rooms`,i);return await Xi(`users/${Bi.uid}`,{ownPrivateRoom:s}),s}async function ts(t,e){Li=0,await Xi(`${t}-rooms/${e}`,{state:"waiting"})}async function es(t,e){const n=await zi(t,e);if(!n)return"room-doesnt-exist";const i=Object.keys(n.members||{}),s=i.length;return i.indexOf(Bi.uid)<0&&s>=Z?"error-room-is-full":n.version!==p?"error-room-versions-dont-match":(await Xi(`${t}-rooms/${e}/members/${Bi.uid}`,{displayName:Bi.displayName,photoURL:Bi.photoURL,state:"waiting"}),"")}function ns(t,e){return Yi(`${t}-rooms/${e}/members/${Bi.uid}`)}async function is(t,e){const n=await zi(t,e),i=Object.keys(n.members),s=i.length,o=[];for(let t=0;t<s;t+=1)o[t]=t;const a={};i.forEach(t=>{const e=Math.floor(Math.random()*o.length),i=o[e];o.splice(e,1),a[`order-${i}`]=t,n.members[t].state="playing"});const r=re();Xi(`${t}-rooms/${e}`,{lastPlayUnix:r.unix,lastPlayDate:r.string,orders:a,operations:null,panelStates:"",members:n.members,seed:(new Date).getTime(),state:`playing-${Li}`})}function ss(){Xi(`${Pi}`,{state:"waiting"})}function os(t,e){Li+=1,is(t,e)}async function as(t,e){const n=`000${t}`.slice(-3);await Xi(`${Pi}/operations/step-${n}`,e),Kt.log("send operation: %o",e)}async function rs(t){await Xi(`${Pi}`,{panelStates:JSON.stringify(t)}),Kt.log("send panelStates: %o",t)}function cs(t,e){Fi(`${t}-rooms/${e}/operations`),Fi(`${t}-rooms/${e}/members`),Fi(`${t}-rooms/${e}`)}function ls(t,e,n){cs(t,e),Vi(`${t}-rooms/${e}/operations`,(t,e)=>{const n=parseInt(e.split("-")[1],10);Ci.game.receiveOperation(t,n)}),qi(`${t}-rooms/${e}/members`,n.onremovemember),Vi(`${t}-rooms/${e}`,(t,e)=>{"state"===e&&n.onchangeroomstate(t),"panelStates"===e&&Ci.game.syncPanelStates(t)}),Pi=`${t}-rooms/${e}`}function us(t,e){Fi(`${t}-rooms/${e}`),Fi(`${t}-rooms/${e}/members`)}function ds(t,e,n){us(t,e),Hi(`${t}-rooms/${e}/members`,n.onaddmember),qi(`${t}-rooms/${e}/members`,n.onremovemember),Vi(`${t}-rooms/${e}/members`,n.onchangememberstate),Vi(`${t}-rooms/${e}`,(t,e)=>{"state"===e&&n.onchangeroomstate(t)})}function hs(){return Bi&&Bi.uid?Bi.uid:""}function ps(){return Bi}function gs(){return Wi(`users/${Bi.uid}`)}function ms(t){Bi=t}function fs(){return void 0===Bi?"connecting":null===Bi?"not-signed-in":"signed-in"}function ys(){const t=Ii.initializeApp(Si);Ti.log("%cFirebase initialized",Ti.getMarkerStyle("skyblue")),Ti.log("database: %o",t.options.databaseURL),Ji()}
/*! Reference
 * https://github.com/emaame/salmonrun_time_timer/blob/master/src/sound.js
 * https://github.com/GoogleChromeLabs/airhorn/blob/master/app/scripts/main.min.js
 * https://qiita.com/cortyuming/items/b6e3784d08d7a90b3614
 */const ws={},bs=window.AudioContext||window.webkitAudioContext,vs=!!bs;let xs,ks,Es,Os,As=!1,js=!1;function Ss(t){Os=t}function Ts(t){if(js)return 0;const{globalVolume:e}=Os.storage.get("settings");return(e in S?S[e]:0)*t}function Is(t){const e=O+t;let n=ws[t]&&ws[t].element;return n?new Promise(t=>{t(n)}):(ws[t]={},new Promise(i=>{n=document.createElement("audio"),n.oncanplaythrough=()=>{i(n)},n.src=e,ws[t].element=n}))}function Bs(t){const e=O+t,n=ws[t]&&ws[t].buffer;return n?new Promise(t=>{t(n)}):(ws[t]={},new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=()=>{4===s.readyState&&200===s.status?(Es.resume(),Es.decodeAudioData(s.response,e=>{ws[t].buffer=e,n(e)})):i(new Error(s.statusText))},s.onerror=()=>{i(new Error(s.statusText))},s.send(null)}))}const Cs=vs?Bs:Is;function Ps(t){return Promise.all(t.map(t=>Cs(t)))}function Ls(t){ws[t].playing=!1,vs?ws[t].source.stop(0):ws[t].element.pause()}function Ms(){Object.keys(ws).forEach(t=>{ws[t].playing&&Ls(t)})}async function Ds(t,e){const n=await Is(t);return new Promise(i=>{n.currentTime=0,n.volume=Ts(e.volume),n.loop=e.loop,ws[t].updateVolume=()=>{n.volume=Ts(e.volume)},n.onended=()=>{Ls(t)},ws[t].playing=!0,n.play().then(()=>{i(!0)}).catch(()=>{i(!1)})})}async function Rs(t,e){const n=await Bs(t);ws[t].playing&&(Ls(t),await we(50)),Es.resume();const i=Es.createBufferSource(),s=Es.createGain();s.gain.value=Ts(e.volume),ws[t].mute=()=>{s.gain.value=0},ws[t].updateVolume=()=>{s.gain.value=Ts(e.volume)},i.loop=e.loop,i.buffer=n,i.connect(s),s.connect(Es.destination),i.onended=()=>{Ls(t)},ws[t].source=i,ws[t].playing=!0,i.start(0)}async function Ns(t,e){const n=Object.assign({volume:1,loop:!1},e);if(As){if(n.loop){const e=ws[t]&&ws[t].playing,n=xs===t;if(e||n)return}vs?Rs(t,n):Ds(t,n)}else n.loop&&(xs=t,ks=n)}function _s(){Object.keys(ws).forEach(t=>{ws[t].playing&&ws[t].updateVolume()})}function $s(t){js=t,_s()}async function Gs(){if(!As&&(As=!0,Ns(A),xs)){const t=xs,e=ks;xs=null,ks=null,Ns(t,e)}}function Us(t){Os.storage.get("settings").globalVolume=t,Os.storage.save("settings"),_s()}function Fs(){vs&&(Es=new bs,Es.createGain=Es.createGain||Es.createGainNode),Cs(j)}function Hs(t){for(let e=0;e<L.length;e+=1){const n=L[e];if(P[n].indexOf(t)>-1)return n}return null}function Vs(){}function qs(){window.addEventListener("keydown",t=>{const e=Hs(t.keyCode);e&&(Kt.log(`keydown-${e}`),ge(`keydown-${e}`,{isAlt:t.altKey,isCtrl:t.ctrlKey,isShift:t.shiftKey}))})}var Ws={initialize:qs,removeAllListener:Vs};const zs={};function Ys(t){return zs[t]}function Xs(t){const e=k[t];localStorage.setItem(e.storageKey,null)}function Ks(){E.forEach(t=>{Xs(t)})}function Js(t){const e=k[t],n=JSON.stringify(zs[t]);localStorage.setItem(e.storageKey,n)}function Qs(){E.forEach(t=>{Js(t)})}function Zs(){if(E.forEach(t=>{const e=k[t],n=localStorage.getItem(e.storageKey),i=n?Object.assign({},e.initialValue,JSON.parse(n)):Object.assign({},e.initialValue);zs[t]=i,Js(t)}),!zs.settings.language){const t=navigator.language||navigator.userLanguage||"ja";zs.settings.language=t.indexOf("ja")>-1?"ja":"en"}de().lang&&(zs.settings.language=de().lang.indexOf("ja")>-1?"ja":"en"),Kt.log("%cStorage initialized",Kt.getMarkerStyle("skyblue")),E.forEach(t=>{Kt.log(`${t}: %o`,zs[t])})}window.addEventListener("load",()=>{be();const t={game:o,view:r,network:c,sound:l,storage:d,key:u};Object.keys(t).forEach(e=>{"setApp"in t[e]&&t[e].setApp(t)}),f&&(window.app=t),Zs(),ys(),Fs(),ji(),Rn(),qs(),wi("loading")})}]);